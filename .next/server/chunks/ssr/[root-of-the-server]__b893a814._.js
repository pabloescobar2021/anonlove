module.exports=[72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},84121,58056,14139,a=>{"use strict";var b=a.i(72131),c=a.i(10845);async function d(){let{data:a,error:b}=await c.supabase.auth.getUser();if(!b)return a.user}async function e(a){let{data:b,error:d}=await c.supabase.from("users").select("public_id, username").eq("id_user",a).single();return d?null:b}async function f(){let{error:a}=await c.supabase.auth.signOut();if(a)throw a}function g(a){let{data:b}=c.supabase.auth.onAuthStateChange((b,c)=>{a(c?.user||null)});return b.subscription}function h(){let[a,c]=(0,b.useState)(null),[f,h]=(0,b.useState)(null),[i,j]=(0,b.useState)(!0);return(0,b.useEffect)(()=>{(async()=>{try{let a=await d();if(c(a),a){let b=await e(a.id);h(b)}}catch(a){console.error("Error loading user:",a)}finally{j(!1)}})();let a=g(async a=>{c(a),a?h(await e(a.id)):h(null)});return()=>{a.unsubscribe()}},[]),{user:a,profile:f,loading:i}}async function i(a){let{data:b,error:d}=await c.supabase.from("messages_safe").select(`
            *
            `).eq("to_user",a).order("created_at",{ascending:!0});if(d)throw d;return(b||[]).map(a=>{let b=a.user_anonymous_settings?.[0]?.is_anon;return{...a,displayId:b||a.is_anon?"Anon":a.from_public_id,username:b||a.is_anon?"Anon":a.from_username}})}async function j(a,b){let{data:d,error:e}=await c.supabase.from("messages_safe").select("*").eq("id",a).eq("to_user",b).single();if(e)throw e;return d||[]}async function k(a){let{data:b,error:d}=await c.supabase.from("messages_safe").select(`
            *`).eq("from_user",a).order("created_at",{ascending:!0});if(d)throw d;return b||[]}async function l({fromUserId:a,toUserId:b,toPublicId:d,body:e,isAnon:f}){let g=b;if(!g){if(!d)throw Error("Не указан пользователь, малыш");let{data:a,error:b}=await c.supabase.from("users").select("id_user").eq("public_id",d).single();if(b||!a)throw Error("Пользователь не найден, кись");g=a.id_user}let{error:h}=await c.supabase.from("user_anonymous_settings").upsert([{from_user_id:a,to_user_id:g,is_anon:f}],{onConflict:"from_user_id,to_user_id"});if(h)throw h;let{error:i}=await c.supabase.from("messages").insert({from_user:a,to_user:g,body:e});if(i)throw i}function m(a){let[c,d]=(0,b.useState)([]),[e,f]=(0,b.useState)([]),[g,h]=(0,b.useState)(!0),j=async()=>{if(a)try{h(!0);let[b,c]=await Promise.all([i(a),k(a)]);d(b),f(c)}catch(a){console.error("Error loading messages:",a)}finally{h(!1)}};return(0,b.useEffect)(()=>{j()},[a]),{inbox:c,sent:e,loading:g,sendMessage:async(b,c,d)=>{if(!a)throw Error("User not logged in");await l({fromUserId:a,toUserId:b.userId,toPublicId:b.publicId,body:c,isAnon:d}),await j()},refresh:j}}function n(a,c){let[d,e]=(0,b.useState)(null),[f,g]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{a&&c&&(async()=>{g(!0);try{let b=await j(c,a);e(b)}catch(a){console.error("Error loading messages:",a)}finally{g(!1)}})()},[a,c]),{message:d,loading:f}}function o(a,c,d){return(0,b.useMemo)(()=>{let b=new Map;for(let e of[...a,...c]){let a=e.from_user===d?e.to_user:e.from_user,c="";if(c="A"===e.from_display_id?"Anon":e.from_display_id,b.has(a)){let c=b.get(a);c.messages.push(e),c.count++,new Date(e.created_at)>new Date(c.lastMessage.created_at)&&(c.lastMessage=e)}else b.set(a,{userId:a,displayId:c,lastMessage:e,messages:[e],count:1})}return Array.from(b.values()).sort((a,b)=>new Date(b.lastMessage.created_at).getTime()-new Date(a.lastMessage.created_at).getTime())},[a,c,d])}a.s(["getCurrentUser",()=>d,"getUserProfile",()=>e,"onAuthStateChange",()=>g,"sighOut",()=>f],58056),a.s(["useAuth",()=>h],84121),a.s(["useCurrentMessage",()=>n,"useDialogs",()=>o,"useMessages",()=>m],14139)},21697,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d={width:200,height:200};var e=a.i(84121),f=a.i(14139),g=a.i(50944);function h(){let a=(0,g.useRouter)(),{user:h}=(0,e.useAuth)(),[i,j]=(0,c.useState)(null),{message:k,loading:l}=(0,f.useCurrentMessage)(h?.id??null,i),[m,n]=(0,c.useState)(d),[o,p]=(0,c.useState)(1),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(0);return(0,c.useEffect)(()=>{let a=window.location.hash;a&&j(a.replace("#",""))},[]),(0,b.jsxs)("div",{className:"flex justify-center items-center bg-black h-full",children:[!s&&(0,b.jsx)("div",{className:"flex justify-center items-center bg-black h-full",children:(0,b.jsx)("svg",{width:m.width,height:m.height,viewBox:"0 0 100 100",className:"overflow-visible",style:{width:200,height:200,opacity:+!q,transform:q?"scale(25)":`scale(${o})`,transition:q?"transform 0.9s cubic-bezier(0.22,1,0.36,1), opacity 0.4s ease-in-out":"transform 0.15s ease-in-out"},children:(0,b.jsx)("path",{onClick:()=>{if(u<2){v(a=>a+1),n(a=>({width:a.width+100,height:a.height+100})),p(1.2),setTimeout(()=>p(.95),120),setTimeout(()=>p(1.05),220),setTimeout(()=>p(1),320);let a=setInterval(()=>{p(1.2),setTimeout(()=>p(.95),120),setTimeout(()=>p(1.05),220),setTimeout(()=>p(1),320)},700);setTimeout(()=>clearInterval(a),1e3)}else r(!0),setTimeout(()=>{t(!0)},400)},className:"cursor-pointer transition-transform duration-150 ease-in-out",style:{transformOrigin:"50% 50%",transform:`scale(${o})`},fill:"red",stroke:"#fff",strokeWidth:2,d:"   M50 85   C20 60, 5 45, 25 25   C40 10, 50 25, 50 25   C50 25, 60 10, 75 25   C95 45, 80 60, 50 85   "})})}),s&&(0,b.jsxs)("div",{className:"relative w-full h-full overflow-hidden bg-black",children:[(0,b.jsx)("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover opacity-40",children:(0,b.jsx)("source",{src:"/bg/bgstar.mp4",type:"video/mp4"})}),(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40"}),(0,b.jsxs)("div",{className:"relative z-10 flex flex-col justify-center items-center h-full",children:[(0,b.jsx)("button",{className:"bg-white/10 p-2 mb-4",onClick:()=>a.push("anonlovemain"),children:"←"}),(0,b.jsx)("div",{className:"flex flex-col justify-center items-center border rounded-xl bg-black/80   border-white w-1/2 h-1/2 text-white p-6",children:k.body})]})]})]})}a.s(["default",()=>h],21697)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b893a814._.js.map