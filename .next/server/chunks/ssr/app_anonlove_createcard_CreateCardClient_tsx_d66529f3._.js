module.exports=[97562,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);let e=(a,b,c)=>a+(b-a)*c,f=()=>({r:Math.floor(256*Math.random()),g:0,b:0,a:.1});var g=a.i(84121),h=a.i(14139),i=a.i(38332);function j({initialData:a}){let{user:j,profile:k,loading:l}=(0,g.useAuth)(),m=(0,d.useSearchParams)(),n=m.get("id"),o=n?decodeURIComponent(n):null,p=m.get("to"),q=p?decodeURIComponent(p):null,[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),v=m.get("isMine"),w=m.get("type"),[x,y]=(0,c.useState)(null),z="recieve"===w,A=(0,i.useCheckMobile)(),{sendMessage:B,loading:C}=(0,h.useMessages)(j?.id||null),{message:D,loading:E}=(0,h.useCurrentMessage)(z&&j?.id||null,z?o:null,v),F=(0,d.useRouter)(),[G,H]=(0,c.useState)(a?.items||[]),I=(0,c.useRef)(null),[J,K]=(0,c.useState)({scale:1,offsetX:0,offsetY:0}),[L,M]=(0,c.useState)(!1),N=(0,c.useRef)(null),O=(0,c.useRef)(null),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),T=(0,c.useRef)(null),{startDrag:U,startResize:V,deleteItem:W}=((a,b,d,e)=>{let f=(0,c.useRef)({id:null,offsetX:0,offsetY:0,w:0,h:0}),g=(0,c.useRef)({id:null,startX:0,startY:0,startW:0,startH:0,fontSize:0,direction:"horizontal"});function h(a,b,c,d){return{x:(a-c.left-d.offsetX)/d.scale,y:(b-c.top-d.offsetY)/d.scale}}let i=a=>{let c,i;if(null!==g.current.id)return;let j=d.current.getBoundingClientRect(),k=f.current;if(a instanceof TouchEvent){if(0===a.touches.length)return;c=a.touches[0].clientX,i=a.touches[0].clientY}else c=a.clientX,i=a.clientY;let l=h(c,i,j,e);null!==k.id&&b(a=>a.map(a=>a.id===k.id?{...a,x:l.x-k.offsetX,y:l.y-k.offsetY}:a))},j=()=>{f.current.id=null,window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",j),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",j)},k=a=>{let c,d,f=g.current;if(null===f.id)return;if(a instanceof TouchEvent){if(0===a.touches.length)return;c=a.touches[0].clientX,d=a.touches[0].clientY}else c=a.clientX,d=a.clientY;let h=(c-f.startX)/e.scale,i=(d-f.startY)/e.scale,j=f.startW,k=f.startH,l=f.fontSize;"horizontal"===f.direction&&(j=Math.max(50,f.startW+h)),"top"===f.direction&&(k=Math.max(30,f.startH+i)),"bottom"===f.direction&&(k=Math.max(30,f.startH+i)),"diagonal"===f.direction&&(j=Math.max(50,f.startW+h),k=Math.max(30,f.startH+i),l=Math.max(2,f.fontSize+(h+i)/5)),b(a=>a.map(a=>a.id===f.id?{...a,w:j,h:k,fontSize:l}:a))},l=()=>{g.current.id=null,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",l),window.removeEventListener("touchmove",k),window.removeEventListener("touchend",l)};return{startDrag:(a,b)=>{let c,g,k=d.current.getBoundingClientRect();if("touches"in a){if(0===a.touches.length)return;c=a.touches[0].clientX,g=a.touches[0].clientY}else c=a.clientX,g=a.clientY;let l=h(c,g,k,e);f.current={id:b.id,offsetX:l.x-b.x,offsetY:l.y-b.y,w:b.w,h:b.h},window.addEventListener("mousemove",i),window.addEventListener("mouseup",j),window.addEventListener("touchmove",i),window.addEventListener("touchend",j)},startResize:(a,b,c)=>{let d,e;if(a.stopPropagation(),"touches"in a){if(0===a.touches.length)return;d=a.touches[0].clientX,e=a.touches[0].clientY}else d=a.clientX,e=a.clientY;g.current={id:b.id,startX:d,startY:e,startW:b.w,startH:b.h,fontSize:b.fontSize,direction:c},window.addEventListener("mousemove",k),window.addEventListener("mouseup",l),window.addEventListener("touchmove",k),window.addEventListener("touchend",l)},deleteItem:a=>{b(b=>b.filter(b=>b.id!==a.id))}}})(0,H,I,J);(0,c.useEffect)(()=>{q&&(s(q),u(!0)),w&&y({type:w})},[q,w]),(0,c.useEffect)(()=>{z&&D&&(E||H(D.body))},[z,D]);let{bg:X}=function(){let[a,b]=(0,c.useState)({r:0,g:0,b:0,a:.1}),d=(0,c.useRef)(a),g=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let a=null,c=d.current,h=f(),i=j=>{var k,l;let m;a||(a=j);let n=Math.min((j-a)/3e3,1),o=(k=c,l=h,m=n*n*(3-2*n),{r:e(k.r,l.r,m),g:e(k.g,l.g,m),b:e(k.b,l.b,m),a:e(k.a,l.a,m)});d.current=o,b(o),n<1||(c=h,h=f(),a=null),g.current=requestAnimationFrame(i)};return g.current=requestAnimationFrame(i),()=>{g.current&&cancelAnimationFrame(g.current)}},[]),{bg:a}}(),Y=`rgba(${Math.floor(X.r)}, ${Math.floor(X.g)}, ${Math.floor(X.b)}, ${X.a})`,Z=async()=>{let a=N.current?.value||"";if(O.current?.checked,!a)return void alert("Введи ID, сладкий!");let b=G.map(({isSelected:a,isEditing:b,...c})=>c);console.log("SEND PAYLOAD",b);try{await B({publicId:a},b,P),N.current.value="",M(!1)}catch(a){console.log(a.message||"Error sending message")}},$=a=>{K(b=>({...b,scale:Math.min(3,Math.max(.3,b.scale-.001*a.deltaY))}))},_=(a,b)=>{let c=a.clientX-b.clientX,d=a.clientY-b.clientY;return Math.sqrt(c*c+d*d)},aa=a=>{2===a.touches.length&&(T.current=_(a.touches[0],a.touches[1]))},ab=a=>{if(2===a.touches.length&&null!==T.current){a.preventDefault();let b=_(a.touches[0],a.touches[1]),c=b-T.current;K(a=>({...a,scale:Math.min(3,Math.max(.3,a.scale+.01*c))})),T.current=b}},ac=()=>{T.current=null};return x?.type==="send"?(0,b.jsxs)("div",{className:"relative flex flex-col justify-center items-center h-full overflow-hidden",style:{backgroundColor:Y},children:[(0,b.jsx)("div",{className:`relative border  rounded-md bg-white overflow-hidden z-10
                        ${A?"w-full h-1/2":"w-1/2 h-1/2"}
                        `,ref:I,onMouseDown:a=>{a.target===a.currentTarget&&H(a=>a.map(a=>({...a,isSelected:!1,isEditing:"none"})))},onWheel:$,onTouchStart:aa,onTouchMove:ab,onTouchEnd:ac,style:{transform:`
                        translate(${J.offsetX}px, ${J.offsetY}px)
                        scale(${J.scale})
                        `,transformOrigin:"center center"},children:G.map((a,c)=>(0,b.jsx)("div",{className:`flex 
                                    text-black select-none relative 
                                    ${a.isSelected&&"text"!==a.isEditing?"border":""}
                                    `,style:{position:"absolute",left:a.x,top:a.y,width:a.w,height:a.h,fontSize:a.fontSize,cursor:a.isSelected?"move":"pointer"},onDoubleClick:()=>{H(b=>b.map(b=>b.id===a.id?{...b,isEditing:"text"}:b))},onMouseDown:b=>{U(b,a),H(b=>b.map(b=>({...b,isSelected:b.id===a.id})))},onTouchStart:b=>{U(b,a),H(b=>b.map(b=>({...b,isSelected:b.id===a.id})))},children:"text"===a.isEditing?(0,b.jsx)("input",{autoFocus:!0,value:a.content,onChange:b=>{H(c=>c.map(c=>c.id===a.id?{...c,content:b.target.value}:c))},onBlur:()=>{H(b=>b.map(b=>b.id===a.id?{...b,isEditing:"none"}:b))},onKeyDown:a=>{"Enter"===a.key&&a.currentTarget.blur()}}):(0,b.jsxs)("div",{className:`relative w-full h-full text-wrap wrap-break-word flex 
                                                ${a.isSelected?" ":"overflow-hidden"}`,children:[a.content,a.isSelected&&(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("div",{className:"absolute -top-1.5 -right-2.5 ",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("svg",{onClick:a=>{R?S(!1):S(!0),a.stopPropagation()},className:"hover:scale-110 transition-transform cursor-pointer",xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 32 32",children:(0,b.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8h24M4 16h24M4 24h24"})}),(0,b.jsx)("div",{className:`absolute top-1 left-full text-[9px] bg-black/20 rounded-md w-15 h-15 flex flex-col
                                                            ${R?"opacity-100":"opacity-0"} transition-opacity`,children:(0,b.jsx)("button",{className:"hover:bg-black/10 transition-colors",onClick:()=>{W(a)},children:"Удалить"})})]})}),(0,b.jsx)("div",{onMouseDown:b=>{b.stopPropagation(),V(b,a,"horizontal")},onTouchStart:b=>{b.stopPropagation(),V(b,a,"horizontal")},className:"absolute -right-1 bottom-1/2 translate-y-1/2 w-1 h-3 bg-white    border cursor-w-resize"}),(0,b.jsx)("div",{onMouseDown:b=>{b.stopPropagation(),V(b,a,"top")},onTouchStart:b=>{b.stopPropagation(),V(b,a,"top")},className:"absolute -top-1 left-1/2 -translate-x-1/2 w-3 h-1 bg-white    border cursor-s-resize"}),(0,b.jsx)("div",{onMouseDown:b=>{b.stopPropagation(),V(b,a,"bottom")},onTouchStart:b=>{b.stopPropagation(),V(b,a,"bottom")},className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-3 h-1 bg-white    border cursor-s-resize"}),(0,b.jsx)("div",{onMouseDown:b=>{b.stopPropagation(),V(b,a,"diagonal")},onTouchStart:b=>{b.stopPropagation(),V(b,a,"diagonal")},className:"absolute -bottom-1.5 -right-1.5  w-2 h-2 bg-white    border cursor-se-resize"})]})]})},a.id))}),(0,b.jsx)("div",{className:"flex p-2 mt-10",children:(0,b.jsx)("button",{className:"p-2 border rounded-2xl",onClick:()=>{H(a=>[...a,{id:a.length,type:"text",content:`new text ${a.length+1}`,x:0,y:0+20*a.length,w:100,h:50,fontSize:16,scaleX:1,scaleY:1,rotation:0,isEditing:"none"}])},children:"Text"})}),(0,b.jsx)("div",{className:`absolute left-0  flex justify-center items-center 
                    w-7 rounded-r-full backdrop-blur-md hover:bg-white/20 transition-cursor
                    md:inset-y-0
                    inset-y-60
                    z-20
                    ${A?"bg-black/50":"bg-white/10"}
                    `,children:(0,b.jsx)("button",{onClick:()=>F.push("anonlovemain"),className:"w-full h-full ",children:"<"})}),(0,b.jsx)("div",{className:`absolute right-0  flex justify-center items-center overflow-hidden
                    w-7 rounded-l-full bg-black/50 backdrop-blur-md hover:bg-white/20 transition-cursor
                    md:inset-y-0
                    inset-y-60
                    z-20
                    ${A?"bg-black/50":"bg-white/10"}
                    `,children:(0,b.jsx)("button",{onClick:()=>{M(!0)},className:"w-full h-full",children:"..."})}),(0,b.jsx)("div",{className:`fixed inset-0 z-20 bg-black/50 transition-all duration-300 overflow-hidden 
                            ${L?"backdrop-blur-lg translate-x-0":"backdrop-blur-none translate-x-full"}
                        `,onMouseDown:a=>M(!1),children:(0,b.jsx)("div",{className:"absolute right-0 inset-y-0 flex justify-center items-center    md:w-[400px] w-full bg-black/90 z-20",onMouseDown:a=>{a.stopPropagation()},children:(0,b.jsxs)("form",{className:"relative flex flex-col w-full justify-center items-center",onSubmit:a=>{a.preventDefault()},children:[(0,b.jsx)("input",{ref:N,value:r||"",onChange:a=>s(a.target.value),disabled:t,type:"text",placeholder:"ID кисы",className:`p-2 mb-4 w-1/2 bg-white/10 border rounded-md text-white
                                        ${t&&"opacity-50"}
                                `}),(0,b.jsxs)("div",{className:"flex w-full justify-center items-center",children:[(0,b.jsx)("input",{type:"checkbox",ref:O,checked:P,onChange:a=>{Q(a.target.checked)},className:"bg-white/10 border rounded-md text-white"}),(0,b.jsx)("span",{className:"text-[10px]",children:`Будешь анонимен? (потом можно изменить)`})]}),(0,b.jsx)("button",{type:"submit",className:"p-2 mt-4 border rounded-2xl hover:bg-white/20 transition-all duration-200",onClick:Z,children:"Отправить"}),(0,b.jsx)("button",{className:"absolute left-0 w-10 h-20 bg-white/20 rounded-r-full top-1/2 -translate-y-1/2   hover:bg-white/40 transition-all duration-200   ",onClick:()=>M(!1),children:">"})]})})})]}):x?.type==="recieve"?(0,b.jsxs)("div",{className:"relative flex flex-col justify-center items-center h-full overflow-hidden",style:{backgroundColor:Y},children:[!E&&j&&(0,b.jsx)("div",{className:`relative border  rounded-md bg-white overflow-hidden z-10
                            ${A?"w-full h-1/2":"w-1/2 h-1/2"}
                            `,ref:I,onWheel:$,onTouchStart:aa,onTouchMove:ab,onTouchEnd:ac,style:{transform:`
                            translate(${J.offsetX}px, ${J.offsetY}px)
                            scale(${J.scale})
                            `,transformOrigin:"center center"},children:G.map((a,c)=>(0,b.jsx)("div",{className:`flex 
                                        text-black select-none relative 
                                        `,style:{position:"absolute",left:a.x,top:a.y,width:a.w,height:a.h,fontSize:a.fontSize,cursor:a.isSelected?"move":"pointer"},children:(0,b.jsx)("div",{className:`relative w-full h-full text-wrap wrap-break-word flex 
                                                ${a.isSelected?" ":"overflow-hidden"}`,children:a.content})},a.id))}),(0,b.jsx)("div",{className:`absolute left-0  flex justify-center items-center 
                    w-7 rounded-r-full backdrop-blur-md hover:bg-white/20 transition-cursor
                    md:inset-y-0
                    inset-y-60
                    z-20
                    ${A?"bg-black/50":"bg-white/10"}
                    `,children:(0,b.jsx)("button",{onClick:()=>F.push("anonlovemain"),className:"w-full h-full ",children:"<"})}),(0,b.jsx)("div",{className:`absolute right-0  flex justify-center items-center overflow-hidden
                    w-7 rounded-l-full bg-black/50 backdrop-blur-md hover:bg-white/20 transition-cursor
                    md:inset-y-0
                    inset-y-60
                    z-20
                    ${A?"bg-black/50":"bg-white/10"}
                    ${"true"===v?"hidden":""}
                    `,children:(0,b.jsx)("button",{onClick:()=>{M(!0)},className:"w-full h-full",children:"..."})}),(0,b.jsx)("div",{className:`fixed inset-0 z-20 bg-black/50 transition-all duration-300 overflow-hidden 
                            ${L?"backdrop-blur-lg translate-x-0":"backdrop-blur-none translate-x-full"}
                            ${"true"===v?"hidden":""}
                        `,onMouseDown:a=>M(!1),children:(0,b.jsx)("div",{className:"absolute right-0 inset-y-0 flex justify-center items-center    md:w-[400px] w-full bg-black/90 z-20",onMouseDown:a=>{a.stopPropagation()},children:(0,b.jsxs)("form",{className:"relative flex flex-col w-full justify-center items-center",onSubmit:a=>{a.preventDefault()},children:[(0,b.jsx)("input",{ref:N,value:o||"",onChange:a=>s(a.target.value),disabled:t,type:"text",placeholder:"ID кисы",className:`p-2 mb-4 w-1/2 bg-white/10 border rounded-md text-white
                                        ${t&&"opacity-50"}
                                `}),(0,b.jsxs)("div",{className:"flex w-full justify-center items-center",children:[(0,b.jsx)("input",{type:"checkbox",ref:O,checked:P,onChange:a=>{},className:"bg-white/10 border rounded-md text-white"}),(0,b.jsx)("span",{className:"text-[10px]",children:`Будешь анонимен? (потом можно изменить)`})]}),(0,b.jsx)("button",{type:"submit",className:"p-2 mt-4 border rounded-2xl hover:bg-white/20 transition-all duration-200",onClick:Z,children:"Отправить"}),(0,b.jsx)("button",{className:"absolute left-0 w-10 h-20 bg-white/20 rounded-r-full top-1/2 -translate-y-1/2   hover:bg-white/40 transition-all duration-200   ",onClick:()=>M(!1),children:">"})]})})})]}):void 0}a.s(["default",()=>j],97562)}];

//# sourceMappingURL=app_anonlove_createcard_CreateCardClient_tsx_d66529f3._.js.map