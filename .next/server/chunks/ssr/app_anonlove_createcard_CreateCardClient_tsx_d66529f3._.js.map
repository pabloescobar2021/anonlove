{"version":3,"sources":["../../../../app/anonlove/createcard/CreateCardClient.tsx","../../../../app/anonlove/createcard/useRandColor.ts","../../../../app/anonlove/createcard/btnFunction.ts","../../../../app/anonlove/createcard/useItemInteractions.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState,useEffect, useRef } from \"react\"\r\nimport { useSearchParams } from \"next/navigation\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nimport { useRandColor } from \"./useRandColor\";\r\n\r\nimport { useAuth } from \"../things/hooks/useAuth\";\r\nimport { useMessages } from \"../things/hooks/useMessages\";\r\nimport {useCurrentMessage} from \"../things/hooks/useMessages\"\r\n\r\nimport { Item, ItemDto, Viewport, itemDtoListToItems } from \"../things/types/type\";\r\n\r\nimport { createText } from \"./btnFunction\";\r\nimport { userItemInteractions } from \"./useItemInteractions\";\r\nimport { useCheckMobile } from \"../things/hooks/checkMobile\";\r\n\r\ntype MessageData = {\r\n    items: Item[]\r\n}\r\ntype TypeData = {\r\n    type: string\r\n}\r\n\r\nexport default function CreateCardPage({initialData}: {initialData?: MessageData}) {\r\n    const {user, profile, loading: authLoading} = useAuth();\r\n\r\n    const searchParams = useSearchParams()\r\n    //messageId\r\n    const messageIdRaw = searchParams.get(\"id\")\r\n    const messageId = messageIdRaw ? decodeURIComponent(messageIdRaw) : null\r\n    //userId\r\n    const rawTo = searchParams.get(\"to\")\r\n    const to = rawTo ? decodeURIComponent(rawTo) : null\r\n    const [userId, setUserId] = useState<string | null>(null) // получаем из url\r\n    const [isReply, setIsReply] = useState(false)\r\n    // чье сообщение isMine = true || false\r\n    const isMine = searchParams.get(\"isMine\")\r\n    // тип перехода send или recieve\r\n    const type = searchParams.get(\"type\")\r\n    const [messageType, setMessageType] = useState<TypeData | null>(null)\r\n    const isRecieve = type === \"recieve\"\r\n\r\n    const isMobile = useCheckMobile()\r\n\r\n    const {sendMessage: send, loading: messageLoading} = useMessages(user?.id || null);\r\n    const {message, loading} = useCurrentMessage(\r\n        isRecieve ? user?.id || null : null, \r\n        isRecieve ? messageId : null,\r\n        isMine\r\n    )\r\n\r\n    const router = useRouter()\r\n\r\n    const [items, setItems] = useState<Item[]>(initialData?.items || [])\r\n    const fieldRef = useRef<HTMLDivElement>(null)\r\n    const [viewport, setViewport] = useState<Viewport>({\r\n        scale: 1,\r\n        offsetX: 0,\r\n        offsetY: 0\r\n    })\r\n\r\n    const [rightPanelOpen, setRightPanelOpen] = useState(false)\r\n    const idRef = useRef<HTMLInputElement>(null)\r\n    const anonRef = useRef<HTMLInputElement>(null)\r\n    const [isAnon, setIsAnon] = useState(false)\r\n\r\n    const [ismenuTextOpen, setMenuTextOpen] = useState(false)\r\n    \r\n    const touchDistanceRef = useRef<number | null>(null)\r\n\r\n    const {startDrag, startResize, deleteItem} = userItemInteractions(items, setItems, fieldRef, viewport)\r\n\r\n\r\n    useEffect(() => {\r\n        if (to){\r\n            setUserId(to)\r\n            setIsReply(true)\r\n        };\r\n\r\n        if (type){\r\n            setMessageType({type})\r\n        };\r\n    },[to, type])\r\n\r\n    useEffect(() => {\r\n        if (!isRecieve) return\r\n        if (!message) return\r\n        if (loading) return\r\n\r\n        setItems(message.body)\r\n    }, [isRecieve, message])\r\n\r\n\r\n    // рандомный фон\r\n    const {bg} = useRandColor()\r\n    const bgStyle = `rgba(${Math.floor(bg.r)}, ${Math.floor(bg.g)}, ${Math.floor(bg.b)}, ${bg.a})`\r\n\r\n    const handleSendMessage = async () => {\r\n        const id = idRef.current?.value || \"\"\r\n        const anonCheckbox = anonRef.current?.checked || false\r\n\r\n        if (!id){\r\n            alert('Введи ID, сладкий!')\r\n            return\r\n        }\r\n        const cleanItems = items.map(({isSelected, isEditing, ...rest}) => rest)\r\n        console.log(\"SEND PAYLOAD\", cleanItems)\r\n        \r\n        try {\r\n            await send({publicId: id}, cleanItems, isAnon)\r\n\r\n            idRef.current!.value = \"\"\r\n            setRightPanelOpen(false)\r\n        } catch (error: any) {\r\n            console.log(error.message || 'Error sending message');\r\n        }\r\n        \r\n    }\r\n\r\n    const handleZoom = (e: React.WheelEvent<HTMLDivElement>) => {\r\n        // e.preventDefault()\r\n\r\n        setViewport(v => ({\r\n            ...v,\r\n            scale: Math.min(3, Math.max(0.3, v.scale - e.deltaY * 0.001))\r\n        }))\r\n    }\r\n\r\n    const getDistanceBetweenTouches = (touch1: Touch, touch2: Touch): number => {\r\n        const dx = touch1.clientX - touch2.clientX\r\n        const dy = touch1.clientY - touch2.clientY\r\n        return Math.sqrt(dx * dx + dy * dy)\r\n    }\r\n\r\n    const handleTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2) {\r\n            touchDistanceRef.current = getDistanceBetweenTouches(e.touches[0] as Touch, e.touches[1] as Touch)\r\n        }\r\n    }\r\n\r\n    const handleTouchMove = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2 && touchDistanceRef.current !== null) {\r\n            e.preventDefault()\r\n            const currentDistance = getDistanceBetweenTouches(e.touches[0] as Touch, e.touches[1] as Touch)\r\n            const distanceDelta = currentDistance - touchDistanceRef.current\r\n            \r\n            setViewport(v => ({\r\n                ...v,\r\n                scale: Math.min(3, Math.max(0.3, v.scale + distanceDelta * 0.01))\r\n            }))\r\n            \r\n            touchDistanceRef.current = currentDistance\r\n        }\r\n    }\r\n\r\n    const handleTouchEnd = () => {\r\n        touchDistanceRef.current = null\r\n    }\r\n\r\n    if (messageType?.type === \"send\") {\r\n        return (\r\n            <div \r\n                className={`relative flex flex-col justify-center items-center h-full overflow-hidden`}\r\n                style={{ \r\n                    backgroundColor: bgStyle\r\n                }}\r\n            >\r\n                {/* field */}\r\n                <div\r\n                    className={`relative border  rounded-md bg-white overflow-hidden z-10\r\n                        ${isMobile ? \"w-full h-1/2\" : \"w-1/2 h-1/2\"}\r\n                        `}\r\n                    ref={fieldRef}\r\n                    onMouseDown={(e) =>{\r\n                        if(e.target !== e.currentTarget) return;\r\n                        setItems(prev => prev.map(it => ({...it, isSelected: false, isEditing: 'none'})))\r\n                    }}\r\n                    onWheel={handleZoom}\r\n                    onTouchStart={handleTouchStart}\r\n                    onTouchMove={handleTouchMove}\r\n                    onTouchEnd={handleTouchEnd}\r\n                    style={{\r\n                        transform: `\r\n                        translate(${viewport.offsetX}px, ${viewport.offsetY}px)\r\n                        scale(${viewport.scale})\r\n                        `,\r\n                        transformOrigin: \"center center\"\r\n                    }}\r\n                >\r\n                    {items.map((item,i) => (\r\n                        <div \r\n                            key={item.id}\r\n                            className={`flex \r\n                                    text-black select-none relative \r\n                                    ${item.isSelected && item.isEditing !== 'text' ? \"border\": \"\"}\r\n                                    `}\r\n                            style={{\r\n                                position: \"absolute\",\r\n                                left: item.x,\r\n                                top: item.y,\r\n                                width: item.w,\r\n                                height: item.h,\r\n                                fontSize: item.fontSize,\r\n                                cursor: item.isSelected ? \"move\" : \"pointer\",\r\n                            }}\r\n                        onDoubleClick={() => {\r\n                            setItems(prev => prev.map(it => it.id === item.id ? {...it, isEditing: \"text\"} : it))\r\n                        }}\r\n                        onMouseDown={(e) => {\r\n                            startDrag(e,item)\r\n                            setItems(prev => prev.map(it => ({...it, isSelected: it.id === item.id})))\r\n                        }}\r\n                        onTouchStart={(e) => {\r\n                            startDrag(e,item)\r\n                            setItems(prev => prev.map(it => ({...it, isSelected: it.id === item.id})))\r\n                        }}\r\n                        \r\n                        >\r\n                            {item.isEditing === \"text\" \r\n                            ?(\r\n                                <input\r\n                                    autoFocus\r\n                                    value={item.content}\r\n                                    onChange={(e) => {\r\n                                        setItems(prev => prev.map(it => it.id === item.id \r\n                                            ? {...it, content: e.target.value} \r\n                                            : it))\r\n                                    }}\r\n                                    onBlur={() => {\r\n                                        setItems(prev => prev.map(it => it.id === item.id \r\n                                            ? {...it, isEditing: 'none'}\r\n                                            : it\r\n                                        ))\r\n                                    }}\r\n                                    onKeyDown={(e) => {\r\n                                        if(e.key === \"Enter\") e.currentTarget.blur()\r\n                                    }}\r\n                                >\r\n                                \r\n                                </input>\r\n    \r\n                            ): (\r\n                                <div className={`relative w-full h-full text-wrap wrap-break-word flex \r\n                                                ${item.isSelected ? \" \" : \"overflow-hidden\" }`}> \r\n                                    {item.content}\r\n    \r\n                                    {item.isSelected && (\r\n                                        <div className=\"\">\r\n    \r\n                                            {/* menu */}\r\n                                            <div\r\n                                                className=\"absolute -top-1.5 -right-2.5 \"\r\n                                            >   \r\n                                                <div className=\"relative\"> \r\n                                                    <svg \r\n                                                        onClick={(e) => {\r\n                                                            if(ismenuTextOpen) setMenuTextOpen(false);\r\n                                                            else setMenuTextOpen(true)\r\n                                                            e.stopPropagation()\r\n                                                        }}\r\n                                                        className=\"hover:scale-110 transition-transform cursor-pointer\"\r\n                                                        xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 32 32\"><path fill=\"none\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 8h24M4 16h24M4 24h24\"/></svg>\r\n                                                    <div\r\n                                                        className={`absolute top-1 left-full text-[9px] bg-black/20 rounded-md w-15 h-15 flex flex-col\r\n                                                            ${ismenuTextOpen ? \"opacity-100\" : \"opacity-0\"} transition-opacity`}\r\n                                                    >\r\n                                                        <button \r\n                                                            className=\"hover:bg-black/10 transition-colors\" \r\n                                                            onClick={() => {deleteItem(item)}}>\r\n                                                            Удалить\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n    \r\n                                            {/* resize */}\r\n                                            <div \r\n                                                onMouseDown={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"horizontal\")\r\n                                                }}\r\n                                                onTouchStart={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"horizontal\")\r\n                                                }}\r\n                                                className=\"absolute -right-1 bottom-1/2 translate-y-1/2 w-1 h-3 bg-white \r\n                                                        border cursor-w-resize\"> \r\n    \r\n                                            </div>\r\n    \r\n                                            <div \r\n                                                onMouseDown={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"top\")\r\n                                                }}\r\n                                                onTouchStart={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"top\")\r\n                                                }}\r\n                                                className=\"absolute -top-1 left-1/2 -translate-x-1/2 w-3 h-1 bg-white \r\n                                                        border cursor-s-resize\"> \r\n    \r\n                                            </div>\r\n    \r\n                                            <div \r\n                                                onMouseDown={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"bottom\")\r\n                                                }}\r\n                                                onTouchStart={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"bottom\")\r\n                                                }}\r\n                                                className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-3 h-1 bg-white \r\n                                                        border cursor-s-resize\"> \r\n    \r\n                                            </div>\r\n    \r\n                                            <div \r\n                                                onMouseDown={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"diagonal\")\r\n                                                }}\r\n                                                onTouchStart={(e) => {\r\n                                                    e.stopPropagation()\r\n                                                    startResize(e, item, \"diagonal\")\r\n                                                }}\r\n                                                className=\"absolute -bottom-1.5 -right-1.5  w-2 h-2 bg-white \r\n                                                        border cursor-se-resize\"> \r\n    \r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n    \r\n                        </div>\r\n                    ))}\r\n                </div>\r\n    \r\n                <div className=\"flex p-2 mt-10\">\r\n    \r\n                    <button\r\n                        className=\"p-2 border rounded-2xl\"  \r\n                        onClick={() => createText(setItems)}\r\n                    >\r\n                        Text\r\n                    </button>\r\n    \r\n                </div>\r\n    \r\n    \r\n    \r\n                {/* кнопка назад */}\r\n                <div\r\n                    className={`absolute left-0  flex justify-center items-center \r\n                    w-7 rounded-r-full backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                    md:inset-y-0\r\n                    inset-y-60\r\n                    z-20\r\n                    ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => router.push(\"anonlovemain\")}\r\n                        className=\"w-full h-full \">\r\n                        {`<`}\r\n                    </button>\r\n                </div>\r\n    \r\n    \r\n    \r\n                {/* Кнопка справа */}\r\n                <div\r\n                    className={`absolute right-0  flex justify-center items-center overflow-hidden\r\n                    w-7 rounded-l-full bg-black/50 backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                    md:inset-y-0\r\n                    inset-y-60\r\n                    z-20\r\n                    ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => {setRightPanelOpen(true)}}\r\n                        className=\"w-full h-full\">\r\n                        {`...`}\r\n                    </button>\r\n    \r\n                </div>\r\n    \r\n                {/* поле отправить */}\r\n                <div\r\n                    className={`fixed inset-0 z-20 bg-black/50 transition-all duration-300 overflow-hidden \r\n                            ${rightPanelOpen ? \"backdrop-blur-lg translate-x-0\" : \"backdrop-blur-none translate-x-full\"}\r\n                        `}\r\n                    onMouseDown={(e) => setRightPanelOpen(false)}\r\n                >\r\n                    <div \r\n                        className=\"absolute right-0 inset-y-0 flex justify-center items-center \r\n                                md:w-[400px] w-full bg-black/90 z-20\"\r\n                        onMouseDown={(e) => {\r\n                            e.stopPropagation()\r\n                        }}\r\n                    >   \r\n                        <form \r\n                            className=\"relative flex flex-col w-full justify-center items-center\"\r\n                            onSubmit={(e) => {\r\n                                e.preventDefault()\r\n                            }}\r\n                            >\r\n                            <input\r\n                                ref={idRef}\r\n                                value={userId || \"\"}\r\n                                onChange={(e) => setUserId(e.target.value)}\r\n                                disabled={isReply}\r\n                                type=\"text\"\r\n                                placeholder=\"ID кисы\"\r\n                                className={`p-2 mb-4 w-1/2 bg-white/10 border rounded-md text-white\r\n                                        ${isReply && \"opacity-50\"}\r\n                                `}\r\n                            />\r\n                            <div className=\"flex w-full justify-center items-center\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    ref={anonRef}\r\n                                    checked={isAnon}\r\n                                    onChange={(e) => {setIsAnon(e.target.checked)}}\r\n                                    className=\"bg-white/10 border rounded-md text-white\"\r\n                                />\r\n                                <span className=\"text-[10px]\">{`Будешь анонимен? (потом можно изменить)`}</span>\r\n                            </div>\r\n    \r\n                            <button\r\n                                type=\"submit\"\r\n                                className=\"p-2 mt-4 border rounded-2xl hover:bg-white/20 transition-all duration-200\"\r\n                                onClick={handleSendMessage}\r\n                            >\r\n                                Отправить\r\n                            </button>\r\n    \r\n                            <button \r\n                                className=\"absolute left-0 w-10 h-20 bg-white/20 rounded-r-full top-1/2 -translate-y-1/2\r\n                                hover:bg-white/40 transition-all duration-200\r\n                                \"\r\n                                onClick={() => setRightPanelOpen(false)}\r\n                            >\r\n                                {`>`}\r\n                            </button>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n    \r\n    \r\n            </div>\r\n        )\r\n    } \r\n    if (messageType?.type === \"recieve\"){\r\n        return (\r\n            <div \r\n                className={`relative flex flex-col justify-center items-center h-full overflow-hidden`}\r\n                style={{ \r\n                    backgroundColor: bgStyle\r\n                }}\r\n            >\r\n                {/* field */}\r\n                {!loading && user && (\r\n                    <div\r\n                        className={`relative border  rounded-md bg-white overflow-hidden z-10\r\n                            ${isMobile ? \"w-full h-1/2\" : \"w-1/2 h-1/2\"}\r\n                            `}\r\n                        ref={fieldRef}\r\n                        \r\n                        onWheel={handleZoom}\r\n                        onTouchStart={handleTouchStart}\r\n                        onTouchMove={handleTouchMove}\r\n                        onTouchEnd={handleTouchEnd}\r\n                        style={{\r\n                            transform: `\r\n                            translate(${viewport.offsetX}px, ${viewport.offsetY}px)\r\n                            scale(${viewport.scale})\r\n                            `,\r\n                            transformOrigin: \"center center\"\r\n                        }}\r\n                    >\r\n                        {items.map((item,i) => (\r\n                            <div \r\n                                key={item.id}\r\n                                className={`flex \r\n                                        text-black select-none relative \r\n                                        `}\r\n                                style={{\r\n                                    position: \"absolute\",\r\n                                    left: item.x,\r\n                                    top: item.y,\r\n                                    width: item.w,\r\n                                    height: item.h,\r\n                                    fontSize: item.fontSize,\r\n                                    cursor: item.isSelected ? \"move\" : \"pointer\",\r\n                                }}\r\n                            >\r\n                                <div className={`relative w-full h-full text-wrap wrap-break-word flex \r\n                                                ${item.isSelected ? \" \" : \"overflow-hidden\" }`}> \r\n                                    {item.content}\r\n\r\n                                </div>\r\n        \r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n    \r\n    \r\n                {/* кнопка назад */}\r\n                <div\r\n                    className={`absolute left-0  flex justify-center items-center \r\n                    w-7 rounded-r-full backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                    md:inset-y-0\r\n                    inset-y-60\r\n                    z-20\r\n                    ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => router.push(\"anonlovemain\")}\r\n                        className=\"w-full h-full \">\r\n                        {`<`}\r\n                    </button>\r\n                </div>\r\n    \r\n    \r\n    \r\n                {/* Кнопка справа */}\r\n                <div\r\n                    className={`absolute right-0  flex justify-center items-center overflow-hidden\r\n                    w-7 rounded-l-full bg-black/50 backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                    md:inset-y-0\r\n                    inset-y-60\r\n                    z-20\r\n                    ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n                    ${isMine === \"true\" ? \"hidden\" : \"\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => {setRightPanelOpen(true)}}\r\n                        className=\"w-full h-full\">\r\n                        {`...`}\r\n                    </button>\r\n    \r\n                </div>\r\n    \r\n                {/* поле отправить */}\r\n                <div\r\n                    className={`fixed inset-0 z-20 bg-black/50 transition-all duration-300 overflow-hidden \r\n                            ${rightPanelOpen ? \"backdrop-blur-lg translate-x-0\" : \"backdrop-blur-none translate-x-full\"}\r\n                            ${isMine === \"true\" ? \"hidden\" : \"\"}\r\n                        `}\r\n                    onMouseDown={(e) => setRightPanelOpen(false)}\r\n                >\r\n                    <div \r\n                        className=\"absolute right-0 inset-y-0 flex justify-center items-center \r\n                                md:w-[400px] w-full bg-black/90 z-20\"\r\n                        onMouseDown={(e) => {\r\n                            e.stopPropagation()\r\n                        }}\r\n                    >   \r\n                        <form \r\n                            className=\"relative flex flex-col w-full justify-center items-center\"\r\n                            onSubmit={(e) => {\r\n                                e.preventDefault()\r\n                            }}\r\n                            >\r\n                            <input\r\n                                ref={idRef}\r\n                                value={messageId || ''}\r\n                                onChange={(e) => setUserId(e.target.value)}\r\n                                disabled={isReply}\r\n                                type=\"text\"\r\n                                placeholder=\"ID кисы\"\r\n                                className={`p-2 mb-4 w-1/2 bg-white/10 border rounded-md text-white\r\n                                        ${isReply && \"opacity-50\"}\r\n                                `}\r\n                            />\r\n                            <div className=\"flex w-full justify-center items-center\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    ref={anonRef}\r\n                                    checked={isAnon}\r\n                                    onChange={(e) => {setIsAnon}}\r\n                                    className=\"bg-white/10 border rounded-md text-white\"\r\n                                />\r\n                                <span className=\"text-[10px]\">{`Будешь анонимен? (потом можно изменить)`}</span>\r\n                            </div>\r\n    \r\n                            <button\r\n                                type=\"submit\"\r\n                                className=\"p-2 mt-4 border rounded-2xl hover:bg-white/20 transition-all duration-200\"\r\n                                onClick={handleSendMessage}\r\n                            >\r\n                                Отправить\r\n                            </button>\r\n    \r\n                            <button \r\n                                className=\"absolute left-0 w-10 h-20 bg-white/20 rounded-r-full top-1/2 -translate-y-1/2\r\n                                hover:bg-white/40 transition-all duration-200\r\n                                \"\r\n                                onClick={() => setRightPanelOpen(false)}\r\n                            >\r\n                                {`>`}\r\n                            </button>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n    \r\n    \r\n            </div>\r\n        )\r\n    }\r\n\r\n}","\"use client\"\r\n\r\nimport { useState,useEffect, useRef } from \"react\"\r\n\r\ntype Color = {r: number, g: number, b: number, a: number}\r\nconst lerp = (a: number, b: number, t: number) => {\r\n    return a + (b - a) * t\r\n}\r\nconst smoothStep = (t: number) => {\r\n    return t * t * (3 - 2 * t)\r\n}\r\nconst mixColor = (from: Color, to: Color, t: number): Color => {\r\n    const k = smoothStep(t)\r\n    return{\r\n        r: lerp(from.r, to.r, k),\r\n        g: lerp(from.g, to.g, k),\r\n        b: lerp(from.b, to.b, k),\r\n        a: lerp(from.a, to.a, k),\r\n    }\r\n}\r\nconst randomColor = (): Color => {\r\n    return {\r\n        r: Math.floor(Math.random() * 256),\r\n        g: 0,\r\n        b: 0,\r\n        a: 0.1\r\n    }\r\n}\r\n\r\nexport function useRandColor() {\r\n    const [bg, setBg] = useState<Color>({r: 0, g: 0, b: 0, a: 0.1})\r\n    const colorRef = useRef<Color>(bg)\r\n    const frameRef = useRef<number | null>(null)\r\n\r\n\r\n    useEffect(() => {\r\n        let start: number | null = null\r\n        let from = colorRef.current\r\n        let to = randomColor()\r\n        const duration = 3000 \r\n\r\n        const animate = (time: number) => {\r\n            if (!start) start = time\r\n            const t = Math.min((time - start) / duration, 1)\r\n            const next = mixColor(from, to, t)\r\n\r\n            colorRef.current = next\r\n            setBg(next)\r\n\r\n            if (t < 1) {\r\n                frameRef.current = requestAnimationFrame(animate)\r\n            } else{\r\n                from = to\r\n                to = randomColor()\r\n                start = null\r\n                frameRef.current = requestAnimationFrame(animate)\r\n            }\r\n        }\r\n        frameRef.current = requestAnimationFrame(animate)\r\n\r\n        return () => {\r\n            if (frameRef.current) cancelAnimationFrame(frameRef.current)\r\n        }\r\n    },[])\r\n\r\n    return {\r\n        bg\r\n    }\r\n}","\r\nimport React from \"react\"\r\nimport { Item } from \"../things/types/type\"\r\n\r\nexport const createText = (setItems: React.Dispatch<React.SetStateAction<Item[]>>) => {\r\n        setItems(prev => [...prev, {\r\n            id: prev.length,\r\n            type: \"text\",\r\n            content: `new text ${prev.length + 1}`,\r\n            x: 0 ,\r\n            y: 0 + prev.length * 20,\r\n            w: 100,\r\n            h: 50,\r\n            fontSize: 16,\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            rotation: 0,\r\n            isEditing: 'none'\r\n        }])\r\n    }","import { Item, Viewport } from \"../things/types/type\"\r\nimport { useRef }from \"react\"\r\n\r\ntype ResizeDirection = \"horizontal\" | \"top\" | \"bottom\" | \"diagonal\"\r\n\r\ntype DragRef = {\r\n    id: number | null\r\n    offsetX: number\r\n    offsetY: number\r\n    w: number\r\n    h: number\r\n}\r\n\r\ntype ResizeRef = {\r\n    id: number | null\r\n    startX: number\r\n    startY: number\r\n    startW: number\r\n    startH: number\r\n    fontSize?: number\r\n    direction: ResizeDirection\r\n}\r\n\r\n\r\n\r\nexport const userItemInteractions = (\r\n    items: Item[], \r\n    setItems: React.Dispatch<React.SetStateAction<Item[]>>, \r\n    fieldRef: React.RefObject<HTMLDivElement | null>,\r\n    viewport: Viewport\r\n) => {\r\n    const dragRef = useRef<DragRef>({id: null, offsetX: 0, offsetY: 0, w: 0, h: 0})\r\n    const resizeRef = useRef<ResizeRef>({id: null, startX: 0, startY: 0, startW: 0, startH: 0, fontSize: 0, direction: \"horizontal\"})\r\n\r\n    function screenToCanvas(\r\n        clientX: number,\r\n        clientY: number,\r\n        rect: DOMRect,\r\n        viewport: Viewport\r\n    ){\r\n        return {\r\n            x: (clientX - rect.left - viewport.offsetX) / viewport.scale,\r\n            y: (clientY - rect.top - viewport.offsetY) / viewport.scale\r\n        }\r\n    }\r\n\r\n    function getTouchCoordinates(e: TouchEvent): { clientX: number; clientY: number } | null {\r\n        if (e.touches.length === 0) return null\r\n        const touch = e.touches[0]\r\n        return { clientX: touch.clientX, clientY: touch.clientY }\r\n    }\r\n    \r\n    const startDrag = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item) => {\r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if ('touches' in e) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const pos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        dragRef.current = {\r\n            id: item.id,\r\n            offsetX: pos.x - item.x,\r\n            offsetY: pos.y - item.y,\r\n            w: item.w,\r\n            h: item.h\r\n        }\r\n\r\n        window.addEventListener('mousemove', onDragMove)\r\n        window.addEventListener('mouseup', stopDrag)\r\n        window.addEventListener('touchmove', onDragMove as any)\r\n        window.addEventListener('touchend', stopDrag)\r\n    }\r\n    const onDragMove = (e: MouseEvent | TouchEvent) => {\r\n        if(resizeRef.current.id !== null) return;\r\n\r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        const drag = dragRef.current\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if (e instanceof TouchEvent) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const pos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        if (drag.id === null) return;\r\n\r\n        setItems(prev => prev.map(it => it.id === drag.id \r\n            ? {...it, \r\n                x: pos.x - drag.offsetX, \r\n                y: pos.y - drag.offsetY\r\n            } \r\n            : it))\r\n    }\r\n    const stopDrag = () => {\r\n        dragRef.current.id = null\r\n        window.removeEventListener('mousemove', onDragMove)\r\n        window.removeEventListener('mouseup', stopDrag)\r\n        window.removeEventListener('touchmove', onDragMove as any)\r\n        window.removeEventListener('touchend', stopDrag)\r\n    }\r\n\r\n\r\n    //resize\r\n    const startResize = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item, direction: ResizeDirection) => {\r\n        e.stopPropagation()\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if ('touches' in e) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        resizeRef.current = {\r\n            id: item.id,\r\n            startX: clientX,\r\n            startY: clientY,\r\n            startW: item.w,\r\n            startH: item.h,\r\n            fontSize: item.fontSize,\r\n            direction: direction\r\n        }\r\n        window.addEventListener('mousemove', onResizeMove)\r\n        window.addEventListener('mouseup', stopResize)\r\n        window.addEventListener('touchmove', onResizeMove as any)\r\n        window.addEventListener('touchend', stopResize)\r\n    }\r\n\r\n    const onResizeMove = (e: MouseEvent | TouchEvent) => {\r\n        const r = resizeRef.current\r\n        if (r.id === null) return;\r\n\r\n        let clientX: number, clientY: number\r\n        \r\n        if (e instanceof TouchEvent) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n\r\n        const dx = (clientX - r.startX) / viewport.scale\r\n        const dy = (clientY - r.startY) / viewport.scale\r\n\r\n        let w = r.startW\r\n        let h = r.startH\r\n        let fontSize = r.fontSize\r\n\r\n        if (r.direction === \"horizontal\") {\r\n            w = Math.max(50, r.startW + dx);\r\n        }\r\n        if(r.direction === \"top\") {\r\n            h = Math.max(30, r.startH + dy);\r\n        }\r\n        if (r.direction === \"bottom\") {\r\n            h = Math.max(30, r.startH + dy);\r\n        }\r\n        if (r.direction === \"diagonal\") {\r\n            w = Math.max(50, r.startW + dx);\r\n            h = Math.max(30, r.startH + dy);\r\n            fontSize = Math.max(2, r.fontSize! + (dx+dy) / 5);\r\n        }\r\n\r\n        // console.log(\"resize direction:\", r.direction, \"w:\", w, \"h:\", h, \"fontSize:\", fontSize)\r\n        setItems(prev => prev.map(it => it.id === r.id ? {...it, w, h, fontSize} : it))\r\n    }\r\n\r\n    const stopResize = () => {\r\n        resizeRef.current.id = null\r\n        window.removeEventListener('mousemove', onResizeMove)\r\n        window.removeEventListener('mouseup', stopResize)\r\n        window.removeEventListener('touchmove', onResizeMove as any)\r\n        window.removeEventListener('touchend', stopResize)\r\n    }\r\n\r\n\r\n\r\n    //delete\r\n    const deleteItem = (item: Item) => {\r\n        setItems(prev => prev.filter(it => it.id !== item.id))\r\n    }\r\n\r\n    return {startDrag, startResize, deleteItem}\r\n}"],"names":[],"mappings":"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"}