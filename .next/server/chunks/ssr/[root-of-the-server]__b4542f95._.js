module.exports=[72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},84121,58056,14139,a=>{"use strict";var b=a.i(72131),c=a.i(10845);async function d(){let{data:a,error:b}=await c.supabase.auth.getUser();if(!b)return a.user}async function e(a){let{data:b,error:d}=await c.supabase.from("users").select("public_id, username").eq("id_user",a).single();return d?null:b}async function f(){let{error:a}=await c.supabase.auth.signOut();if(a)throw a}function g(a){let{data:b}=c.supabase.auth.onAuthStateChange((b,c)=>{a(c?.user||null)});return b.subscription}function h(){let[a,c]=(0,b.useState)(null),[f,h]=(0,b.useState)(null),[i,j]=(0,b.useState)(!0);return(0,b.useEffect)(()=>{(async()=>{try{let a=await d();if(c(a),a){let b=await e(a.id);h(b)}}catch(a){console.error("Error loading user:",a)}finally{j(!1)}})();let a=g(async a=>{c(a),a?h(await e(a.id)):h(null)});return()=>{a.unsubscribe()}},[]),{user:a,profile:f,loading:i}}async function i(a){let{data:b,error:d}=await c.supabase.from("messages_safe").select(`
            *
            `).eq("to_user",a).order("created_at",{ascending:!0});if(d)throw d;return(b||[]).map(a=>{let b=a.user_anonymous_settings?.[0]?.is_anon;return{...a,displayId:b||a.is_anon?"Anon":a.from_public_id,username:b||a.is_anon?"Anon":a.from_username}})}async function j(a,b,d){console.log("Querying message:",{messageId:a,userId:b});let{data:e,error:f}=await c.supabase.from("messages_safe").select("*").eq("id",a).eq("true"===d?"from_user":"to_user",b).maybeSingle();if(console.log("Query result:",{data:e,error:f}),f)throw f;return e||[]}async function k(a){let{data:b,error:d}=await c.supabase.from("messages_safe").select(`
            *`).eq("from_user",a).order("created_at",{ascending:!0});if(d)throw d;return b||[]}async function l({fromUserId:a,toUserId:b,toPublicId:d,body:e,isAnon:f}){let g=b;if(!g){if(!d)throw Error("Не указан пользователь, малыш");let{data:a,error:b}=await c.supabase.from("users").select("id_user").eq("public_id",d).single();if(b||!a)throw Error("Пользователь не найден, кись");g=a.id_user}let{error:h}=await c.supabase.from("user_anonymous_settings").upsert([{from_user_id:a,to_user_id:g,is_anon:f}],{onConflict:"from_user_id,to_user_id"});if(h)throw h;let{error:i}=await c.supabase.from("messages").insert({from_user:a,to_user:g,body:e});if(i)throw i}function m(a){return{...a,isEditing:"none",isSelected:!1}}function n(a){let[c,d]=(0,b.useState)([]),[e,f]=(0,b.useState)([]),[g,h]=(0,b.useState)(!0),j=async()=>{if(a)try{h(!0);let[b,c]=await Promise.all([i(a),k(a)]);d(b),f(c)}catch(a){console.error("Error loading messages:",a)}finally{h(!1)}};return(0,b.useEffect)(()=>{j()},[a]),{inbox:c,sent:e,loading:g,sendMessage:async(b,c,d)=>{if(!a)throw Error("User not logged in");await l({fromUserId:a,toUserId:b.userId,toPublicId:b.publicId,body:c,isAnon:d}),await j()},refresh:j}}function o(a,c,d){let[e,f]=(0,b.useState)(null),[g,h]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{a&&c&&(async()=>{h(!0);try{let b=await j(c,a,d);f({...b,body:b.body.map(m)})}catch(a){console.error("Error loading messages:",a)}finally{h(!1)}})()},[a,c]),{message:e,loading:g}}function p(a,c,d){return(0,b.useMemo)(()=>{let b=new Map;for(let e of[...a,...c]){let a=e.from_user===d?e.to_user:e.from_user,c="";if(c="A"===e.from_display_id?"Anon":e.from_display_id,b.has(a)){let c=b.get(a);c.messages.push(e),c.count++,new Date(e.created_at)>new Date(c.lastMessage.created_at)&&(c.lastMessage=e)}else b.set(a,{userId:a,displayId:c,lastMessage:e,messages:[e],count:1})}return Array.from(b.values()).sort((a,b)=>new Date(b.lastMessage.created_at).getTime()-new Date(a.lastMessage.created_at).getTime())},[a,c,d])}a.s(["getCurrentUser",()=>d,"getUserProfile",()=>e,"onAuthStateChange",()=>g,"sighOut",()=>f],58056),a.s(["useAuth",()=>h],84121),a.s(["useCurrentMessage",()=>o,"useDialogs",()=>p,"useMessages",()=>n],14139)},38332,a=>{"use strict";var b=a.i(72131);function c(a=768){let[d,e]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{let a=()=>{e(window.innerWidth<=768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[a]),d}a.s(["useCheckMobile",()=>c])},98203,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(84121),f=a.i(14139),g=a.i(58056);function h({onSwipeLeft:a,onSwipeRight:b,threshold:d=50}){let e=(0,c.useRef)(null);return{onTouchStart:a=>{e.current=a.touches[0].clientX},onTouchEnd:c=>{if(null===e.current)return;let f=c.changedTouches[0].clientX-e.current;Math.abs(f)>d&&(f>0?b?.():a?.()),e.current=null}}}var i=a.i(38332);function j(){let a=(0,d.useRouter)(),{user:j,profile:l,loading:m}=(0,e.useAuth)(),{inbox:n,sent:o,sendMessage:p,loading:q}=(0,f.useMessages)(j?.id||null),r=(0,f.useDialogs)(n,o,j?.id||""),[s,t]=(0,c.useState)(null),u=r.find(a=>a.userId===s),[v,w]=(0,c.useState)(!1),x=(0,i.useCheckMobile)(),[y,z]=(0,c.useState)(!1),A=(0,c.useRef)(null);(0,c.useRef)(null);let[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),J=h({onSwipeRight:()=>{x&&w(!1)}}),K=h({onSwipeLeft:()=>{x&&I(!1)},onSwipeRight:()=>{x&&I(!0)}});(0,c.useEffect)(()=>{y&&A.current&&(A.current.value=D?.id||"")},[y,D]),(0,c.useEffect)(()=>{!m&&(j||a.replace("/anonlove/auth"))},[j,m,a]),(0,c.useEffect)(()=>{x||w(!1)},[x]);let L=async()=>{await (0,g.sighOut)(),a.push("/anonlove/auth")};return m?(0,b.jsx)("div",{className:"bg-black min-h-screen flex items-center justify-center text-white",children:"Загрузка..."}):(0,b.jsxs)("div",{className:"relative bg-black min-h-screen flex flex-col overflow-hidden",children:[(0,b.jsxs)("main",{className:"relative flex-1 text-white flex md:flex-row flex-col overflow-hidden",...!v?K:{},onClick:()=>{H&&I(!1)},children:[(0,b.jsxs)("div",{className:`absolute inset-0 bg-[#12080b] 
                            overflow-y-auto
                            transition-transform duration-300 ease-out will-change-transform
                            md:static md:translate-x-0 md:w-1/2
                            ${x&&v?"-translate-x-full":"translate-x-0"}
                        `,children:[(0,b.jsxs)("div",{className:"flex w-full relative bg-white/10 backdrop-blur-md",children:[(0,b.jsx)("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 rounded-full bg-white/10 h-8 w-15 flex justify-center items-center",children:(0,b.jsx)("button",{onClick:()=>{I(!0)},className:"bg-white/20 w-8 h-8 rounded-full",children:l?.public_id.charAt(1).toUpperCase()})}),(0,b.jsxs)("button",{className:" p-2 rounded-md w-full text-center flex justify-center items-center gap-1",children:[(0,b.jsx)("span",{className:"medium",children:"Чаты"}),(0,b.jsx)("span",{className:`w-3 h-3 rounded-full border transition bg-white border-white
                                `})]}),(0,b.jsx)("div",{className:"absolute bottom-1/2 translate-y-1/2 right-2",children:(0,b.jsx)(k,{openModal:()=>{a.push("createcard?type=send")},children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 32 32",children:(0,b.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2 4h28v18H16l-8 7v-7H2Z"})})})})]}),r.map(a=>{let c=a.displayId.charAt(1).toUpperCase(),d=a.displayId;return(0,b.jsx)("button",{className:"border border-[#8f18504e] p-2 rounded-lg w-full",onClick:()=>{t(a.userId),w(!0)},children:(0,b.jsxs)("div",{className:"flex p-2 items-center gap-2 relative",children:[(0,b.jsx)("span",{className:"flex bg-red-500 w-8 h-8 items-center justify-center rounded-full text-lg font-bold",children:c}),(0,b.jsxs)("div",{className:"",children:[(0,b.jsx)("span",{className:"font-semibold",children:d}),(0,b.jsx)("span",{className:"text-[10px] text-gray-400 absolute bottom-0 right-1 ",children:a.lastMessage.created_at.slice(11,16)})]})]})},a.userId)})]}),(0,b.jsxs)("div",{...x?J:{},className:`
                        absolute inset-0 bg-[#12080b] 
                        overflow-y-auto
                        transition-transform duration-300 ease-in-out will-change-transform
                        md:static md:translate-x-0 md:w-1/2
                        ${v?"translate-x-0":"translate-x-full"}
                    `,children:[x&&(0,b.jsx)("button",{className:" bg-white/10 backdrop-blur-2xl m-2 w-15 h-8 text-center rounded-full z-10",onClick:()=>w(!1),children:"←"}),u?.messages.map(c=>{let d=c.from_display_id.charAt(1).toUpperCase(),e=c.from_display_id,f=c.from_user===j?.id;return"Anon"===c.from_display_id?c.from_user:c.from_display_id,(0,b.jsxs)("div",{className:`flex flex-col relative w-full transition hover:bg-white/10
                                    ${f?"items-end":"items-start"}
                                `,children:[(0,b.jsxs)("div",{className:`flex items-center gap-2 p-2 cursor-pointer max-w-[80%]
                                        ${f?"flex-row-reverse text-right":"flex-row"}
                                    `,onClick:()=>{a.push(`createcard?isMine=${f}&id=${encodeURIComponent(c.id)}&type=recieve&to=${encodeURIComponent(c?.from_display_id??"")}`)},children:[(0,b.jsx)("div",{className:"md:w-10 md:h-10 w-8 h-8   rounded-full bg-red-500   flex items-center justify-center   text-lg font-bold shrink-0",children:d}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-semibold medium",children:e}),(0,b.jsx)("span",{className:"small line-clamp-2",children:""})]})]}),!f&&(0,b.jsx)("button",{className:"absolute top-1/2 right-1 -translate-y-1/2",onClick:()=>{a.push(`createcard?isMine=${f}&type=send&to=${encodeURIComponent(c?.from_display_id??"")}`)},children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 14 14",children:(0,b.jsxs)("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,b.jsx)("path",{d:"M7.5.5h-5a1 1 0 0 0-1 1v9l-1 3l4-1h8a1 1 0 0 0 1-1v-5"}),(0,b.jsx)("path",{d:"m8.363 8.137l-3 .54l.5-3.04l4.73-4.71a.999.999 0 0 1 1.42 0l1.06 1.06a1.001 1.001 0 0 1 0 1.42z"})]})})}),(0,b.jsx)("div",{className:"w-full mx-auto bg-white/20 h-px"})]},c.id)})]})]}),(0,b.jsxs)("div",{...x?K:{},className:`flex flex-1 flex-col items-center absolute bg-black/50 backdrop-blur-md transition-transform duration-150 ease-in-out will-change-transform
                    ${H?"translate-x-0":"-translate-x-full "}
                    ${x?"inset-0":"w-1/3 h-full"}
                    `,onClick:a=>{a.stopPropagation()},children:[(0,b.jsx)("div",{className:"bg-white/20 backdrop-blur-2xl w-full flexC p-2 rounded-b-2xl",children:l?.public_id}),(0,b.jsx)("div",{className:"absolute bottom-0 bg-white/10 p-2 backdrop-blur-md w-full flexC rounded-t-2xl",children:(0,b.jsx)("button",{className:"text-red-500",onClick:()=>{L()},children:"Выйти"})}),(0,b.jsx)("button",{className:"absolute h-40 top-1/2 -translate-y-1/2 right-0 bg-white/20 backdrop-blur-2xl flexC p-1    animate-pulse rounded-l-2xl   ",onClick:()=>I(!1),children:">"})]})]})}function k({children:a,openModal:d}){let e=(0,c.useRef)(null),f=(0,c.useRef)(null),g=(0,c.useRef)(0),h=(0,c.useRef)(!1),i=(0,c.useRef)({w:0,h:0});return(0,c.useEffect)(()=>{let a=e.current,b=f.current;if(!a||!b)return;let c=a.getContext("2d");if(!c)return;let d=()=>{let b=a.parentElement.getBoundingClientRect(),d=window.devicePixelRatio||1;i.current.w=b.width,i.current.h=b.height,a.width=b.width*d,a.height=b.height*d,a.style.width=b.width+"px",a.style.height=b.height+"px",c.setTransform(d,0,0,d,0,0)};d();let j=[],k=performance.now();return g.current=requestAnimationFrame(function d(e){let f;if(!c||!a)return;let l=(e-k)/1e3;k=e;let{w:m,h:n}=i.current;if(c.clearRect(0,0,m,n),.06>Math.random()){let a=Math.random()*Math.PI*2;j.push({x:Math.random()*m,y:Math.random()*n,radius:1,alpha:1,life:1,vx:50*Math.cos(a),vy:50*Math.sin(a)})}let o=(b.getBoundingClientRect(),{x:(f=a.getBoundingClientRect()).width/2,y:f.height/2});for(let a=j.length-1;a>=0;a--){let b=j[a];if(b.life-=.3*l,b.alpha=b.life,h.current){let a=o.x-b.x,c=o.y-b.y,d=Math.sqrt(a*a+c*c)+.001,e=400*Math.max(0,1-d/700);b.vx+=a/d*e*l,b.vy+=c/d*e*l}let d=Math.hypot(b.vx,b.vy);if(d>160&&(b.vx=b.vx/d*160,b.vy=b.vy/d*160),b.x+=b.vx*l,b.y+=b.vy*l,b.alpha<=0){j.splice(a,1);continue}c.globalAlpha=b.alpha,c.shadowBlur=1,c.shadowColor="white",c.fillStyle="white",c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI),c.fill()}c.globalAlpha=1,g.current=requestAnimationFrame(d)}),window.addEventListener("resize",d),()=>{g.current&&cancelAnimationFrame(g.current),window.removeEventListener("resize",d)}},[]),(0,b.jsxs)("div",{className:"relative flex justify-center items-center h-full w-full",children:[(0,b.jsx)("canvas",{ref:e,className:"absolute w-full h-full pointer-events-none z-1"}),(0,b.jsx)("button",{ref:f,onClick:()=>d(),onMouseEnter:()=>h.current=!0,onMouseLeave:()=>h.current=!1,className:"relative flex items-center justify-center p-2 h-8 w-15 bg-white/10 rounded-full hover:bg-white/40 transition-colors z-2",children:a})]})}a.s(["default",()=>j,"dynamic",0,"force-dynamic"],98203)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b4542f95._.js.map