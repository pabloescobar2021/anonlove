{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/utils/supabase/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,0LAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/hooks/useInfiniteScroll.ts"],"sourcesContent":["import {  useEffect, useRef } from \"react\";\r\n\r\ntype Options = {\r\n    onLoadMore: () => void;\r\n    enabled: boolean;\r\n    rootMargin?: string;\r\n}\r\n\r\nexport function useInfiniteScroll({\r\n    onLoadMore,\r\n    enabled,\r\n    rootMargin = \"200px\",\r\n}: Options) {\r\n    const ref = useRef<HTMLDivElement | null>(null);\r\n    \r\n    useEffect(() => {\r\n        if (!enabled) return;\r\n        if (!ref.current) return;\r\n\r\n        const observer = new IntersectionObserver(\r\n            ([entire]) => {\r\n                if (entire.isIntersecting) {\r\n                    onLoadMore();\r\n                }\r\n            },\r\n            { rootMargin }\r\n        )\r\n\r\n        observer.observe(ref.current);\r\n\r\n        return () => observer.disconnect();\r\n    }, [onLoadMore, enabled, rootMargin]);\r\n    return ref;\r\n}"],"names":[],"mappings":";;;;AAAA;;;AAQO,SAAS,kBAAkB,EAC9B,UAAU,EACV,OAAO,EACP,aAAa,OAAO,EACd;;IACN,MAAM,MAAM,IAAA,uKAAM,EAAwB;IAE1C,IAAA,0KAAS;uCAAC;YACN,IAAI,CAAC,SAAS;YACd,IAAI,CAAC,IAAI,OAAO,EAAE;YAElB,MAAM,WAAW,IAAI;+CACjB,CAAC,CAAC,OAAO;oBACL,IAAI,OAAO,cAAc,EAAE;wBACvB;oBACJ;gBACJ;8CACA;gBAAE;YAAW;YAGjB,SAAS,OAAO,CAAC,IAAI,OAAO;YAE5B;+CAAO,IAAM,SAAS,UAAU;;QACpC;sCAAG;QAAC;QAAY;QAAS;KAAW;IACpC,OAAO;AACX;GAzBgB"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/app/Products.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { use, useEffect, useRef, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { supabase } from \"@/utils/supabase/supabase\";\r\nimport { useInfiniteScroll } from \"@/hooks/useInfiniteScroll\";\r\n\r\ntype Product = {\r\n    id: string | number;\r\n    name: string;\r\n    image?: string | null;\r\n    price?: number | null;\r\n    description?: string | null;\r\n};\r\n\r\nexport default function Products({ \r\n    initialProducts, \r\n    pageSize \r\n    }: { \r\n        initialProducts: Product[]; \r\n        pageSize: number;\r\n    }) {\r\n\r\n    const [adding, setAdding] = useState<Record<string | number, boolean>>({});\r\n\r\n    function handleAdd(p: Product) {\r\n        setAdding((s) => ({ ...s, [p.id]: true }));\r\n        \r\n        setTimeout(() => setAdding((s) => ({ ...s, [p.id]: false })), 700);\r\n    }\r\n\r\n    const [products, setProducts] = useState<Product[]>(initialProducts);\r\n    const [loading, setLoading] = useState(false);\r\n    const [search, setSearch] = useState(\"\");\r\n    const [hasMore, setHasMore] = useState(initialProducts.length === pageSize);\r\n    const lastIdRef = useRef<number>(\r\n        initialProducts.length > 0 ? Number(initialProducts[initialProducts.length - 1].id) : 0\r\n    )\r\n\r\n    useEffect(() => {\r\n        setProducts([])\r\n        lastIdRef.current = 0;\r\n        setHasMore(true);\r\n\r\n        fetchNextPage(true);\r\n    },[search]);\r\n    \r\n\r\n    const fetchNextPage = async (isFirst = false) => {\r\n        if (loading || !hasMore) return;\r\n\r\n        setLoading(true);\r\n\r\n        let query = supabase\r\n            .from(\"products\")\r\n            .select(\"*\")\r\n            .order(\"id\", { ascending: true })\r\n            .limit(pageSize)\r\n\r\n        if(search.trim()){\r\n            query = query.ilike(\"name\", `%${search}%`);\r\n        }\r\n        if(!isFirst && lastIdRef.current !== 0){\r\n            query = query.gt(\"id\", lastIdRef.current);\r\n        }\r\n\r\n        const { data } = await query;\r\n\r\n        if (!data || data!.length === 0) {\r\n            setHasMore(false);\r\n            setLoading(false);\r\n            return;\r\n        } \r\n        lastIdRef.current = data[data.length - 1].id;\r\n\r\n        setProducts((p) => {\r\n            const map = new Map(p.map(item => [item.id, item]));\r\n            data.forEach(item => map.set(item.id, item));\r\n            return Array.from(map.values());\r\n        });\r\n\r\n        if (data.length < pageSize) setHasMore(false);\r\n\r\n        setLoading(false);\r\n}\r\n\r\n    const loaderRef = useInfiniteScroll({\r\n            onLoadMore: fetchNextPage,\r\n            enabled: hasMore && !loading,\r\n        }) \r\n        \r\n\r\n    return (\r\n        <section className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-5\">\r\n\r\n            <input\r\n                value={search}\r\n                onChange={(e) => setSearch(e.target.value)}\r\n                placeholder=\"Поиск товаров...\"\r\n                className=\"border p-2 w-full m-2\"\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\r\n                {products.map((p) => (\r\n                    <article key={p.id} className=\"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow hover:shadow-lg transition\">\r\n                        <Link href={`/product/${p.id}`} className=\"block\">\r\n                            <div className=\"w-full h-48 bg-gray-100 dark:bg-gray-700 overflow-hidden\">\r\n                                <img\r\n                                    src={p.image ?? \"https://imgholder.ru/600x300/8493a8/adb9ca&text=no+photo&font=kelson\"}\r\n                                    alt={p.name}\r\n                                    className=\"w-full h-full object-cover\"\r\n                                />\r\n                            </div>\r\n                        </Link>\r\n\r\n                        <div className=\"p-4\">\r\n                            <h3 className=\"text-sm font-medium text-gray-900 dark:text-gray-100 line-clamp-2\">\r\n                                {p.name}\r\n                            </h3>\r\n                            {p.description && <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-300\">{p.description}</p>}\r\n\r\n                            <div className=\"mt-4 flex items-center justify-between\">\r\n                                <div className=\"text-lg font-semibold text-indigo-600 dark:text-indigo-400\">\r\n                                    {p.price != null ? `${p.price} ₽` : \"—\"}\r\n                                </div>\r\n\r\n                                <button\r\n                                    onClick={() => handleAdd(p)}\r\n                                    className=\"ml-4 inline-flex items-center px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-300\"\r\n                                    aria-pressed={!!adding[p.id]}\r\n                                >\r\n                                    {adding[p.id] ? \"Добавлено\" : \"В корзину\"}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </article>\r\n                ))}\r\n            </div>\r\n            \r\n\r\n            {loading && <p className=\"text-center mt-4\">Загрузка...</p>}\r\n            {!hasMore && <p className=\"text-center mt-4\">Больше продуктов нет</p>}\r\n\r\n\r\n            <div ref={loaderRef} className=\"h-10\"></div>\r\n        </section>\r\n    );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAee,SAAS,SAAS,EAC7B,eAAe,EACf,QAAQ,EAIP;;IAED,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAmC,CAAC;IAExE,SAAS,UAAU,CAAU;QACzB,UAAU,CAAC,IAAM,CAAC;gBAAE,GAAG,CAAC;gBAAE,CAAC,EAAE,EAAE,CAAC,EAAE;YAAK,CAAC;QAExC,WAAW,IAAM,UAAU,CAAC,IAAM,CAAC;oBAAE,GAAG,CAAC;oBAAE,CAAC,EAAE,EAAE,CAAC,EAAE;gBAAM,CAAC,IAAI;IAClE;IAEA,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAY;IACpD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC,gBAAgB,MAAM,KAAK;IAClE,MAAM,YAAY,IAAA,uKAAM,EACpB,gBAAgB,MAAM,GAAG,IAAI,OAAO,eAAe,CAAC,gBAAgB,MAAM,GAAG,EAAE,CAAC,EAAE,IAAI;IAG1F,IAAA,0KAAS;8BAAC;YACN,YAAY,EAAE;YACd,UAAU,OAAO,GAAG;YACpB,WAAW;YAEX,cAAc;QAClB;6BAAE;QAAC;KAAO;IAGV,MAAM,gBAAgB,OAAO,UAAU,KAAK;QACxC,IAAI,WAAW,CAAC,SAAS;QAEzB,WAAW;QAEX,IAAI,QAAQ,4IAAQ,CACf,IAAI,CAAC,YACL,MAAM,CAAC,KACP,KAAK,CAAC,MAAM;YAAE,WAAW;QAAK,GAC9B,KAAK,CAAC;QAEX,IAAG,OAAO,IAAI,IAAG;YACb,QAAQ,MAAM,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;QAC7C;QACA,IAAG,CAAC,WAAW,UAAU,OAAO,KAAK,GAAE;YACnC,QAAQ,MAAM,EAAE,CAAC,MAAM,UAAU,OAAO;QAC5C;QAEA,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;QAEvB,IAAI,CAAC,QAAQ,KAAM,MAAM,KAAK,GAAG;YAC7B,WAAW;YACX,WAAW;YACX;QACJ;QACA,UAAU,OAAO,GAAG,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE,CAAC,EAAE;QAE5C,YAAY,CAAC;YACT,MAAM,MAAM,IAAI,IAAI,EAAE,GAAG,CAAC,CAAA,OAAQ;oBAAC,KAAK,EAAE;oBAAE;iBAAK;YACjD,KAAK,OAAO,CAAC,CAAA,OAAQ,IAAI,GAAG,CAAC,KAAK,EAAE,EAAE;YACtC,OAAO,MAAM,IAAI,CAAC,IAAI,MAAM;QAChC;QAEA,IAAI,KAAK,MAAM,GAAG,UAAU,WAAW;QAEvC,WAAW;IACnB;IAEI,MAAM,YAAY,IAAA,kJAAiB,EAAC;QAC5B,YAAY;QACZ,SAAS,WAAW,CAAC;IACzB;IAGJ,qBACI,6LAAC;QAAQ,WAAU;;0BAEf,6LAAC;gBACG,OAAO;gBACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;gBACzC,aAAY;gBACZ,WAAU;;;;;;0BAGd,6LAAC;gBAAI,WAAU;0BACV,SAAS,GAAG,CAAC,CAAC,kBACX,6LAAC;wBAAmB,WAAU;;0CAC1B,6LAAC,0KAAI;gCAAC,MAAM,CAAC,SAAS,EAAE,EAAE,EAAE,EAAE;gCAAE,WAAU;0CACtC,cAAA,6LAAC;oCAAI,WAAU;8CACX,cAAA,6LAAC;wCACG,KAAK,EAAE,KAAK,IAAI;wCAChB,KAAK,EAAE,IAAI;wCACX,WAAU;;;;;;;;;;;;;;;;0CAKtB,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAG,WAAU;kDACT,EAAE,IAAI;;;;;;oCAEV,EAAE,WAAW,kBAAI,6LAAC;wCAAE,WAAU;kDAAiD,EAAE,WAAW;;;;;;kDAE7F,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAI,WAAU;0DACV,EAAE,KAAK,IAAI,OAAO,GAAG,EAAE,KAAK,CAAC,EAAE,CAAC,GAAG;;;;;;0DAGxC,6LAAC;gDACG,SAAS,IAAM,UAAU;gDACzB,WAAU;gDACV,gBAAc,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC;0DAE3B,MAAM,CAAC,EAAE,EAAE,CAAC,GAAG,cAAc;;;;;;;;;;;;;;;;;;;uBA3BhC,EAAE,EAAE;;;;;;;;;;YAoCzB,yBAAW,6LAAC;gBAAE,WAAU;0BAAmB;;;;;;YAC3C,CAAC,yBAAW,6LAAC;gBAAE,WAAU;0BAAmB;;;;;;0BAG7C,6LAAC;gBAAI,KAAK;gBAAW,WAAU;;;;;;;;;;;;AAG3C;GApIwB;;QAuEF,kJAAiB;;;KAvEf"}}]
}