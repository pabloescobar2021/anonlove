{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/useRandColor.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState,useEffect, useRef } from \"react\"\r\n\r\ntype Color = {r: number, g: number, b: number, a: number}\r\nconst lerp = (a: number, b: number, t: number) => {\r\n    return a + (b - a) * t\r\n}\r\nconst smoothStep = (t: number) => {\r\n    return t * t * (3 - 2 * t)\r\n}\r\nconst mixColor = (from: Color, to: Color, t: number): Color => {\r\n    const k = smoothStep(t)\r\n    return{\r\n        r: lerp(from.r, to.r, k),\r\n        g: lerp(from.g, to.g, k),\r\n        b: lerp(from.b, to.b, k),\r\n        a: lerp(from.a, to.a, k),\r\n    }\r\n}\r\nconst randomColor = (): Color => {\r\n    return {\r\n        r: Math.floor(Math.random() * 256),\r\n        g: 0,\r\n        b: 0,\r\n        a: 0.1\r\n    }\r\n}\r\n\r\nexport function useRandColor() {\r\n    const [bg, setBg] = useState<Color>({r: 0, g: 0, b: 0, a: 0.1})\r\n    const colorRef = useRef<Color>(bg)\r\n    const frameRef = useRef<number | null>(null)\r\n\r\n\r\n    useEffect(() => {\r\n        let start: number | null = null\r\n        let from = colorRef.current\r\n        let to = randomColor()\r\n        const duration = 3000 \r\n\r\n        const animate = (time: number) => {\r\n            if (!start) start = time\r\n            const t = Math.min((time - start) / duration, 1)\r\n            const next = mixColor(from, to, t)\r\n\r\n            colorRef.current = next\r\n            setBg(next)\r\n\r\n            if (t < 1) {\r\n                frameRef.current = requestAnimationFrame(animate)\r\n            } else{\r\n                from = to\r\n                to = randomColor()\r\n                start = null\r\n                frameRef.current = requestAnimationFrame(animate)\r\n            }\r\n        }\r\n        frameRef.current = requestAnimationFrame(animate)\r\n\r\n        return () => {\r\n            if (frameRef.current) cancelAnimationFrame(frameRef.current)\r\n        }\r\n    },[])\r\n\r\n    return {\r\n        bg\r\n    }\r\n}"],"names":[],"mappings":";;;;AAEA;;AAFA;;AAKA,MAAM,OAAO,CAAC,GAAW,GAAW;IAChC,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI;AACzB;AACA,MAAM,aAAa,CAAC;IAChB,OAAO,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC;AAC7B;AACA,MAAM,WAAW,CAAC,MAAa,IAAW;IACtC,MAAM,IAAI,WAAW;IACrB,OAAM;QACF,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;QACtB,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;QACtB,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;QACtB,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;IAC1B;AACJ;AACA,MAAM,cAAc;IAChB,OAAO;QACH,GAAG,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK;QAC9B,GAAG;QACH,GAAG;QACH,GAAG;IACP;AACJ;AAEO,SAAS;;IACZ,MAAM,CAAC,IAAI,MAAM,GAAG,IAAA,yKAAQ,EAAQ;QAAC,GAAG;QAAG,GAAG;QAAG,GAAG;QAAG,GAAG;IAAG;IAC7D,MAAM,WAAW,IAAA,uKAAM,EAAQ;IAC/B,MAAM,WAAW,IAAA,uKAAM,EAAgB;IAGvC,IAAA,0KAAS;kCAAC;YACN,IAAI,QAAuB;YAC3B,IAAI,OAAO,SAAS,OAAO;YAC3B,IAAI,KAAK;YACT,MAAM,WAAW;YAEjB,MAAM;kDAAU,CAAC;oBACb,IAAI,CAAC,OAAO,QAAQ;oBACpB,MAAM,IAAI,KAAK,GAAG,CAAC,CAAC,OAAO,KAAK,IAAI,UAAU;oBAC9C,MAAM,OAAO,SAAS,MAAM,IAAI;oBAEhC,SAAS,OAAO,GAAG;oBACnB,MAAM;oBAEN,IAAI,IAAI,GAAG;wBACP,SAAS,OAAO,GAAG,sBAAsB;oBAC7C,OAAM;wBACF,OAAO;wBACP,KAAK;wBACL,QAAQ;wBACR,SAAS,OAAO,GAAG,sBAAsB;oBAC7C;gBACJ;;YACA,SAAS,OAAO,GAAG,sBAAsB;YAEzC;0CAAO;oBACH,IAAI,SAAS,OAAO,EAAE,qBAAqB,SAAS,OAAO;gBAC/D;;QACJ;iCAAE,EAAE;IAEJ,OAAO;QACH;IACJ;AACJ;GAvCgB"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/utils/supabase/alSupabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n\r\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,0LAAY"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/utils/auth.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\n\r\nexport async function getCurrentUser() {\r\n    const {data, error} = await supabase.auth.getUser()\r\n    if(error) return\r\n    return data.user\r\n}\r\n\r\nexport async function getUserProfile(userId: string) {\r\n    const {data, error} = await supabase\r\n        .from(\"users\")\r\n        .select(\"public_id, username, telegram_id, telegram_username\")\r\n        .eq(\"id_user\", userId)\r\n        .single()\r\n    if(error) return null\r\n    return data\r\n}\r\n\r\nexport async function sighOut() {\r\n    const {error} = await supabase.auth.signOut()\r\n    if(error) throw error\r\n}\r\n\r\nexport function onAuthStateChange(callback: (user:any) => void) {\r\n    const {data: listener} = supabase.auth.onAuthStateChange((event,session) => {\r\n        callback(session?.user || null)\r\n    })\r\n    return listener.subscription\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,eAAe;IAClB,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAAC,IAAI,CAAC,OAAO;IACjD,IAAG,OAAO;IACV,OAAO,KAAK,IAAI;AACpB;AAEO,eAAe,eAAe,MAAc;IAC/C,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAC/B,IAAI,CAAC,SACL,MAAM,CAAC,uDACP,EAAE,CAAC,WAAW,QACd,MAAM;IACX,IAAG,OAAO,OAAO;IACjB,OAAO;AACX;AAEO,eAAe;IAClB,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAAC,IAAI,CAAC,OAAO;IAC3C,IAAG,OAAO,MAAM;AACpB;AAEO,SAAS,kBAAkB,QAA4B;IAC1D,MAAM,EAAC,MAAM,QAAQ,EAAC,GAAG,8IAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,OAAM;QAC5D,SAAS,SAAS,QAAQ;IAC9B;IACA,OAAO,SAAS,YAAY;AAChC"}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/useAuth.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { getCurrentUser, getUserProfile, onAuthStateChange } from \"../utils/auth\"\r\n\r\nexport function useAuth() {\r\n    const [user, setUser] = useState<any>(null)\r\n    const [profile, setProfile] = useState<any>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    const refreshProfile = async () => {\r\n        if(!user) return\r\n        const profileData = await getUserProfile(user.id)\r\n        setProfile(profileData)\r\n    }\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            try {\r\n                const userData = await getCurrentUser()\r\n                setUser(userData)\r\n\r\n                if(userData) {\r\n                    const profileData = await getUserProfile(userData.id)\r\n                    setProfile(profileData)\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error loading user:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        loadUser()\r\n\r\n        const subscription = onAuthStateChange(async (newUser) => {\r\n            setUser(newUser)\r\n            if (newUser) {\r\n                const profileData = await getUserProfile(newUser.id)\r\n                setProfile(profileData)\r\n            } else {\r\n                setProfile(null)\r\n            }\r\n        })\r\n\r\n        return () => {\r\n            subscription.unsubscribe()\r\n        }\r\n    },[])\r\n\r\n    return {user,profile,loading, refreshProfile}\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKO,SAAS;;IACZ,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAM;IACtC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAM;IAC5C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,MAAM,iBAAiB;QACnB,IAAG,CAAC,MAAM;QACV,MAAM,cAAc,MAAM,IAAA,mJAAc,EAAC,KAAK,EAAE;QAChD,WAAW;IACf;IAEA,IAAA,0KAAS;6BAAC;YACN,MAAM;8CAAW;oBACb,IAAI;wBACA,MAAM,WAAW,MAAM,IAAA,mJAAc;wBACrC,QAAQ;wBAER,IAAG,UAAU;4BACT,MAAM,cAAc,MAAM,IAAA,mJAAc,EAAC,SAAS,EAAE;4BACpD,WAAW;wBACf;oBACJ,EAAE,OAAO,OAAO;wBACZ,QAAQ,KAAK,CAAC,uBAAuB;oBACzC,SAAU;wBACN,WAAW;oBACf;gBACJ;;YACA;YAEA,MAAM,eAAe,IAAA,sJAAiB;kDAAC,OAAO;oBAC1C,QAAQ;oBACR,IAAI,SAAS;wBACT,MAAM,cAAc,MAAM,IAAA,mJAAc,EAAC,QAAQ,EAAE;wBACnD,WAAW;oBACf,OAAO;wBACH,WAAW;oBACf;gBACJ;;YAEA;qCAAO;oBACH,aAAa,WAAW;gBAC5B;;QACJ;4BAAE,EAAE;IAEJ,OAAO;QAAC;QAAK;QAAQ;QAAS;IAAc;AAChD;GA7CgB"}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/utils/messages.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\nimport { error } from \"console\";\r\nimport { ItemDto } from \"../types/type\";\r\n// to_user:users(id_user, rating)\r\nexport async function getInboxMessages(userId: string){\r\n    const {data, error} = await supabase\r\n        .from(\"messages_safe\")\r\n        .select(`\r\n            *\r\n            `)\r\n        .eq(\"to_user\", userId)\r\n        .eq(\"is_visible_for_receiver\", true)\r\n        .order(\"created_at\", {ascending: true})\r\n    if(error) throw error;  \r\n\r\n    const messages = (data || []).map(msg => {\r\n        const anonSetting = msg.user_anonymous_settings?.[0]?.is_anon\r\n        return {\r\n            ...msg,\r\n            displayId: (anonSetting || msg.is_anon) ? \"Anon\" : msg.from_public_id,\r\n            username: (anonSetting || msg.is_anon) ? \"Anon\" : msg.from_username,\r\n        }\r\n    })\r\n\r\n    return messages \r\n}\r\n\r\nexport async function getCurrentMessage(messageId: string, userId: string, isMine?: string | null) {\r\n    const {data, error} = await supabase\r\n    .from(\"messages_safe\")\r\n    .select(\"*\")\r\n    .eq(\"id\", messageId)\r\n    .eq(isMine===\"true\" ? \"from_user\" : \"to_user\", userId)\r\n    .maybeSingle()\r\n    console.log('Query result messages.ts:', { data, error })\r\n    if (error) throw error\r\n    return data || []\r\n}\r\n\r\nexport async function getSentMessages(userId: string) {\r\n    const {data, error} = await supabase\r\n        .from('messages_safe')\r\n        .select(`\r\n            *`)\r\n        .eq(\"from_user\", userId)\r\n        .eq(\"is_visible_to_sender\", true)\r\n        .order(\"created_at\", {ascending: true})\r\n    \r\n    if(error) throw error\r\n    return data || []\r\n\r\n}\r\n\r\nexport async function sendMessage({\r\n    fromUserId,\r\n    toUserId,\r\n    toPublicId,\r\n    body,\r\n    isAnon\r\n}: {\r\n    fromUserId: string,\r\n    toUserId?: string,\r\n    toPublicId?: string,\r\n    body: ItemDto[],\r\n    isAnon?: boolean\r\n}) {\r\n    let receiverId = toUserId\r\n\r\n    if (!receiverId){\r\n        if (!toPublicId) throw new Error(\"Не указан пользователь, малыш\")\r\n            const {data: receiver, error: userError} = await supabase\r\n                .from(\"users\") \r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", toPublicId)\r\n                .single()\r\n            if(userError || !receiver){\r\n                throw new Error(\"Пользователь не найден, кись\")\r\n            }\r\n        receiverId = receiver.id_user\r\n    }\r\n\r\n    const {data: toggle, error: toggleError} = await supabase.rpc(\"toggle_anonymous\", {\r\n                p_from: fromUserId, \r\n                p_to: receiverId, \r\n                p_is_anon: isAnon\r\n            })\r\n\r\n    if(toggleError) throw toggleError\r\n\r\n    const {error: messageError} = await supabase\r\n        .from(\"messages\")\r\n        .insert({\r\n            from_user: fromUserId,\r\n            to_user: receiverId,\r\n            body,\r\n        })\r\n    if(messageError) throw messageError\r\n\r\n    return toggle\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAIO,eAAe,iBAAiB,MAAc;IACjD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;;YAEL,CAAC,EACJ,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,2BAA2B,MAC9B,KAAK,CAAC,cAAc;QAAC,WAAW;IAAI;IACzC,IAAG,OAAO,MAAM;IAEhB,MAAM,WAAW,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA;QAC9B,MAAM,cAAc,IAAI,uBAAuB,EAAE,CAAC,EAAE,EAAE;QACtD,OAAO;YACH,GAAG,GAAG;YACN,WAAW,AAAC,eAAe,IAAI,OAAO,GAAI,SAAS,IAAI,cAAc;YACrE,UAAU,AAAC,eAAe,IAAI,OAAO,GAAI,SAAS,IAAI,aAAa;QACvE;IACJ;IAEA,OAAO;AACX;AAEO,eAAe,kBAAkB,SAAiB,EAAE,MAAc,EAAE,MAAsB;IAC7F,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,WACT,EAAE,CAAC,WAAS,SAAS,cAAc,WAAW,QAC9C,WAAW;IACZ,QAAQ,GAAG,CAAC,6BAA6B;QAAE;QAAM;IAAM;IACvD,IAAI,OAAO,MAAM;IACjB,OAAO,QAAQ,EAAE;AACrB;AAEO,eAAe,gBAAgB,MAAc;IAChD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;aACJ,CAAC,EACL,EAAE,CAAC,aAAa,QAChB,EAAE,CAAC,wBAAwB,MAC3B,KAAK,CAAC,cAAc;QAAC,WAAW;IAAI;IAEzC,IAAG,OAAO,MAAM;IAChB,OAAO,QAAQ,EAAE;AAErB;AAEO,eAAe,YAAY,EAC9B,UAAU,EACV,QAAQ,EACR,UAAU,EACV,IAAI,EACJ,MAAM,EAOT;IACG,IAAI,aAAa;IAEjB,IAAI,CAAC,YAAW;QACZ,IAAI,CAAC,YAAY,MAAM,IAAI,MAAM;QAC7B,MAAM,EAAC,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAC,GAAG,MAAM,8IAAQ,CACpD,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,aAAa,YAChB,MAAM;QACX,IAAG,aAAa,CAAC,UAAS;YACtB,MAAM,IAAI,MAAM;QACpB;QACJ,aAAa,SAAS,OAAO;IACjC;IAEA,MAAM,EAAC,MAAM,MAAM,EAAE,OAAO,WAAW,EAAC,GAAG,MAAM,8IAAQ,CAAC,GAAG,CAAC,oBAAoB;QACtE,QAAQ;QACR,MAAM;QACN,WAAW;IACf;IAER,IAAG,aAAa,MAAM;IAEtB,MAAM,EAAC,OAAO,YAAY,EAAC,GAAG,MAAM,8IAAQ,CACvC,IAAI,CAAC,YACL,MAAM,CAAC;QACJ,WAAW;QACX,SAAS;QACT;IACJ;IACJ,IAAG,cAAc,MAAM;IAEvB,OAAO;AACX"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/utils/parseDate.ts"],"sourcesContent":["export function parseBackendDate(raw: string): Date {\r\n    if (!raw) return new Date(NaN)\r\n\r\n    return new Date(\r\n    raw\r\n      .replace(\" \", \"T\")\r\n      .replace(/\\.\\d+/, m => m.slice(0, 4)) // миллисекунды → 3 знака\r\n      .replace(/\\+00:?00$/, \"Z\"))            // +00 or +00:00 → Z\r\n\r\n}\r\n\r\nexport function parseDate(date: Date): string {\r\n    return date.toLocaleString(\"ru-RU\", {\r\n        day: \"2-digit\",\r\n        month: \"2-digit\",\r\n        year: \"numeric\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n    })\r\n}"],"names":[],"mappings":";;;;;;AAAO,SAAS,iBAAiB,GAAW;IACxC,IAAI,CAAC,KAAK,OAAO,IAAI,KAAK;IAE1B,OAAO,IAAI,KACX,IACG,OAAO,CAAC,KAAK,KACb,OAAO,CAAC,SAAS,CAAA,IAAK,EAAE,KAAK,CAAC,GAAG,IAAI,yBAAyB;KAC9D,OAAO,CAAC,aAAa,MAAiB,oBAAoB;;AAEjE;AAEO,SAAS,UAAU,IAAU;IAChC,OAAO,KAAK,cAAc,CAAC,SAAS;QAChC,KAAK;QACL,OAAO;QACP,MAAM;QACN,MAAM;QACN,QAAQ;IACZ;AACJ"}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/types/type.ts"],"sourcesContent":["import { parseBackendDate } from \"../utils/parseDate\";\r\n\r\nexport type BaseItem = {\r\n    id: number;\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    scaleX?: number,\r\n    scaleY?: number,\r\n    rotation?: number,\r\n    isSelected?: boolean\r\n}\r\n\r\nexport type TextItem = BaseItem & {\r\n    type: \"text\"\r\n    content: string\r\n    fontSize?: number\r\n    color?: string\r\n    isEditing: string\r\n}\r\n\r\nexport type GifItem = BaseItem & {\r\n    type: \"gif\",\r\n    src: string,\r\n    autoplay?: boolean\r\n    loop?: boolean\r\n}\r\n\r\nexport type Item = TextItem | GifItem\r\n\r\n\r\n// DTO\r\nexport type BaseItemDto = {\r\n    id: number\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    scaleX?: number,\r\n    scaleY?: number,\r\n    rotation?: number\r\n    type: \"text\" | \"gif\"\r\n}\r\nexport type TextItemDto = BaseItemDto & {\r\n    type: \"text\",\r\n    content: string,\r\n    fontSize?: number\r\n    color?: string\r\n}\r\nexport type GifItemDto = BaseItemDto & {\r\n    type: \"gif\",\r\n    src: string,\r\n    autoplay?: boolean\r\n    loop?: boolean\r\n}\r\nexport type ItemDto = TextItemDto | GifItemDto\r\n\r\n\r\n\r\nexport function itemDtoToItem(dto: ItemDto): Item {\r\n    if(dto.type === 'text') {\r\n        return {\r\n            ...dto, \r\n            isEditing: 'none', \r\n            isSelected: false\r\n        }\r\n    }\r\n\r\n    return {\r\n        ...dto, \r\n        isSelected: false\r\n    }\r\n}\r\nexport function itemDtoListToItems(dtos: ItemDto[]): Item[] {\r\n  return dtos.map(itemDtoToItem)\r\n}\r\n\r\n\r\n\r\nexport type Message = {\r\n    id: string,\r\n    body: ItemDto[],\r\n    created_at: string,\r\n    is_anon: boolean,\r\n    is_checked: boolean,\r\n    to_user_rating: number,\r\n    \r\n    from_user: string,\r\n    to_user: string,\r\n    from_display_id: string,\r\n    to_display_id: string,\r\n}\r\n\r\nexport type UiMessage = Omit<Message, \"body\" | 'created_at'> & {\r\n    body: Item[]\r\n    created_at: Date\r\n}\r\n\r\nexport function messageDtoToUiMessage(dto: Message): UiMessage {\r\n    return {\r\n        ...dto,\r\n        body: itemDtoListToItems(dto.body),\r\n        created_at: parseBackendDate(dto.created_at),\r\n    }\r\n}\r\n\r\n\r\n//viewport\r\nexport type Viewport ={\r\n    scale: number,\r\n    offsetX: number,\r\n    offsetY: number\r\n}\r\n\r\n\r\n\r\nexport type Particle = {\r\n  x: number\r\n  y: number\r\n  vx: number\r\n  vy: number\r\n  alpha: number\r\n  r: number\r\n  g: number\r\n  b: number\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AA4DO,SAAS,cAAc,GAAY;IACtC,IAAG,IAAI,IAAI,KAAK,QAAQ;QACpB,OAAO;YACH,GAAG,GAAG;YACN,WAAW;YACX,YAAY;QAChB;IACJ;IAEA,OAAO;QACH,GAAG,GAAG;QACN,YAAY;IAChB;AACJ;AACO,SAAS,mBAAmB,IAAe;IAChD,OAAO,KAAK,GAAG,CAAC;AAClB;AAuBO,SAAS,sBAAsB,GAAY;IAC9C,OAAO;QACH,GAAG,GAAG;QACN,MAAM,mBAAmB,IAAI,IAAI;QACjC,YAAY,IAAA,0JAAgB,EAAC,IAAI,UAAU;IAC/C;AACJ"}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/useMessages.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect, useMemo } from \"react\"\r\nimport { supabase } from \"@/utils/supabase/alSupabase\"\r\nimport { getInboxMessages, getSentMessages, sendMessage, getCurrentMessage } from \"../utils/messages\"\r\nimport { ItemDto, Item, Message, UiMessage, itemDtoListToItems, messageDtoToUiMessage } from \"../types/type\"\r\nimport { sendTelegramNotification } from \"@/app/telegram/sendTelegramNotification\"\r\n\r\n\r\nexport function useMessages(userId: string | null) {\r\n    const [inbox, setInbox] = useState<UiMessage[]>([])\r\n    const [sent, setSent] = useState<UiMessage[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n\r\n\r\n    const loadMessage = async () => {\r\n        if(!userId) return\r\n\r\n        try{\r\n            setLoading(true)\r\n            const [inboxData, sentData] = await Promise.all([\r\n                getInboxMessages(userId), \r\n                getSentMessages(userId)\r\n            ])\r\n\r\n            setInbox(inboxData.map(messageDtoToUiMessage))\r\n            setSent(sentData.map(messageDtoToUiMessage))\r\n        } catch (error) {\r\n            console.error(\"Error loading messages:\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        loadMessage()\r\n    },[userId])\r\n\r\n    const send = async (\r\n        to: {publicId?: string, userId?: string}, \r\n        body: ItemDto[],\r\n        isAnon?: boolean \r\n    ) => {\r\n        if(!userId) throw new Error(\"User not logged in\")\r\n\r\n        let receiverId = to.userId\r\n\r\n        if (!receiverId){\r\n            if(!to.publicId) throw new Error(\"Не указан пользователь, малыш\")\r\n\r\n            const {data: receiver, error: userError} = await supabase\r\n                .from(\"users\") \r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", to.publicId)\r\n                .single()\r\n            if(userError || !receiver){\r\n                throw new Error(\"Пользователь не найден, кись\")\r\n            }\r\n            receiverId = receiver.id_user\r\n        }\r\n        \r\n        const {data: messageData, error} = await supabase.rpc(\"send_message\", {\r\n            p_from: userId,\r\n            p_to: receiverId,\r\n            p_body: body,\r\n            p_is_anon: isAnon\r\n        })\r\n        if(error) throw error\r\n        \r\n        // уведомляем о сообщении\r\n        fetch(\"/api/telegram/sendNotifyTg\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ \r\n                userId: receiverId, \r\n                text: `Новое сообщение от ${userId}` ,\r\n                button: [\r\n                    [\r\n                        {\r\n                            text: \"Открыть\",\r\n                            url: `https://anonlove.vercel.app/createcard?isMine=false&id=${messageData.id}&type=recieve&to=${messageData.from_user}`\r\n                        }\r\n                    ]\r\n                ]\r\n            })\r\n        })\r\n\r\n        await loadMessage()\r\n\r\n        return messageData\r\n    }\r\n\r\n    const deleteMessage = async (ids: string[] ) => {\r\n        if (!ids.length) {\r\n            console.warn(\"Message ID is required\")\r\n            return\r\n        }\r\n        \r\n        const {error} = await supabase.rpc(\"hide_message_for_me\", {\r\n            msg_id: ids\r\n        })\r\n        if(error) {\r\n            console.error(\"Failed to delete message:\", error)\r\n            throw error\r\n        }\r\n    }\r\n\r\n    return {\r\n        inbox,\r\n        sent,\r\n        loading,\r\n        sendMessage: send,\r\n        refresh: loadMessage,\r\n        deleteMessage\r\n    }\r\n\r\n}\r\n\r\ntype UseCurrentMessageResult = {    \r\n    message: UiMessage | null,\r\n    loading: boolean\r\n}\r\nexport function useCurrentMessage(\r\n    userId: string | null, \r\n    messageId: string | null,\r\n    isMine?: string | null\r\n): UseCurrentMessageResult {\r\n    const [message, setMessage] = useState<UiMessage | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => {\r\n        if (!userId || !messageId) return\r\n\r\n        const loadMessage = async () => {\r\n            setLoading(true)\r\n            try{\r\n                const data = await getCurrentMessage(messageId, userId, isMine)\r\n                setMessage(messageDtoToUiMessage(data))\r\n            } catch (error) {\r\n                console.error(\"Error loading messages:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        loadMessage()\r\n\r\n    }, [userId, messageId])\r\n\r\n    return {\r\n        message,\r\n        loading\r\n    }\r\n}\r\n\r\n\r\n\r\nexport type Dialog = {\r\n    userId: string,\r\n    displayId: string,\r\n\r\n    lastMessage: UiMessage,\r\n    messages: UiMessage[],\r\n    count: number,\r\n    rating?: number\r\n}\r\n\r\n\r\nexport function useDialogs(\r\n    inboxMessages: UiMessage[],\r\n    sentMessages: UiMessage[],\r\n    myUserId: string,\r\n    myPublicId: string\r\n) {\r\n    const dialogs = useMemo<Dialog[]>(() => {\r\n        const map = new Map<string, Dialog>()\r\n\r\n        const allMessages = [...inboxMessages, ...sentMessages]\r\n\r\n        for (const msg of allMessages){\r\n            const dialogUserId = msg.from_user === myUserId\r\n                ? msg.to_user\r\n                : msg.from_user\r\n\r\n            let displayId = ''\r\n            if(msg.from_display_id === 'A'){\r\n                displayId = 'Anon'\r\n            } else{ \r\n                displayId = msg.from_display_id === myPublicId\r\n                    ? msg.to_display_id\r\n                    : msg.from_display_id\r\n            }\r\n\r\n            if(!map.has(dialogUserId)) {\r\n                map.set(dialogUserId, {\r\n                    userId: dialogUserId,\r\n                    displayId: displayId,\r\n\r\n                    lastMessage: msg,\r\n                    messages: [msg],\r\n                    count: 1,\r\n                    rating: msg.to_user_rating\r\n                })\r\n            } else{\r\n                const dialog = map.get(dialogUserId)!\r\n                dialog.messages.push(msg)\r\n                dialog.count++\r\n\r\n                if(msg.created_at > dialog.lastMessage.created_at){\r\n                    dialog.lastMessage = msg\r\n                }\r\n            }\r\n        }\r\n\r\n        return Array.from(map.values()).sort(\r\n            (a,b) =>\r\n                b.lastMessage.created_at.getTime() -\r\n                a.lastMessage.created_at.getTime()\r\n        )\r\n    }, [inboxMessages, sentMessages, myUserId])\r\n\r\n    return dialogs\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 556, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/useSetAnon.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\nimport { useState } from \"react\";\r\n\r\ntype SetAnonParams = {\r\n    from_user_id: string,\r\n    to_user_id: string,\r\n    is_anon: boolean\r\n}\r\n\r\nexport function useSetAnon() {\r\n    const [loading, setLoading] = useState(false)\r\n    const [error, setError] = useState<Error | null>(null)\r\n\r\n\r\n    const setAnon = async ({\r\n        from_user_id,\r\n        to_user_id,\r\n        is_anon\r\n    }: SetAnonParams) => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            const {data, error} = await supabase.rpc(\"toggle_anonymous\", {\r\n                p_from: from_user_id, \r\n                p_to: to_user_id, \r\n                p_is_anon: is_anon\r\n            })\r\n\r\n            if(error) throw error\r\n\r\n            if (data === false){\r\n                throw new Error(\"Анонимность уже была использована\")\r\n            }\r\n            return data\r\n\r\n        } catch (err) {\r\n            setError(err as Error)\r\n            throw err\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const checkAnon = async (from_user_id: string, to_user_id: string) => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            const {data, error} = await supabase\r\n                .from(\"user_anonymous_settings\")\r\n                .select(\"is_anon, anon_used_once\")\r\n                .eq(\"from_user_id\", from_user_id)\r\n                .eq(\"to_user_id\", to_user_id)\r\n                .maybeSingle()\r\n            if(error) throw error\r\n\r\n            if (!data) {\r\n                return {\r\n                    isAnon: false,\r\n                    anonUsedOnce: false,\r\n                    canToggle: true\r\n                }\r\n            }\r\n\r\n            return {\r\n                isAnon: data?.is_anon ?? false,\r\n                anonUsedOnce: data?.anon_used_once ?? false,\r\n                canToggle: !(data?.anon_used_once && !data.is_anon)\r\n            }\r\n        } catch (err) {\r\n            setError(err as Error)\r\n            throw err\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n        \r\n\r\n    return {setAnon, checkAnon, loading, error}\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAQO,SAAS;;IACZ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAe;IAGjD,MAAM,UAAU,OAAO,EACnB,YAAY,EACZ,UAAU,EACV,OAAO,EACK;QACZ,IAAI;YACA,WAAW;YACX,SAAS;YAET,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAAC,GAAG,CAAC,oBAAoB;gBACzD,QAAQ;gBACR,MAAM;gBACN,WAAW;YACf;YAEA,IAAG,OAAO,MAAM;YAEhB,IAAI,SAAS,OAAM;gBACf,MAAM,IAAI,MAAM;YACpB;YACA,OAAO;QAEX,EAAE,OAAO,KAAK;YACV,SAAS;YACT,MAAM;QACV,SAAU;YACN,WAAW;QACf;IACJ;IAEA,MAAM,YAAY,OAAO,cAAsB;QAC3C,IAAI;YACA,WAAW;YACX,SAAS;YAET,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,8IAAQ,CAC/B,IAAI,CAAC,2BACL,MAAM,CAAC,2BACP,EAAE,CAAC,gBAAgB,cACnB,EAAE,CAAC,cAAc,YACjB,WAAW;YAChB,IAAG,OAAO,MAAM;YAEhB,IAAI,CAAC,MAAM;gBACP,OAAO;oBACH,QAAQ;oBACR,cAAc;oBACd,WAAW;gBACf;YACJ;YAEA,OAAO;gBACH,QAAQ,MAAM,WAAW;gBACzB,cAAc,MAAM,kBAAkB;gBACtC,WAAW,CAAC,CAAC,MAAM,kBAAkB,CAAC,KAAK,OAAO;YACtD;QACJ,EAAE,OAAO,KAAK;YACV,SAAS;YACT,MAAM;QACV,SAAU;YACN,WAAW;QACf;IACJ;IAGA,OAAO;QAAC;QAAS;QAAW;QAAS;IAAK;AAC9C;GAvEgB"}},
    {"offset": {"line": 630, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/utils/getId.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\n\r\nexport async function getId(id: string) {\r\n\r\n    if(!id || id.trim() === \"\"){\r\n        throw new Error(\"Empty ID provided\")\r\n    }\r\n\r\n    const {data: toUser, error: toUserError} = await supabase\r\n                .from(\"users\")\r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", id.trim())\r\n                .maybeSingle()\r\n    if(toUserError){\r\n        console.error(\"Error fetching user:\", toUserError)\r\n        throw toUserError\r\n    }\r\n    if(!toUser) {\r\n        throw new Error(\"User not found\")\r\n    }\r\n\r\n    return toUser.id_user\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,MAAM,EAAU;IAElC,IAAG,CAAC,MAAM,GAAG,IAAI,OAAO,IAAG;QACvB,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,EAAC,MAAM,MAAM,EAAE,OAAO,WAAW,EAAC,GAAG,MAAM,8IAAQ,CAC5C,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,aAAa,GAAG,IAAI,IACvB,WAAW;IACxB,IAAG,aAAY;QACX,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM;IACV;IACA,IAAG,CAAC,QAAQ;QACR,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,OAAO,OAAO;AACzB"}},
    {"offset": {"line": 657, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/useGetDialogUsers.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { supabase } from \"@/utils/supabase/alSupabase\";\n\ntype DialogUserRow = {\n    to_display_id: string;\n};\n\nexport const useGetDialogUsers = (id: string | null) => {\n    const [dialogs, setDialogs] = useState<DialogUserRow[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<Error | null>(null);\n\n    useEffect(() => {\n        if (!id) {\n            setDialogs([]);\n            setError(null);\n            return;\n        }\n\n        let cancelled = false;\n        setLoading(true);\n        setError(null);\n\n        (async () => {\n            const { data, error: queryError } = await supabase\n                .from(\"messages_safe\")\n                .select(\"to_display_id\")\n                .eq(\"from_user\", id);\n\n            if (cancelled) return;\n\n            if (queryError) {\n                console.error(\"Error fetching dialogs:\", queryError);\n                setError(queryError);\n                setDialogs([]);\n                setLoading(false);\n                return;\n            }\n\n            setDialogs(data ?? []);\n            setLoading(false);\n        })();\n\n        return () => {\n            cancelled = true;\n        };\n    }, [id]);\n\n\n    return { dialogs, loading, error };\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAMO,MAAM,oBAAoB,CAAC;;IAC9B,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAkB,EAAE;IAC1D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAe;IAEjD,IAAA,0KAAS;uCAAC;YACN,IAAI,CAAC,IAAI;gBACL,WAAW,EAAE;gBACb,SAAS;gBACT;YACJ;YAEA,IAAI,YAAY;YAChB,WAAW;YACX,SAAS;YAET;+CAAC;oBACG,MAAM,EAAE,IAAI,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,8IAAQ,CAC7C,IAAI,CAAC,iBACL,MAAM,CAAC,iBACP,EAAE,CAAC,aAAa;oBAErB,IAAI,WAAW;oBAEf,IAAI,YAAY;wBACZ,QAAQ,KAAK,CAAC,2BAA2B;wBACzC,SAAS;wBACT,WAAW,EAAE;wBACb,WAAW;wBACX;oBACJ;oBAEA,WAAW,QAAQ,EAAE;oBACrB,WAAW;gBACf;aAAC;YAED;+CAAO;oBACH,YAAY;gBAChB;;QACJ;sCAAG;QAAC;KAAG;IAGP,OAAO;QAAE;QAAS;QAAS;IAAM;AACrC;GA3Ca"}},
    {"offset": {"line": 719, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/components/all.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\r\nimport { Item } from \"../../things/types/type\"\r\n\r\ntype CanvasItemProps = {\r\n  item: Item\r\n  canEdit: boolean\r\n  onSelect: (id: number) => void\r\n  onUpdate: (id: number, patch: Partial<any>) => void\r\n  onDelete: (item: Item) => void\r\n  startDrag: (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item) => void\r\n  startResize: (\r\n    e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>,\r\n    item: Item,\r\n    dir: \"horizontal\" | \"top\" | \"bottom\" | \"diagonal\"\r\n  ) => void\r\n  ismenuTextOpen: boolean\r\n  setMenuTextOpen: (v: boolean) => void\r\n  isLoading: boolean\r\n  setselectedItemId: (id: number) => void\r\n  setOpenRedactor: (v: boolean) => void\r\n}\r\n\r\nexport function CanvasItem({\r\n  item,\r\n  canEdit,\r\n  onSelect,\r\n  onUpdate,\r\n  onDelete,\r\n  startDrag,\r\n  startResize,\r\n  ismenuTextOpen,\r\n  setMenuTextOpen,\r\n  isLoading,\r\n  setselectedItemId,\r\n  setOpenRedactor\r\n}: CanvasItemProps) {\r\n\r\n  const textItem = item.type === \"text\"\r\n  const gifItem = item.type === \"gif\"\r\n\r\n  return (\r\n    <div\r\n      className={`flex text-black select-none relative\r\n        ${textItem && item.isSelected && item.isEditing !== \"text\" ? \"border\" : \"\"}\r\n      `}\r\n      style={{\r\n        position: \"absolute\",\r\n        left: item.x,\r\n        top: item.y,\r\n        width: item.w,\r\n        height: item.h,\r\n        fontSize: textItem ? item.fontSize : undefined,\r\n        color: textItem ?item.color : undefined,\r\n        cursor: canEdit ? (item.isSelected ? \"move\" : \"pointer\"): \"cursor-allow\",\r\n        transform: `rotate(${item.rotation || 0}rad)`,\r\n        transformOrigin: \"center center\"\r\n      }}\r\n      onDoubleClick={() => {\r\n        if(item.type === 'text') onUpdate(item.id, { isEditing: \"text\" })\r\n      }}\r\n      onMouseDown={e => {\r\n        if(!canEdit) return\r\n        startDrag(e, item)\r\n        onSelect(item.id)\r\n      }}\r\n      onTouchStart={e => {\r\n        if(!canEdit) return\r\n        startDrag(e, item)\r\n        onSelect(item.id)\r\n      }}\r\n      onClick={() => {\r\n        setselectedItemId(item.id)\r\n        setOpenRedactor(true)\r\n      }}\r\n      tabIndex={0}\r\n      onKeyDown={(e) => {\r\n        if(e.key === 'Delete') onDelete(item)\r\n      }}\r\n    >\r\n      {textItem && item.isEditing === \"text\" ? (\r\n        <input\r\n          autoFocus\r\n          value={item.content}\r\n          onChange={e => onUpdate(item.id, { content: e.target.value })}\r\n          onBlur={() => onUpdate(item.id, { isEditing: \"none\" })}\r\n          onKeyDown={e => {\r\n            if (e.key === \"Enter\") e.currentTarget.blur()\r\n          }}\r\n        />\r\n      ) : (\r\n        <div\r\n          className={`relative w-full h-full flex ${\r\n            item.isSelected ? \"\" : \"overflow-hidden\"\r\n          }`}\r\n        >\r\n          {item.type === 'text' \r\n          ? (\r\n            item.content\r\n          ):(\r\n            <img\r\n              src={item.src}\r\n              draggable={false}\r\n              className=\"w-full h-full object-contain\"\r\n            />\r\n          )}\r\n\r\n          {item.isSelected && (\r\n            <>\r\n              {/* menu */}\r\n              <div className=\"absolute -top-1.5 -right-2.5\">\r\n                <div className=\"relative\">\r\n                  <svg\r\n                    onClick={e => {\r\n                      e.stopPropagation()\r\n                      setMenuTextOpen(!ismenuTextOpen)\r\n                    }}\r\n                    className=\"hover:scale-110 transition-transform cursor-pointer\"\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"10\"\r\n                    height=\"10\"\r\n                    viewBox=\"0 0 32 32\"\r\n                  >\r\n                    <path\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth=\"2\"\r\n                      d=\"M4 8h24M4 16h24M4 24h24\"\r\n                    />\r\n                  </svg>\r\n\r\n                  <div\r\n                    className={`absolute top-1 left-full text-[9px] bg-black/20 rounded-md\r\n                      flex flex-col transition-opacity ${\r\n                        ismenuTextOpen ? \"opacity-100\" : \"opacity-0\"\r\n                      }`}\r\n                  >\r\n                    <button\r\n                      className=\"hover:bg-black/10\"\r\n                      onClick={() => onDelete(item)}\r\n                    >\r\n                      Удалить\r\n                    </button>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* resize handles */}\r\n              <ResizeHandle\r\n                className=\"-right-1 bottom-1/2 translate-y-1/2 w-1 h-3 cursor-w-resize\"\r\n                onStart={e => startResize(e, item, \"horizontal\")}\r\n              />\r\n              <ResizeHandle\r\n                className=\"-top-1 left-1/2 -translate-x-1/2 w-3 h-1 cursor-s-resize\"\r\n                onStart={e => startResize(e, item, \"top\")}\r\n              />\r\n              <ResizeHandle\r\n                className=\"-bottom-1 left-1/2 -translate-x-1/2 w-3 h-1 cursor-s-resize\"\r\n                onStart={e => startResize(e, item, \"bottom\")}\r\n              />\r\n              <ResizeHandle\r\n                className=\"-bottom-1.5 -right-1.5 w-2 h-2 cursor-se-resize\"\r\n                onStart={e => startResize(e, item, \"diagonal\")}\r\n              />\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction ResizeHandle({\r\n  className,\r\n  onStart,\r\n}: {\r\n  className: string\r\n  onStart: (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => void\r\n}) {\r\n  return (\r\n    <div\r\n      className={`absolute bg-white border ${className}`}\r\n      onMouseDown={e => {\r\n        e.stopPropagation()\r\n        onStart(e)\r\n      }}\r\n      onTouchStart={e => {\r\n        e.stopPropagation()\r\n        onStart(e)\r\n      }}\r\n    />\r\n  )\r\n}\r\n\r\n\r\n\r\nexport function RightField({\r\n    rightPanelOpen,\r\n    setRightPanelOpen,\r\n    userId, setUserId,\r\n    isReply,\r\n    anonState, \r\n    setAnonState,\r\n    handleSendMessage,\r\n    idRef,anonRef,\r\n    isRecieve,\r\n    routeTo,\r\n    userError,\r\n    to,\r\n    dialogs,\r\n    isMine\r\n\r\n}: {\r\n    rightPanelOpen: boolean\r\n    setRightPanelOpen: (v: boolean) => void\r\n    userId: string | null\r\n    setUserId: (v: string) => void\r\n    isReply: boolean\r\n    anonState: { \r\n      isAnon: boolean,\r\n      anonUsedOnce: boolean,\r\n      canToggle: boolean  \r\n    }\r\n    setAnonState: (isAnon: boolean) => void\r\n    handleSendMessage: () => void\r\n    idRef: React.RefObject<HTMLInputElement | null>\r\n    anonRef: React.RefObject<HTMLInputElement | null>\r\n    isRecieve: boolean\r\n    routeTo: (v: string | null) => void\r\n    userError: string | null\r\n    to: string | null\r\n    dialogs: any[]\r\n    isMine: string | null\r\n}) {\r\n    const [inputValue, setInputValue] = useState(userId || \"\");\r\n    useEffect(() => {\r\n        if(!userId) return\r\n        setInputValue(userId || \"\")\r\n    },[userId])\r\n\r\n    const [isMsgMenuOpen, setIsMsgMenuOpen] = useState(false)\r\n\r\n    if(isMine === 'true') return null\r\n    return (\r\n        <div\r\n            className={`fixed inset-0 z-20 bg-black/50 transition-all duration-300 overflow-hidden \r\n                    ${rightPanelOpen ? \"backdrop-blur-lg translate-y-0\" : \"backdrop-blur-none translate-y-full\"}\r\n                `}\r\n            onMouseDown={(e) => setRightPanelOpen(false)}\r\n        >\r\n            <div \r\n                className=\"absolute left-1/2 inset-y-0 -translate-x-1/2 \r\n                        flex justify-center items-center \r\n                        md:w-[400px] w-full bg-black/90 z-20\"\r\n                onMouseDown={(e) => {\r\n                    e.stopPropagation()\r\n                }}\r\n            >   \r\n                {isRecieve \r\n                ?(\r\n                    <div \r\n                    className=\" bg-white/10 rounded-xl p-3\r\n                    \">\r\n                        <button\r\n                          onClick={() => {\r\n                            routeTo(userId)\r\n                            setRightPanelOpen(false)\r\n                          }}\r\n                        >\r\n                            Ответить, {`${userId}`}\r\n                        </button>\r\n                    </div>\r\n                ):(\r\n                    <form   \r\n                        className=\"relative flex flex-col w-full justify-center items-center\"\r\n                        onSubmit={(e) => {\r\n                            e.preventDefault()\r\n                        }}\r\n                        >\r\n\r\n                        {/* помощь с выбором кому написать */}\r\n                        {to === null && (\r\n                          <div \r\n                            className={`absolute bottom-full flex items-center justify-start flex-col rounded-md\r\n                                      overflow-y-auto gap-1\r\n                                      w-1/2 mb-10 transition-all duration-300 ease-in-out\r\n                                      ${isMsgMenuOpen ? \"opacity-100 h-20\" : \" h-0 opacity-0\"}\r\n                            `}\r\n                          >\r\n                            {dialogs.map((d,index) => (\r\n                              <button\r\n                                key={index}\r\n                                className=\"p-1 w-full \r\n                                bg-linear-to-br from-white/5 to-white/9 border-b border-white/20 backdrop-blur-md\r\n                                rounded-full shadow-2xl\r\n                                hover:from-white/10 hover:to-white/20\r\n                                \"\r\n                                onClick={(e) => {\r\n                                  setInputValue(d.to_display_id)\r\n                                }}\r\n                              >\r\n                                {d.to_display_id}\r\n                              </button>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                        {/* ----- */}\r\n\r\n                        <div className=\"relative w-full flexC\">\r\n                            <input\r\n                                ref={idRef}\r\n                                value={inputValue}\r\n                                onChange={(e) => setInputValue(e.target.value)}\r\n                                onBlur={() => {setUserId(inputValue)}}\r\n                                disabled={isReply}\r\n                                type=\"text\"\r\n                                placeholder=\"ID кисы\"\r\n                                className={`p-2 mb-4 w-1/2 bg-white/10 border rounded-md text-white\r\n                                        ${isReply && \"opacity-50\"}\r\n                                        ${userError && \"border-red-500\"}\r\n                                `}\r\n                            >\r\n                            </input>\r\n                            {to === null && (\r\n                              <button\r\n                                className=\"absolute left-1/2 bottom-full -translate-x-1/2\r\n                                bg-white/10 h-2 w-10 rounded-t-2xl p-2\r\n                                flexC\r\n                                \"\r\n                                onClick={() =>{setIsMsgMenuOpen(prev => !prev)}}\r\n                              >\r\n                                ...\r\n                              </button>\r\n                            )}\r\n                        </div>\r\n\r\n                        {userError && (\r\n                          <p className=\"text-red-400 text-xs mb-3\">\r\n                            {userError}\r\n                          </p>\r\n                        )}\r\n\r\n                        <div className=\"flex w-full justify-center items-center\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                ref={anonRef}\r\n                                checked={anonState.isAnon}\r\n                                disabled={!anonState.canToggle}\r\n                                onChange={(e) => setAnonState(e.target.checked)}\r\n                                className=\"bg-white/10 border rounded-md text-white\"\r\n                            />\r\n                            <span className=\"text-[10px]\">\r\n                                {anonState.canToggle\r\n                                  ? \"Будешь анонимен? (только 1 раз)\"\r\n                                  : \"Анонимность уже использована\"\r\n                                }\r\n                            </span>\r\n                        </div>\r\n\r\n                        <button\r\n                            type=\"submit\"\r\n                            className={`p-2 mt-4 border rounded-2xl transition-all duration-200\r\n                                ${userError ? \"opacity-50 cursor-not-allowed\" : \"hover:bg-white/20\"}\r\n                            `}                            \r\n                            onClick={handleSendMessage}\r\n                            disabled={!!userError}\r\n                        >\r\n                            Отправить\r\n                        </button>\r\n\r\n                    </form>\r\n                )}\r\n                        <button \r\n                            className=\"absolute bottom-0 w-20 bg-white/20 rounded-t-full \r\n                            hover:bg-white/40 transition-all duration-200\r\n                            flex justify-center items-center\r\n                            \"\r\n                            onClick={() => setRightPanelOpen(false)}\r\n                        >\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" transform=\"rotate(180)\"><path fill=\"currentColor\" d=\"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\"/></svg>\r\n                        </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1146, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/checkMobile.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\nexport function useCheckMobile(breakPoint = 768) {\r\n    const [isMobile, setIsMobile] = useState(false)\r\n\r\n    useEffect(() => {\r\n        const check = () => {\r\n            setIsMobile(window.innerWidth <= 768)\r\n        }\r\n        check()\r\n        window.addEventListener('resize', check)\r\n        return () => window.removeEventListener('resize', check)\r\n    },[breakPoint])\r\n\r\n    return isMobile\r\n}"],"names":[],"mappings":";;;;AAAA;;;AAEO,SAAS,eAAe,aAAa,GAAG;;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,IAAA,0KAAS;oCAAC;YACN,MAAM;kDAAQ;oBACV,YAAY,OAAO,UAAU,IAAI;gBACrC;;YACA;YACA,OAAO,gBAAgB,CAAC,UAAU;YAClC;4CAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;;QACtD;mCAAE;QAAC;KAAW;IAEd,OAAO;AACX;GAbgB"}},
    {"offset": {"line": 1182, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/components/Redactor.tsx"],"sourcesContent":["\r\nimport { useState, useEffect, useRef } from \"react\"\r\nimport { Item } from \"../../things/types/type\"\r\nimport { useCheckMobile } from \"../../things/hooks/checkMobile\"\r\n\r\nexport type ItemPatch = Partial<{\r\n    content: string\r\n    fontSize: number\r\n    color: string\r\n    rotation: number\r\n}>\r\n\r\ntype RedactorProps = {\r\n    item: Item | null\r\n    items: Item[]\r\n    isOpen: boolean\r\n    open: (v: boolean) => void\r\n\r\n    onChange: (id: Item[\"id\"], patch: ItemPatch) => void\r\n\r\n}\r\n\r\nfunction formatNumber(value?: number, digits = 1) {\r\n    if (value == null || Number.isNaN(value)) return \"\"\r\n    return value.toFixed(digits).replace(/\\.0+$/, \"\")\r\n}\r\nconst normalizeNumber = (v: string) =>\r\n    v.replace(\",\", \".\").replace(/[^0-9.-]/g, \"\")\r\n\r\nexport function Redactor({\r\n    item,\r\n    items,\r\n    isOpen,\r\n    open,\r\n\r\n    onChange\r\n}:RedactorProps\r\n) {\r\n    const isMobile = useCheckMobile()\r\n\r\n    const [text,setText] = useState('')\r\n    const [size, setSize] = useState('')\r\n    const [color, setColor] = useState<string>('#000000')\r\n    const [rotation, setRotation] = useState('')\r\n    useEffect(() => {\r\n        if(!item){\r\n            open(false)\r\n        }\r\n\r\n        if (item?.type==='text') {\r\n            setSize(formatNumber(item.fontSize, 1))\r\n            setColor(item.color ?? \"#000000\")\r\n            setRotation(formatNumber(radToDeg(item.rotation ?? 0)))\r\n            setText(item.content)\r\n        } \r\n    }, [item])\r\n\r\n    const inputStyle = `\r\n  w-14 px-2 py-1\r\n  text-sm font-mono text-white\r\n  bg-white/15 rounded-md\r\n  outline-none\r\n  focus:bg-white/25 focus:ring-1 focus:ring-white/40\r\n`\r\n\r\n\r\n    const panelRef = useRef<HTMLDivElement>(null)\r\n    const startX = useRef(0)\r\n    const startW = useRef(300)\r\n    const handleChangeOpen = (e: React.MouseEvent | React.TouchEvent) => {\r\n        const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX\r\n        startX.current = clientX\r\n        startW.current = panelRef.current?.offsetWidth ?? 300\r\n\r\n        window.addEventListener('mousemove', handleMouseMove)\r\n        window.addEventListener('mouseup', handleMouseUp)\r\n        window.addEventListener('touchmove', handleMouseMove)\r\n        window.addEventListener('touchend', handleMouseUp)\r\n    }\r\n    const handleMouseMove = (e: MouseEvent | TouchEvent) => {\r\n        const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX\r\n\r\n        if (!panelRef.current) return\r\n\r\n        const delta = startX.current - clientX\r\n        const newWidth = Math.min(\r\n            500,\r\n            Math.max(100,startW.current + delta)\r\n        )\r\n        \r\n        panelRef.current.style.width = `${newWidth}px`\r\n    }\r\n    const handleMouseUp = () => {\r\n        window.removeEventListener('mousemove', handleMouseMove)\r\n        window.removeEventListener('mouseup', handleMouseUp)\r\n        window.removeEventListener('touchmove', handleMouseMove)\r\n        window.removeEventListener('touchend', handleMouseUp)\r\n    }\r\n       \r\n    const radToDeg = (rad: number) => rad * 180 / Math.PI\r\n    const degToRad = (deg: number) => deg * Math.PI / 180\r\n    const rotateItem = (side: string) => {\r\n        if (!item) return\r\n\r\n        const currentDeg = Number(rotation) || 0\r\n        const nextdeg = side === 'left'\r\n        ? currentDeg - 90\r\n        : currentDeg + 90\r\n        setRotation(formatNumber(nextdeg))\r\n            onChange(item!.id, { rotation: degToRad(nextdeg) })\r\n        \r\n    }\r\n\r\n    return (\r\n    <div className=\"z-50\">\r\n        {/* panel */}\r\n        <div\r\n            ref={panelRef}\r\n            className={`absolute right-0 top-0\r\n                bg-linear-to-b from-black/30 to-black-40 shadow-2xl border border-white/10\r\n                z-50 transition-transform rounded-l-2xl\r\n                ${isOpen ? \"traslate-x-0 \" : \"translate-x-full \"}\r\n            `}\r\n            style={{width: 300}}\r\n        >\r\n            <div className=\"relative w-full h-full flex justify-center p-2\">\r\n\r\n                <div className=\"flex flex-col gap-2 p-4\">\r\n\r\n                    {/* text */}\r\n                    <div className=\"flex items-center justify-between w-full\">\r\n                        <div className=\"flex items-center\">\r\n                        <input\r\n                            type=\"text\"\r\n                            className={`${inputStyle} w-full`}\r\n                            value={text}\r\n                            onChange={(e) => setText(e.target.value)}\r\n                            onBlur={() =>\r\n                            item && onChange(item.id, { content: String(text) })\r\n                            }\r\n                            onKeyDown={(e) => {\r\n                                if(e.key === 'Enter'){\r\n                                    item && onChange(item.id, { content: String(text) })\r\n                                    \r\n                                }\r\n                            }}\r\n                        />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Font size */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs text-white/60\">Size</span>\r\n                        <div className=\"flex items-center gap-1\">\r\n                        <input\r\n                            type=\"text\"\r\n                            className={inputStyle}\r\n                            value={size}\r\n                            onChange={(e) => setSize(normalizeNumber(e.target.value))}\r\n                            onBlur={() =>\r\n                            item && onChange(item.id, { fontSize: Number(size) })\r\n                            }\r\n                        />\r\n                        <span className=\"text-xs text-white/40\">px</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Color */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs text-white/60\">Color</span>\r\n                        <input\r\n                            type=\"color\"\r\n                            value={color}\r\n                            className=\"w-8 h-8 rounded-md bg-transparent cursor-pointer\"\r\n                            onChange={(e) => {\r\n                                setColor(e.target.value);\r\n                                item && onChange(item.id, { color: e.target.value });\r\n                            }}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Rotation */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs text-white/60\">Rotate</span>\r\n                        <input\r\n                            type=\"text\"\r\n                            className={inputStyle}\r\n                            value={rotation}\r\n                            onChange={(e) => setRotation(normalizeNumber(e.target.value))}\r\n                            onBlur={() =>{\r\n                                if(!item) return\r\n                                const deg = Number(rotation)\r\n                                if(Number.isNaN(deg)) return\r\n                                onChange(item.id, { rotation: degToRad(deg) })\r\n                            }}\r\n                        />\r\n                        <button onClick={() => rotateItem('left')} className=\"text-xs text-white/40\">{`<`}</button>\r\n                        <button onClick={() => rotateItem('right')} className=\"text-xs text-white/40\">{`>`}</button>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n\r\n                {/* close trigger */}\r\n                <div \r\n                    className=\"\r\n                    absolute left-0 top-1/2 -translate-y-1/2\r\n                    h-16 w-2 rounded-full\r\n                    bg-white/20 hover:bg-white/40\r\n                    cursor-ew-resize transition\r\n                \"\r\n                    onDoubleClick={() => open(false)}\r\n                    onClick={() => {\r\n                        if(isMobile) open(false)\r\n                    }}\r\n                    onMouseDown={handleChangeOpen}\r\n                    onTouchStart={handleChangeOpen}\r\n                    \r\n                />\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n    )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1498, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/useItemInteractions.ts"],"sourcesContent":["import { Item, Viewport } from \"../things/types/type\"\r\nimport { useRef }from \"react\"\r\n\r\ntype ResizeDirection = \"horizontal\" | \"top\" | \"bottom\" | \"diagonal\"\r\n\r\ntype DragRef = {\r\n    id: number | null\r\n    offsetX: number\r\n    offsetY: number\r\n    w: number\r\n    h: number\r\n}\r\n\r\ntype ResizeRef = {\r\n    id: number | null\r\n    startX: number\r\n    startY: number\r\n    startW: number\r\n    startH: number\r\n    fontSize?: number\r\n    rotate?: number\r\n    cx?: number\r\n    cy?: number\r\n    startAngle?: number\r\n    direction: ResizeDirection\r\n}\r\n\r\n\r\n\r\nexport const userItemInteractions = (\r\n    items: Item[], \r\n    setItems: React.Dispatch<React.SetStateAction<Item[]>>, \r\n    fieldRef: React.RefObject<HTMLDivElement | null>,\r\n\r\n    setViewport: React.Dispatch<React.SetStateAction<Viewport>>,\r\n    viewport: Viewport\r\n) => {\r\n    const dragRef = useRef<DragRef>({id: null, offsetX: 0, offsetY: 0, w: 0, h: 0})\r\n    const resizeRef = useRef<ResizeRef>({id: null, startX: 0, startY: 0, startW: 0, startH: 0, fontSize: 0,rotate: 0, direction: \"horizontal\"})\r\n    const touchDistanceRef = useRef<number | null>(null)\r\n\r\n    function screenToCanvas(\r\n        clientX: number,\r\n        clientY: number,\r\n        rect: DOMRect,\r\n        viewport: Viewport\r\n    ){\r\n        const mx = clientX - rect.left - rect.width / 2\r\n        const my = clientY - rect.top - rect.height / 2\r\n        const cx = (mx - viewport.offsetX) / viewport.scale\r\n        const cy = (my - viewport.offsetY) / viewport.scale\r\n\r\n        return {\r\n            x: cx + 400,\r\n            y: cy + 300\r\n        }\r\n    }\r\n\r\n    function getTouchCoordinates(e: TouchEvent): { clientX: number; clientY: number } | null {\r\n        if (e.touches.length === 0) return null\r\n        const touch = e.touches[0]\r\n        return { clientX: touch.clientX, clientY: touch.clientY }\r\n    }\r\n    \r\n    const startDrag = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item) => {\r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if ('touches' in e) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const pos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        dragRef.current = {\r\n            id: item.id,\r\n            offsetX: pos.x - item.x,\r\n            offsetY: pos.y - item.y,\r\n            w: item.w,\r\n            h: item.h\r\n        }\r\n\r\n        window.addEventListener('mousemove', onDragMove)\r\n        window.addEventListener('mouseup', stopDrag)\r\n        window.addEventListener('touchmove', onDragMove as any)\r\n        window.addEventListener('touchend', stopDrag)\r\n    }\r\n    const onDragMove = (e: MouseEvent | TouchEvent) => {\r\n        if(resizeRef.current.id !== null) return;\r\n\r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        const drag = dragRef.current\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if (e instanceof TouchEvent) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const pos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        if (drag.id === null) return;\r\n\r\n        setItems(prev => prev.map(it => it.id === drag.id \r\n            ? {...it, \r\n                x: pos.x - drag.offsetX, \r\n                y: pos.y - drag.offsetY \r\n            } \r\n            : it))\r\n    }\r\n    const stopDrag = () => {\r\n        dragRef.current.id = null\r\n        window.removeEventListener('mousemove', onDragMove)\r\n        window.removeEventListener('mouseup', stopDrag)\r\n        window.removeEventListener('touchmove', onDragMove as any)\r\n        window.removeEventListener('touchend', stopDrag)\r\n    }\r\n\r\n\r\n    //resize\r\n    const startResize = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item, direction: ResizeDirection) => {\r\n        e.stopPropagation()\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if ('touches' in e) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        const canvasPos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        const cx = item.x + item.w/2\r\n        const cy = item.y + item.h/2\r\n        \r\n        resizeRef.current = {\r\n            id: item.id,\r\n            startX: clientX,\r\n            startY: clientY,\r\n            startW: item.w,\r\n            startH: item.h,\r\n            cx: cx,\r\n            cy: cy,\r\n            startAngle: Math.atan2(canvasPos.y - cy, canvasPos.x - cx),\r\n            fontSize: item.type === 'text' ? item.fontSize : undefined,\r\n            rotate: item.rotation,\r\n            direction: direction\r\n        }\r\n        window.addEventListener('mousemove', onResizeMove)\r\n        window.addEventListener('mouseup', stopResize)\r\n        window.addEventListener('touchmove', onResizeMove as any)\r\n        window.addEventListener('touchend', stopResize)\r\n    }\r\n\r\n    const onResizeMove = (e: MouseEvent | TouchEvent) => {\r\n        const r = resizeRef.current\r\n        if (r.id === null) return;\r\n\r\n        let clientX: number, clientY: number\r\n        \r\n        if (e instanceof TouchEvent) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n\r\n        const dx = (clientX - r.startX) / viewport.scale\r\n        const dy = (clientY - r.startY) / viewport.scale\r\n\r\n        let w = r.startW\r\n        let h = r.startH\r\n        let fontSize = r.fontSize\r\n        let newX = undefined as number | undefined\r\n        let newY = undefined as number | undefined\r\n        let rotation = undefined as number | undefined\r\n\r\n        if (r.direction === \"horizontal\") {\r\n            w = Math.max(50, r.startW + dx);\r\n        }\r\n        if(r.direction === \"top\") {\r\n            h = Math.max(30, r.startH + dy);\r\n        }\r\n        if (r.direction === \"bottom\") {\r\n            h = Math.max(30, r.startH + dy);\r\n        }\r\n        if (r.direction === \"diagonal\") {\r\n            const rect = fieldRef!.current!.getBoundingClientRect()\r\n            const mousePos = screenToCanvas(clientX, clientY, rect, viewport)\r\n\r\n            const currentAngle = Math.atan2(mousePos.y - r.cy!, mousePos.x - r.cx!)\r\n            rotation = r.rotate! + (currentAngle - r.startAngle!)\r\n\r\n            const newDist = Math.sqrt((mousePos.x - r.cx!)**2 + (mousePos.y - r.cy!)**2)\r\n            const oldDist = Math.sqrt((r.startW/2)**2 + (r.startH/2)**2)\r\n\r\n            const scale = newDist / oldDist\r\n    \r\n            w = Math.max(50, r.startW * scale)\r\n            h = Math.max(30, r.startH * scale)\r\n            fontSize = Math.max(8, r.fontSize! * scale)\r\n            \r\n            // Центр остается на месте\r\n            newX = r.cx! - w/2\r\n            newY = r.cy! - h/2\r\n        }\r\n        // console.log(\"resize direction:\", r.direction, \"w:\", w, \"h:\", h, \"fontSize:\", fontSize)\r\n        setItems(prev => prev.map(it => \r\n            it.id === r.id \r\n                ? {\r\n                    ...it, \r\n                    w, \r\n                    h, \r\n                    fontSize, \r\n                    rotation: rotation !== undefined ? rotation : it.rotation, \r\n                    x: newX || it.x, \r\n                    y: newY || it.y\r\n                } \r\n                : it\r\n        ))\r\n    }\r\n\r\n    const stopResize = () => {\r\n        resizeRef.current.id = null\r\n        window.removeEventListener('mousemove', onResizeMove)\r\n        window.removeEventListener('mouseup', stopResize)\r\n        window.removeEventListener('touchmove', onResizeMove as any)\r\n        window.removeEventListener('touchend', stopResize)\r\n    }\r\n\r\n\r\n    //delete\r\n    const deleteItem = (item: Item) => {\r\n        setItems(prev => prev.filter(it => it.id !== item.id))\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    const clamp = (v: number, min: number, max: number) =>\r\n        Math.min(max, Math.max(min, v))\r\n\r\n    const lerp = (a: number, b: number, t: number) =>\r\n        a + (b - a) * t\r\n\r\n    //zoom\r\n    const handleZoom = (e: React.WheelEvent<HTMLDivElement>) => {\r\n        const rect = fieldRef.current!.getBoundingClientRect();\r\n        const mouseX = e.clientX - rect.left - rect.width /2;\r\n        const mouseY = e.clientY - rect.top - rect.height /2;\r\n\r\n        setViewport(v => {\r\n            const oldScale = v.scale;\r\n            const newScale = clamp(oldScale - e.deltaY * 0.001, 0.1, 3)\r\n            const scaleFactor = newScale / oldScale;\r\n\r\n            let nextOffsetX = mouseX - (mouseX - v.offsetX) * scaleFactor;\r\n            let nextOffsetY = mouseY - (mouseY - v.offsetY) * scaleFactor;\r\n\r\n            if (newScale <= 1){\r\n                const t = 1 - newScale\r\n                nextOffsetX = nextOffsetX * (1 - t)\r\n                nextOffsetY = nextOffsetY * (1 - t)\r\n            }\r\n            \r\n            return {\r\n            scale: newScale,\r\n            offsetX: nextOffsetX,\r\n            offsetY: nextOffsetY\r\n            };\r\n        });\r\n    };\r\n\r\n    const getDistanceBetweenTouches = (touch1: Touch, touch2: Touch): number => {\r\n        const dx = touch1.clientX - touch2.clientX\r\n        const dy = touch1.clientY - touch2.clientY\r\n        return Math.sqrt(dx * dx + dy * dy)\r\n    }\r\n    const handleTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2) {\r\n            touchDistanceRef.current = getDistanceBetweenTouches(e.touches[0] as Touch, e.touches[1] as Touch)\r\n            startTouchPan(e)\r\n        }\r\n    }\r\n    const handleTouchMove = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2 && touchDistanceRef.current !== null) {\r\n            e.preventDefault()\r\n            const currentDistance = getDistanceBetweenTouches(e.touches[0] as Touch, e.touches[1] as Touch)\r\n            const distanceDelta = currentDistance - touchDistanceRef.current\r\n            \r\n            setViewport(v => ({\r\n                ...v,\r\n                scale: Math.min(3, Math.max(0.3, v.scale + distanceDelta * 0.01))\r\n            }))\r\n            \r\n            touchDistanceRef.current = currentDistance\r\n        }\r\n        \r\n        // Pan для двух пальцев\r\n        onTouchPanMove(e)\r\n    }\r\n    const handleTouchEnd = () => {\r\n        touchDistanceRef.current = null\r\n        stopTouchPan()\r\n    }\r\n    const zoomHandlers = {\r\n        onWheel: handleZoom,\r\n        onTouchStart: handleTouchStart,\r\n        onTouchMove: handleTouchMove,\r\n        onTouchEnd: handleTouchEnd\r\n    }\r\n\r\n\r\n\r\n    const panRef = useRef({\r\n        startX: 0, startY: 0, startOffsetX: 0, startOffsetY: 0\r\n    })\r\n    const isPanning = useRef(false)\r\n    const panTouchRef = useRef({\r\n        startX: 0, startY: 0, startOffsetX: 0, startOffsetY: 0\r\n    })\r\n    const isPanningTouch = useRef(false)\r\n\r\n    const clampOffset = (offsetX: number, offsetY: number, scale: number) => {\r\n        // Ограничиваем только когда отдалено (scale < 1)\r\n        if (scale >= 1) {\r\n            return { offsetX, offsetY }\r\n        }\r\n        \r\n        const maxOffset = 400 * (1 - scale);\r\n        \r\n        return {\r\n            offsetX: clamp(offsetX, -maxOffset, maxOffset),\r\n            offsetY: clamp(offsetY, -maxOffset, maxOffset)\r\n        }\r\n    }\r\n\r\n    const startPan = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        if(e.button === 0 && e.ctrlKey){\r\n            e.preventDefault()\r\n            isPanning.current = true\r\n            panRef.current = {\r\n                startX: e.clientX,\r\n                startY: e.clientY,\r\n                startOffsetX: viewport.offsetX,\r\n                startOffsetY: viewport.offsetY\r\n            }\r\n            window.addEventListener(\"mousemove\", onPanMove)\r\n            window.addEventListener(\"mouseup\", stopPan)\r\n        }\r\n    } \r\n    const onPanMove = (e: MouseEvent) => {\r\n        if (!isPanning.current) return\r\n        const dx = e.clientX - panRef.current.startX\r\n        const dy = e.clientY - panRef.current.startY\r\n        \r\n\r\n        setViewport(v => {\r\n            const nextOffsetX = panRef.current.startOffsetX + dx\r\n            const nextOffsetY = panRef.current.startOffsetY + dy\r\n            const clamped = clampOffset(nextOffsetX, nextOffsetY, v.scale)\r\n            \r\n            return {\r\n                ...v,\r\n                offsetX: clamped.offsetX,\r\n                offsetY: clamped.offsetY\r\n            }\r\n        })\r\n        \r\n    }\r\n\r\n    const stopPan = () => {\r\n        isPanning.current = false\r\n        window.removeEventListener(\"mousemove\", onPanMove)\r\n        window.removeEventListener(\"mouseup\", stopPan)\r\n    }\r\n\r\n    // Touch Pan (два пальца)\r\n    const startTouchPan = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2) {\r\n            isPanningTouch.current = true\r\n            panTouchRef.current = {\r\n                startX: (e.touches[0].clientX + e.touches[1].clientX) / 2,\r\n                startY: (e.touches[0].clientY + e.touches[1].clientY) / 2,\r\n                startOffsetX: viewport.offsetX,\r\n                startOffsetY: viewport.offsetY\r\n            }\r\n        }\r\n    }\r\n\r\n    const onTouchPanMove = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (!isPanningTouch.current || e.touches.length !== 2) return\r\n        \r\n        e.preventDefault()\r\n        const dx = (e.touches[0].clientX + e.touches[1].clientX) / 2 - panTouchRef.current.startX\r\n        const dy = (e.touches[0].clientY + e.touches[1].clientY) / 2 - panTouchRef.current.startY\r\n\r\n        setViewport(v => {\r\n            const nextOffsetX = panTouchRef.current.startOffsetX + dx\r\n            const nextOffsetY = panTouchRef.current.startOffsetY + dy\r\n            const clamped = clampOffset(nextOffsetX, nextOffsetY, v.scale)\r\n            \r\n            return {\r\n                ...v,\r\n                offsetX: clamped.offsetX,\r\n                offsetY: clamped.offsetY\r\n            }\r\n        })\r\n    }\r\n\r\n    const stopTouchPan = () => {\r\n        isPanningTouch.current = false\r\n    }\r\n\r\n\r\n\r\n    return {startDrag, startResize, deleteItem, zoomHandlers, startPan}\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1864, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/btnFunction.ts"],"sourcesContent":["\r\nimport { Item, TextItem, GifItem } from \"../things/types/type\"\r\n\r\nexport const createText = (index: number): TextItem => ({\r\n            id: index,\r\n            type: \"text\",\r\n            content: `new text ${index + 1}`,\r\n            x: 0 ,\r\n            y: 0 + index * 20,\r\n            w: 100,\r\n            h: 50,\r\n            fontSize: 16,\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            rotation: 0,\r\n            isEditing: 'none'\r\n    })\r\n\r\nexport const insertGif = (index: number, src: string): GifItem => ({\r\n            id: index,\r\n            type: \"gif\",\r\n            src,\r\n            x: 0,\r\n            y: 0 + index * 20,\r\n            w: 100,\r\n            h: 100,\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            rotation: 0,\r\n            autoplay: true,\r\n            loop: true\r\n})"],"names":[],"mappings":";;;;;;AAGO,MAAM,aAAa,CAAC,QAA4B,CAAC;QAC5C,IAAI;QACJ,MAAM;QACN,SAAS,CAAC,SAAS,EAAE,QAAQ,GAAG;QAChC,GAAG;QACH,GAAG,IAAI,QAAQ;QACf,GAAG;QACH,GAAG;QACH,UAAU;QACV,QAAQ;QACR,QAAQ;QACR,UAAU;QACV,WAAW;IACnB,CAAC;AAEE,MAAM,YAAY,CAAC,OAAe,MAAyB,CAAC;QACvD,IAAI;QACJ,MAAM;QACN;QACA,GAAG;QACH,GAAG,IAAI,QAAQ;QACf,GAAG;QACH,GAAG;QACH,QAAQ;QACR,QAAQ;QACR,UAAU;QACV,UAAU;QACV,MAAM;IAClB,CAAC"}},
    {"offset": {"line": 1905, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/useklipy.ts"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\n\r\nexport function useklipySearch(query: string, apiKey: string, perPage = 24) {\r\n    const [resultsGif, setResults] = useState<string[]>([]);\r\n    const [loadingGif, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if(!query.trim()) {\r\n            setResults([]);\r\n            return\r\n        }\r\n\r\n        const controller = new AbortController()\r\n        setLoading(true)\r\n\r\n        const fetchGifs = async () => {\r\n            try {\r\n                const res = await fetch(\r\n                    `https://api.klipy.com/api/v1/${apiKey}/gifs/search?q=${encodeURIComponent(query)}&per_page=${perPage}&locale=ru`,\r\n                    {\r\n                        headers: {\r\n                            \"X-KLIPY-API-KEY\": apiKey\r\n                        },\r\n                        signal: controller.signal\r\n                    }\r\n                )\r\n                const json = await res.json()\r\n                const urls = (json.data?.data || []).map((item: any) => {\r\n                    return item.file?.xs.gif.url\r\n                }).filter(Boolean);\r\n                \r\n                // console.log(urls)\r\n                setResults(urls)\r\n            } catch (err){\r\n                if ((err as any).name !== \"AbortError\") {\r\n                    console.error(err)\r\n                }\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n\r\n        fetchGifs()\r\n\r\n        return () => {\r\n            controller.abort()\r\n        }\r\n    },[query, apiKey, perPage])\r\n\r\n    return {resultsGif, loadingGif}\r\n}"],"names":[],"mappings":";;;;AAAA;;;AAEO,SAAS,eAAe,KAAa,EAAE,MAAc,EAAE,UAAU,EAAE;;IACtE,MAAM,CAAC,YAAY,WAAW,GAAG,IAAA,yKAAQ,EAAW,EAAE;IACtD,MAAM,CAAC,YAAY,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAE1C,IAAA,0KAAS;oCAAC;YACN,IAAG,CAAC,MAAM,IAAI,IAAI;gBACd,WAAW,EAAE;gBACb;YACJ;YAEA,MAAM,aAAa,IAAI;YACvB,WAAW;YAEX,MAAM;sDAAY;oBACd,IAAI;wBACA,MAAM,MAAM,MAAM,MACd,CAAC,6BAA6B,EAAE,OAAO,eAAe,EAAE,mBAAmB,OAAO,UAAU,EAAE,QAAQ,UAAU,CAAC,EACjH;4BACI,SAAS;gCACL,mBAAmB;4BACvB;4BACA,QAAQ,WAAW,MAAM;wBAC7B;wBAEJ,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,MAAM,OAAO,CAAC,KAAK,IAAI,EAAE,QAAQ,EAAE,EAAE,GAAG;uEAAC,CAAC;gCACtC,OAAO,KAAK,IAAI,EAAE,GAAG,IAAI;4BAC7B;sEAAG,MAAM,CAAC;wBAEV,oBAAoB;wBACpB,WAAW;oBACf,EAAE,OAAO,KAAI;wBACT,IAAI,AAAC,IAAY,IAAI,KAAK,cAAc;4BACpC,QAAQ,KAAK,CAAC;wBAClB;oBACJ,SAAU;wBACN,WAAW;oBACf;gBACJ;;YAEA;YAEA;4CAAO;oBACH,WAAW,KAAK;gBACpB;;QACJ;mCAAE;QAAC;QAAO;QAAQ;KAAQ;IAE1B,OAAO;QAAC;QAAY;IAAU;AAClC;GAhDgB"}},
    {"offset": {"line": 1975, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/things/hooks/useClickOutside.ts"],"sourcesContent":["import { useEffect } from \"react\";\r\n\r\nexport function useClickOutside(\r\n    ref: React.RefObject<HTMLElement>,\r\n    handler: () => void\r\n) {\r\n    useEffect(() => {\r\n        const listener = (e: MouseEvent | TouchEvent) => {\r\n            if(!ref.current) return\r\n            if(ref.current.contains(e.target as Node)) return\r\n            handler()\r\n        }\r\n\r\n        document.addEventListener(\"mousedown\", listener)\r\n        document.addEventListener(\"touchstart\", listener)\r\n\r\n        return () => {\r\n            document.removeEventListener(\"mousedown\", listener)\r\n            document.removeEventListener(\"touchstart\", listener)\r\n        }\r\n    },[ref, handler])\r\n}"],"names":[],"mappings":";;;;AAAA;;;AAEO,SAAS,gBACZ,GAAiC,EACjC,OAAmB;;IAEnB,IAAA,0KAAS;qCAAC;YACN,MAAM;sDAAW,CAAC;oBACd,IAAG,CAAC,IAAI,OAAO,EAAE;oBACjB,IAAG,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAW;oBAC3C;gBACJ;;YAEA,SAAS,gBAAgB,CAAC,aAAa;YACvC,SAAS,gBAAgB,CAAC,cAAc;YAExC;6CAAO;oBACH,SAAS,mBAAmB,CAAC,aAAa;oBAC1C,SAAS,mBAAmB,CAAC,cAAc;gBAC/C;;QACJ;oCAAE;QAAC;QAAK;KAAQ;AACpB;GAnBgB"}},
    {"offset": {"line": 2015, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/components/CreateBtns.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useRef } from \"react\"\r\nimport { Item } from \"../../things/types/type\"\r\nimport { createText, insertGif } from \"../btnFunction\"\r\nimport { useklipySearch } from \"../../things/hooks/useklipy\"\r\nimport { useClickOutside } from \"../../things/hooks/useClickOutside\"\r\nimport { useCheckMobile } from \"../../things/hooks/checkMobile\"\r\n\r\ntype BtnProps = {\r\n    setItems: React.Dispatch<React.SetStateAction<Item[]>>\r\n}\r\n\r\nexport function CreateBtns({\r\n    setItems\r\n}: BtnProps) {\r\n    const ref = useRef<HTMLDivElement>(null!)\r\n    useClickOutside(ref, () => {setOpen(false); setQuery('')})\r\n    const isMobil = useCheckMobile()\r\n\r\n    const [query, setQuery] = useState('')\r\n    const [isOpen, setOpen] = useState(false)\r\n    const [gifPerPage, setGifPerPage] = useState(24)\r\n    const {resultsGif, loadingGif} = useklipySearch(query, 'pF3P65Wzij6l78j3fDut9DS0h2Ek0UxktVVcLmTCUmdcvsbECRLYJHzZxDaBO1WH', gifPerPage)\r\n\r\n    const inputRef = useRef<HTMLInputElement>(null)\r\n\r\n    const addText = () => {\r\n        setItems(prev => [...prev, createText(prev.length)])\r\n    }\r\n    \r\n    const addGif = (src: string) => {\r\n        setItems(prev => [...prev, insertGif(prev.length, src)])\r\n        setQuery('')\r\n        setOpen(false)\r\n    }\r\n\r\n    const handleGifButtonClick = () => {\r\n        if (!isOpen) {\r\n            setOpen(true)\r\n            setTimeout(() => inputRef.current?.focus(), 100)\r\n        } else if (query) {\r\n            addGif(query)\r\n            setQuery(\"\")\r\n            setOpen(false)\r\n        } else {\r\n            setOpen(false)\r\n        }\r\n    }\r\n\r\n    const isMobilWH = `${isMobil ? 'w-10 h-10' : 'w-12 h-12'}`\r\n\r\n    return(\r\n        <div\r\n            ref={ref} \r\n            className={`fixed bottom-6 left-1/2 -translate-x-1/2 z-50 transition-all duration-500 ease-out\r\n                ${isOpen ? 'w-auto' : 'w-auto'}\r\n            `}\r\n        >\r\n            {/* Поле гифок */}\r\n            <div \r\n                className={`absolute inset-x-0 bottom-full mb-3 overflow-hidden transition-all duration-300\r\n                    ${resultsGif.length > 0 && isOpen ? 'max-h-[100px] opacity-100' : 'max-h-0 opacity-0'}\r\n                `}\r\n            >\r\n                <div className=\"bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-2xl border border-white/20 p-2 shadow-2xl\">\r\n                    <div className=\"flex w-full h-20 overflow-x-auto gap-2 pb-2 no-scrollbar\">\r\n                        {resultsGif.map(url => (\r\n                            <img\r\n                                key={url}\r\n                                src={url}\r\n                                className=\" object-contain rounded-lg cursor-pointer hover:scale-105 hover:shadow-xl transition-all duration-200 flex-shrink-0 border border-white/10\"\r\n                                onClick={() => addGif(url)}\r\n                                alt=\"GIF\"\r\n                            />\r\n                        ))}\r\n                        {resultsGif.length !== 0 && (\r\n                            <button \r\n                                className=\"flex items-center justify-center px-4 flex-shrink-0 hover:bg-white/10 rounded-lg transition-all duration-200\"\r\n                                onClick={() => setGifPerPage(prev => prev + 24)}\r\n                            >\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" className=\"text-white/70\">\r\n                                    <path fill=\"currentColor\" d=\"M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z\"/>\r\n                                </svg>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            {/* Основная панель */}\r\n            <div className={`absolute bottom-0 left-1/2 -translate-x-1/2\r\n                    flex items-center bg-gradient-to-r from-white/15 to-white/10 backdrop-blur-2xl \r\n                    rounded-full border border-white/20 shadow-2xl p-2 gap-2\r\n                    transition-opacity duration-150\r\n                    ${isOpen ? 'opacity-0' : 'opacity-100'}\r\n                    `}\r\n            >\r\n                \r\n                {/* Кнопка текста */}\r\n                <button\r\n                    className={`relative flex items-center justify-center \r\n                         rounded-full bg-gradient-to-br \r\n                         from-white/20 to-white/10 border border-white/30 hover:from-white/30 hover:to-white/20 hover:scale-110 active:scale-95 \r\n                        transition-all duration-150 shadow-lg group \r\n                        ${isMobilWH}\r\n                    `}\r\n                    onClick={addText}\r\n                    disabled={isOpen}\r\n                >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-white\">\r\n                        <path d=\"M4 7V4h16v3M9 20h6M12 4v16\"/>\r\n                    </svg>\r\n                    <div className=\"absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-1 bg-black/80 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none\">\r\n                        Добавить текст\r\n                    </div>\r\n                </button>\r\n\r\n\r\n                {/* Кнопка GIF */}\r\n                <button\r\n                    className={`relative flex items-center justify-center rounded-full transition-all duration-300 shadow-lg group\r\n                        bg-gradient-to-br from-white/20 to-white/10 border border-white/30 hover:from-white/30 hover:to-white/20\r\n                        hover:scale-110 active:scale-95\r\n                        ${isMobilWH}\r\n                    `}\r\n                    onClick={handleGifButtonClick}\r\n                >\r\n                    \r\n                    <div className={`${isOpen ? 'opacity-0 w-0 overflow-hidden' : 'opacity-100'}`}>\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-white\">\r\n                            <rect x=\"2\" y=\"2\" width=\"20\" height=\"20\" rx=\"2.18\" ry=\"2.18\"/>\r\n                            <line x1=\"7\" y1=\"2\" x2=\"7\" y2=\"22\"/>\r\n                            <line x1=\"17\" y1=\"2\" x2=\"17\" y2=\"22\"/>\r\n                            <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"/>\r\n                            <line x1=\"2\" y1=\"7\" x2=\"7\" y2=\"7\"/>\r\n                            <line x1=\"2\" y1=\"17\" x2=\"7\" y2=\"17\"/>\r\n                            <line x1=\"17\" y1=\"17\" x2=\"22\" y2=\"17\"/>\r\n                            <line x1=\"17\" y1=\"7\" x2=\"22\" y2=\"7\"/>\r\n                        </svg>\r\n                    </div>\r\n\r\n                    <div className={`absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-1 bg-black/80 text-white text-xs rounded-lg transition-opacity whitespace-nowrap pointer-events-none\r\n                        ${isOpen ? 'opacity-0' : 'opacity-0 group-hover:opacity-100'}\r\n                    `}>\r\n                        Добавить GIF\r\n                    </div>\r\n\r\n                </button>\r\n\r\n            </div>\r\n\r\n\r\n            \r\n            {/* Поле ввода */}\r\n            <div className={`${isOpen ? 'flex' : 'hidden'}`}>\r\n                <input\r\n                    ref={inputRef}\r\n                    value={query}\r\n                    onChange={e => setQuery(e.target.value)}\r\n                    placeholder=\"Найти GIF...\"\r\n                    className={`p-2 bg-white/10 border \r\n                        border-white/20 rounded-full text-white placeholder-white/50 outline-none focus:border-white/40 focus:bg-white/15 \r\n                        transition-all duration-300 \r\n                        ${isOpen ? 'scale-x-100 opacity-100' : 'scale-x-0 opacity-0 pointer-events-none'}\r\n                    `}\r\n                    onKeyDown={(e) => {\r\n                        if(query && e.key === 'Enter') {\r\n                            addGif(query)\r\n                            setQuery(\"\")\r\n                            setOpen(false)\r\n                        }\r\n                        if(e.key === 'Escape') {\r\n                            setOpen(false)\r\n                            setQuery('')\r\n                        }\r\n                    }}\r\n                    />\r\n\r\n                <button\r\n                    className=\"flex items-center justify-center w-10 h-10 rounded-full transition-all duration-200 \r\n                                bg-gradient-to-br from-white/20 to-white/10 hover:bg-white/20 border border-white/20 \"\r\n                    onClick={() => {\r\n                        setOpen(false)\r\n                        setQuery('')\r\n                    }}\r\n                >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-white\">\r\n                        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\r\n                        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2442, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/components/canvas.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useMemo, useRef, useState } from \"react\"\r\nimport { Item, Viewport } from \"../../things/types/type\"\r\nimport { ItemPatch, Redactor } from \"./Redactor\"\r\nimport { userItemInteractions } from \"../useItemInteractions\"\r\nimport { CanvasItem } from \"./all\"\r\nimport { CreateBtns } from \"./CreateBtns\"\r\n\r\nconst CANVAS_W = 800\r\nconst CANVAS_H = 600\r\n\r\ntype CanvasProps = {\r\n    items: Item[]\r\n    setItems: React.Dispatch<React.SetStateAction<Item[]>>\r\n    canEdit: boolean\r\n    isRecieve: boolean\r\n}\r\n\r\nexport function Canvas({\r\n    items,\r\n    setItems,\r\n    canEdit,\r\n    isRecieve\r\n}: CanvasProps) {\r\n    const fieldRef = useRef<HTMLDivElement>(null)\r\n\r\n    const [viewport, setViewport] = useState<Viewport>({\r\n        scale: 1,\r\n        offsetX: 0,\r\n        offsetY: 0\r\n    })\r\n\r\n    useEffect(() => {\r\n        const getInitialScale = () => {\r\n            const availW = window.innerWidth - 32\r\n            const availH = window.innerHeight - 120\r\n            const scaleX = availW / 800\r\n            const scaleY = availH / 600\r\n            const initScale = Math.min(scaleX, scaleY, 1)\r\n\r\n            setViewport(v => ({\r\n                ...v,\r\n                scale: initScale\r\n            }))\r\n        }\r\n        getInitialScale()\r\n\r\n        window.addEventListener('resize', getInitialScale)\r\n        return () => window.removeEventListener('resize', getInitialScale)\r\n    }, [])\r\n\r\n    const [redactorOpen, setRedactorOpen] = useState(false)\r\n    const [selectedItemId, setSelectedItemId] = useState<number | null>(null) \r\n    const [ismenuTextOpen, setMenuTextOpen] = useState(false)\r\n    const selectedItem = useMemo(\r\n        () => items.find(item => item.id === selectedItemId) ?? null,\r\n        [items, selectedItemId]\r\n    )\r\n\r\n    const handleRedactorChange = (id: number, patch: ItemPatch) => {\r\n        setItems(prev => \r\n            prev.map(item =>\r\n                item.id === id \r\n                    ? {...item, ...patch}\r\n                    : item\r\n            )\r\n        )\r\n    }\r\n\r\n    const {startDrag, startResize, deleteItem, zoomHandlers, startPan} = userItemInteractions(\r\n        items, \r\n        setItems, \r\n        fieldRef, \r\n        setViewport,\r\n        viewport, \r\n    )\r\n\r\n    return (\r\n        <>\r\n            <div\r\n                ref={fieldRef}  \r\n                className={`relative w-full h-full overflow-hidden z-10 touch-none select-none\r\n                    `}\r\n                onMouseDown={(e) =>{\r\n                    if (e.button === 0 && e.ctrlKey){\r\n                        startPan(e)\r\n                        return\r\n                    }\r\n\r\n                    if(e.target !== e.currentTarget) return;\r\n                    setItems(prev => prev.map(it => ({...it, isSelected: false, isEditing: 'none'})))\r\n                    setRedactorOpen(false)\r\n                }}\r\n                {...zoomHandlers}\r\n            >\r\n                <div\r\n                    className=\"overflow-hidden\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        width: '800px',\r\n                        height: '600px',\r\n                        left: '50%',\r\n                        top: '50%',\r\n                        marginLeft: '-400px',\r\n                        marginTop: '-300px',\r\n                        transform: `translate(${viewport.offsetX}px, ${viewport.offsetY}px) scale(${viewport.scale})`,\r\n                        transformOrigin: 'center center',\r\n                        backgroundColor: 'white',\r\n                        borderRadius: '6px',\r\n                        boxShadow: '0 4px 24px rgba(0,0,0,0.15)',\r\n                    }}\r\n                        onMouseDown={(e) =>{\r\n                            if(e.target !== e.currentTarget) return;\r\n                            setItems(prev => prev.map(it => ({...it, isSelected: false, isEditing: 'none'})))\r\n                            setRedactorOpen(false)\r\n                        }}\r\n                >\r\n                    {items.map((item,i) => (\r\n                        <CanvasItem\r\n                            key={item.id}\r\n                            item={item}\r\n                            canEdit={canEdit}\r\n                            onSelect={id => setItems(prev =>\r\n                            prev.map(it => ({ ...it, isSelected: it.id === id }))\r\n                            )}\r\n                            onUpdate={(id, patch) => setItems(prev =>\r\n                            prev.map(it => (it.id === id ? { ...it, ...patch } : it))\r\n                            )}\r\n                            onDelete={item => setItems(prev => prev.filter(it => it.id !== item.id))}\r\n                            startDrag={startDrag}\r\n                            startResize={startResize}\r\n                            ismenuTextOpen={ismenuTextOpen}\r\n                            setMenuTextOpen={setMenuTextOpen}\r\n                            isLoading={false}\r\n                            setselectedItemId={setSelectedItemId}\r\n                            setOpenRedactor={setRedactorOpen}\r\n                        />\r\n                    ))}\r\n                </div> \r\n            </div>\r\n\r\n            {!isRecieve && (\r\n                <div className=\"z-20\">\r\n                    <CreateBtns setItems={setItems}/>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"z-20\">\r\n                <Redactor\r\n                    item={selectedItem}\r\n                    items={items}\r\n                    isOpen={redactorOpen}\r\n                    open={setRedactorOpen}\r\n                    onChange={handleRedactorChange}\r\n                />\r\n            </div>\r\n        </>\r\n    )\r\n\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2637, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/createcard/CreateCardClient.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState,useEffect, useRef, useMemo } from \"react\"\r\nimport { useSearchParams } from \"next/navigation\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nimport { useRandColor } from \"./useRandColor\";\r\n\r\nimport { useAuth } from \"../things/hooks/useAuth\";\r\nimport { useMessages } from \"../things/hooks/useMessages\";\r\nimport {useCurrentMessage} from \"../things/hooks/useMessages\"\r\nimport { useSetAnon } from \"../things/hooks/useSetAnon\";\r\nimport { getId } from \"../things/utils/getId\";\r\nimport { useGetDialogUsers } from \"../things/hooks/useGetDialogUsers\";\r\n\r\nimport { Item } from \"../things/types/type\";\r\n\r\nimport { RightField } from \"./components/all\";\r\n\r\nimport { useCheckMobile } from \"../things/hooks/checkMobile\";\r\n\r\nimport { Canvas} from \"./components/canvas\";\r\n\r\ntype MessageData = {\r\n    items: Item[]\r\n}\r\ntype TypeData = {\r\n    type: string\r\n}\r\n\r\nexport default function CreateCardPage({initialData}: {initialData?: MessageData}) {\r\n    const {user, profile, loading: authLoading} = useAuth();\r\n    const router = useRouter()\r\n\r\n    const searchParams = useSearchParams()\r\n    //messageId\r\n    const messageIdRaw = searchParams.get(\"id\")\r\n    const messageId = messageIdRaw ? decodeURIComponent(messageIdRaw) : null\r\n    //userId\r\n    const rawTo = searchParams.get(\"to\")\r\n    const to = rawTo ? decodeURIComponent(rawTo) : null\r\n    const [userId, setUserId] = useState<string | null>(null) // получаем из url\r\n    const [isReply, setIsReply] = useState(false)\r\n    // чье сообщение isMine = true || false\r\n    const isMine = searchParams.get(\"isMine\")\r\n    // тип перехода send или recieve\r\n    const type = searchParams.get(\"type\")\r\n    const [messageType, setMessageType] = useState<TypeData | null>(null)\r\n    const isRecieve = type === \"recieve\"\r\n    const isSend = type === \"send\"\r\n    const canEdit = isSend\r\n    \r\n\r\n    const isMobile = useCheckMobile() // проверка разрешения\r\n\r\n    const {sendMessage: send, loading: messageLoading} = useMessages(user?.id || null);\r\n    const {message, loading} = useCurrentMessage(\r\n        isRecieve ? user?.id || null : null, \r\n        isRecieve ? messageId : null,\r\n        isMine\r\n    )\r\n    \r\n    const [items, setItems] = useState<Item[]>(initialData?.items || [])\r\n    \r\n    const {checkAnon} = useSetAnon()\r\n    const [rightPanelOpen, setRightPanelOpen] = useState(false)\r\n    const idRef = useRef<HTMLInputElement>(null)\r\n    const anonRef = useRef<HTMLInputElement>(null)\r\n    const [anonState, setAnonState] = useState({\r\n        isAnon: false,\r\n        anonUsedOnce: false,\r\n        canToggle: true\r\n    })\r\n    const [userError, setUserError] = useState<string | null>(null)\r\n    const { dialogs, loading: dialogsLoading, error: dialogsError } = useGetDialogUsers(user?.id || null);\r\n\r\n    \r\n    useEffect(() => {\r\n        if (to){\r\n            setItems([])\r\n            setUserId(to)\r\n            setIsReply(true)\r\n        };\r\n\r\n        if (type){\r\n            setMessageType({type})\r\n        };\r\n    },[to, type])\r\n\r\n    useEffect(() => {\r\n        if (!isRecieve) return\r\n        if (!message) return\r\n        if (loading) return\r\n\r\n        setItems(message.body)\r\n    }, [isRecieve, message])\r\n\r\n\r\n    // Прочтение сообщений\r\n    useEffect(() => {\r\n        if(isMine) return\r\n        if(messageId && type === \"recieve\") {\r\n\r\n            fetch(\"/api/mark-read\", { \r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({ messageId })\r\n            })\r\n            .then(async res => {\r\n                const data = await res.json()\r\n                console.log(\"response\", {status: res.status, data})\r\n                if(!res.ok){\r\n                    console.error(\"failed\", data)\r\n                }else{\r\n                    console.log(\"success\",data)\r\n                }\r\n            })\r\n            .catch(err => console.log(\"❌ Fetch error:\", err))\r\n        }\r\n    }, [messageId, type, to])\r\n\r\n\r\n\r\n    // проверка на анон\r\n    useEffect(() => {\r\n        if(!userId || !user) return\r\n\r\n        const fetchAnon = async () => {\r\n            try {\r\n                setUserError(null)\r\n                const toUserId = await getId(userId)\r\n                if(!toUserId) {\r\n                    setUserError(\"Пользователь не найден\")\r\n                    return\r\n                }\r\n\r\n                const state = await checkAnon(user.id, toUserId)\r\n                setAnonState(state)\r\n            }catch(err: any){\r\n                if(err.message === \"User not found\") {\r\n                    setUserError(\"Пользователь не найден\")\r\n                } else {\r\n                    setUserError(\"Ошибка при проверке пользователя\")\r\n                }\r\n                console.log(`Error:`, err)\r\n            }\r\n        }\r\n        \r\n        fetchAnon()\r\n    },[userId, user])\r\n\r\n    \r\n\r\n    // рандомный фон\r\n    const {bg} = useRandColor()\r\n    const bgStyle = `rgba(${Math.floor(bg.r)}, ${Math.floor(bg.g)}, ${Math.floor(bg.b)}, ${bg.a})`\r\n\r\n    const handleSendMessage = async () => {\r\n        const id = idRef.current?.value || \"\"\r\n\r\n        if (!id){\r\n            alert('Введи ID, сладкий!')\r\n            return\r\n        }\r\n        if (id === profile.public_id){\r\n            alert('Нельзя отправить сообщение самому себе!')\r\n            return\r\n        }\r\n        const cleanItems = items.map(item => {\r\n            if(item.type === 'text') {\r\n                const {isSelected, isEditing, ...rest} = item\r\n                return rest\r\n            }\r\n            const {isSelected, ...rest} = item\r\n            return rest\r\n        })\r\n        \r\n        try {\r\n            await send({publicId: id}, cleanItems, anonState.isAnon)\r\n\r\n            idRef.current!.value = \"\"\r\n            setRightPanelOpen(false)\r\n            router.push('/')\r\n        } catch (error: any) {\r\n            console.log(error.message || 'Error sending message');\r\n        }\r\n    }\r\n\r\n        return (\r\n            <div \r\n                className={`relative flex flex-col justify-center items-center h-full overflow-hidden`}\r\n                style={{ \r\n                    backgroundColor: bgStyle\r\n                }}\r\n                onClick={(e) => {\r\n                    if(e.target !== e.currentTarget) return;\r\n                }}\r\n            >\r\n                {/* field */}\r\n                {(isSend || (isRecieve && !loading))  && (\r\n                    <Canvas\r\n                        items={items}\r\n                        setItems={setItems}\r\n                        canEdit={canEdit}\r\n                        isRecieve={isRecieve}\r\n                    />\r\n\r\n                )}\r\n                \r\n    \r\n                {/* кнопка назад */}\r\n                <div\r\n                    className={`absolute  flex justify-center items-center z-20\r\n                    rounded-full backdrop-blur-md transition-all duration-200\r\n\r\n                    bg-linear-to-br from-white/20 to-white/10 border-white/20\r\n                    hover:from-white/20 hover:to-white/30\r\n                    ${isMobile ? \"w-10 h-10 left-3 top-3\" : \"w-12 h-12 left-5 top-5\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => router.push(\"/\")}\r\n                        className=\"w-full h-full \">\r\n                        {`<`}\r\n                    </button>\r\n                </div>\r\n\r\n\r\n\r\n                {/* Кнопка снизу для поля отправить */}\r\n                {(!isMobile && isMine!==\"true\") \r\n                ? (\r\n                    <div\r\n                        className={`absolute right-0 bottom-0 -translate-y-1/2\r\n                        flex justify-center items-center overflow-hidden\r\n                        w-7 h-1/2 rounded-l-2xl bg-white/10 backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                        z-20\r\n                        `}\r\n                        \r\n                    >\r\n                        <button \r\n                            onClick={() => {setRightPanelOpen(true)}}\r\n                            className=\"flexC w-full h-full\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M2.01 21L23 12L2.01 3L2 10l15 2l-15 2z\"/></svg>                    \r\n                        </button>\r\n                    </div>\r\n\r\n                ) :(\r\n                    <div\r\n                        className={`absolute bottom-0 right-0 \r\n                        flex justify-center items-center overflow-hidden\r\n                        w-7 h-12 rounded-l-2xl bg-white/10 backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                        z-20\r\n                        `}\r\n                        \r\n                    >\r\n                        <button \r\n                            onClick={() => {setRightPanelOpen(true)}}\r\n                            className=\"flexC w-full h-full\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M2.01 21L23 12L2.01 3L2 10l15 2l-15 2z\"/></svg>                    \r\n                        </button>\r\n                    </div>\r\n                )}\r\n    \r\n                {/* поле отправить */}\r\n                <RightField\r\n                    rightPanelOpen={rightPanelOpen}\r\n                    setRightPanelOpen={setRightPanelOpen}\r\n                    userId={userId}\r\n                    setUserId={setUserId}\r\n                    isReply={isReply}\r\n                    anonState={anonState}\r\n                    setAnonState={(isAnon) => \r\n                        setAnonState(s =>({...s, isAnon}))\r\n                    }\r\n                    handleSendMessage={handleSendMessage}\r\n                    idRef={idRef}\r\n                    anonRef={anonRef}\r\n                    isRecieve={isRecieve}\r\n                    routeTo={id => {\r\n                        // router.push(`createcard?type=send&id=${encodeURIComponent(id ?? '')}`)\r\n                        router.push(`createcard?type=send&to=${encodeURIComponent(id ?? '')}`)\r\n                    }}\r\n                    userError={userError}\r\n                    to={to}\r\n                    dialogs={dialogs}\r\n                    isMine={isMine}\r\n                />\r\n\r\n    \r\n    \r\n            </div>\r\n        )\r\n    \r\n\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAGA;AAEA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AAEA;;;AArBA;;;;;;;;;;;;;;AA8Be,SAAS,eAAe,EAAC,WAAW,EAA8B;;IAC7E,MAAM,EAAC,IAAI,EAAE,OAAO,EAAE,SAAS,WAAW,EAAC,GAAG,IAAA,+IAAO;IACrD,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,eAAe,IAAA,wJAAe;IACpC,WAAW;IACX,MAAM,eAAe,aAAa,GAAG,CAAC;IACtC,MAAM,YAAY,eAAe,mBAAmB,gBAAgB;IACpE,QAAQ;IACR,MAAM,QAAQ,aAAa,GAAG,CAAC;IAC/B,MAAM,KAAK,QAAQ,mBAAmB,SAAS;IAC/C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAgB,MAAM,kBAAkB;;IAC5E,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,uCAAuC;IACvC,MAAM,SAAS,aAAa,GAAG,CAAC;IAChC,gCAAgC;IAChC,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAkB;IAChE,MAAM,YAAY,SAAS;IAC3B,MAAM,SAAS,SAAS;IACxB,MAAM,UAAU;IAGhB,MAAM,WAAW,IAAA,0JAAc,IAAG,sBAAsB;;IAExD,MAAM,EAAC,aAAa,IAAI,EAAE,SAAS,cAAc,EAAC,GAAG,IAAA,uJAAW,EAAC,MAAM,MAAM;IAC7E,MAAM,EAAC,OAAO,EAAE,OAAO,EAAC,GAAG,IAAA,6JAAiB,EACxC,YAAY,MAAM,MAAM,OAAO,MAC/B,YAAY,YAAY,MACxB;IAGJ,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAS,aAAa,SAAS,EAAE;IAEnE,MAAM,EAAC,SAAS,EAAC,GAAG,IAAA,qJAAU;IAC9B,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IACrD,MAAM,QAAQ,IAAA,uKAAM,EAAmB;IACvC,MAAM,UAAU,IAAA,uKAAM,EAAmB;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;QACvC,QAAQ;QACR,cAAc;QACd,WAAW;IACf;IACA,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAgB;IAC1D,MAAM,EAAE,OAAO,EAAE,SAAS,cAAc,EAAE,OAAO,YAAY,EAAE,GAAG,IAAA,mKAAiB,EAAC,MAAM,MAAM;IAGhG,IAAA,0KAAS;oCAAC;YACN,IAAI,IAAG;gBACH,SAAS,EAAE;gBACX,UAAU;gBACV,WAAW;YACf;;YAEA,IAAI,MAAK;gBACL,eAAe;oBAAC;gBAAI;YACxB;;QACJ;mCAAE;QAAC;QAAI;KAAK;IAEZ,IAAA,0KAAS;oCAAC;YACN,IAAI,CAAC,WAAW;YAChB,IAAI,CAAC,SAAS;YACd,IAAI,SAAS;YAEb,SAAS,QAAQ,IAAI;QACzB;mCAAG;QAAC;QAAW;KAAQ;IAGvB,sBAAsB;IACtB,IAAA,0KAAS;oCAAC;YACN,IAAG,QAAQ;YACX,IAAG,aAAa,SAAS,WAAW;gBAEhC,MAAM,kBAAkB;oBACpB,QAAQ;oBACR,SAAS;wBACL,gBAAgB;oBACpB;oBACA,MAAM,KAAK,SAAS,CAAC;wBAAE;oBAAU;gBACrC,GACC,IAAI;gDAAC,OAAM;wBACR,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,QAAQ,GAAG,CAAC,YAAY;4BAAC,QAAQ,IAAI,MAAM;4BAAE;wBAAI;wBACjD,IAAG,CAAC,IAAI,EAAE,EAAC;4BACP,QAAQ,KAAK,CAAC,UAAU;wBAC5B,OAAK;4BACD,QAAQ,GAAG,CAAC,WAAU;wBAC1B;oBACJ;+CACC,KAAK;gDAAC,CAAA,MAAO,QAAQ,GAAG,CAAC,kBAAkB;;YAChD;QACJ;mCAAG;QAAC;QAAW;QAAM;KAAG;IAIxB,mBAAmB;IACnB,IAAA,0KAAS;oCAAC;YACN,IAAG,CAAC,UAAU,CAAC,MAAM;YAErB,MAAM;sDAAY;oBACd,IAAI;wBACA,aAAa;wBACb,MAAM,WAAW,MAAM,IAAA,2IAAK,EAAC;wBAC7B,IAAG,CAAC,UAAU;4BACV,aAAa;4BACb;wBACJ;wBAEA,MAAM,QAAQ,MAAM,UAAU,KAAK,EAAE,EAAE;wBACvC,aAAa;oBACjB,EAAC,OAAM,KAAS;wBACZ,IAAG,IAAI,OAAO,KAAK,kBAAkB;4BACjC,aAAa;wBACjB,OAAO;4BACH,aAAa;wBACjB;wBACA,QAAQ,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE;oBAC1B;gBACJ;;YAEA;QACJ;mCAAE;QAAC;QAAQ;KAAK;IAIhB,gBAAgB;IAChB,MAAM,EAAC,EAAE,EAAC,GAAG,IAAA,oJAAY;IACzB,MAAM,UAAU,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;IAE9F,MAAM,oBAAoB;QACtB,MAAM,KAAK,MAAM,OAAO,EAAE,SAAS;QAEnC,IAAI,CAAC,IAAG;YACJ,MAAM;YACN;QACJ;QACA,IAAI,OAAO,QAAQ,SAAS,EAAC;YACzB,MAAM;YACN;QACJ;QACA,MAAM,aAAa,MAAM,GAAG,CAAC,CAAA;YACzB,IAAG,KAAK,IAAI,KAAK,QAAQ;gBACrB,MAAM,EAAC,UAAU,EAAE,SAAS,EAAE,GAAG,MAAK,GAAG;gBACzC,OAAO;YACX;YACA,MAAM,EAAC,UAAU,EAAE,GAAG,MAAK,GAAG;YAC9B,OAAO;QACX;QAEA,IAAI;YACA,MAAM,KAAK;gBAAC,UAAU;YAAE,GAAG,YAAY,UAAU,MAAM;YAEvD,MAAM,OAAO,CAAE,KAAK,GAAG;YACvB,kBAAkB;YAClB,OAAO,IAAI,CAAC;QAChB,EAAE,OAAO,OAAY;YACjB,QAAQ,GAAG,CAAC,MAAM,OAAO,IAAI;QACjC;IACJ;IAEI,qBACI,6LAAC;QACG,WAAW,CAAC,yEAAyE,CAAC;QACtF,OAAO;YACH,iBAAiB;QACrB;QACA,SAAS,CAAC;YACN,IAAG,EAAE,MAAM,KAAK,EAAE,aAAa,EAAE;QACrC;;YAGC,CAAC,UAAW,aAAa,CAAC,OAAQ,mBAC/B,6LAAC,uJAAM;gBACH,OAAO;gBACP,UAAU;gBACV,SAAS;gBACT,WAAW;;;;;;0BAOnB,6LAAC;gBACG,WAAW,CAAC;;;;;oBAKZ,EAAE,WAAW,2BAA2B,yBAAyB;oBACjE,CAAC;0BAGD,cAAA,6LAAC;oBACG,SAAS,IAAM,OAAO,IAAI,CAAC;oBAC3B,WAAU;8BACT,CAAC,CAAC,CAAC;;;;;;;;;;;YAOV,CAAC,YAAY,WAAS,uBAEpB,6LAAC;gBACG,WAAW,CAAC;;;;wBAIZ,CAAC;0BAGD,cAAA,6LAAC;oBACG,SAAS;wBAAO,kBAAkB;oBAAK;oBACvC,WAAU;8BACV,cAAA,6LAAC;wBAAI,OAAM;wBAA6B,OAAM;wBAAK,QAAO;wBAAK,SAAQ;kCAAY,cAAA,6LAAC;4BAAK,MAAK;4BAAe,GAAE;;;;;;;;;;;;;;;;;;;;qCAKvH,6LAAC;gBACG,WAAW,CAAC;;;;wBAIZ,CAAC;0BAGD,cAAA,6LAAC;oBACG,SAAS;wBAAO,kBAAkB;oBAAK;oBACvC,WAAU;8BACV,cAAA,6LAAC;wBAAI,OAAM;wBAA6B,OAAM;wBAAK,QAAO;wBAAK,SAAQ;kCAAY,cAAA,6LAAC;4BAAK,MAAK;4BAAe,GAAE;;;;;;;;;;;;;;;;;;;;;0BAM3H,6LAAC,wJAAU;gBACP,gBAAgB;gBAChB,mBAAmB;gBACnB,QAAQ;gBACR,WAAW;gBACX,SAAS;gBACT,WAAW;gBACX,cAAc,CAAC,SACX,aAAa,CAAA,IAAI,CAAC;4BAAC,GAAG,CAAC;4BAAE;wBAAM,CAAC;gBAEpC,mBAAmB;gBACnB,OAAO;gBACP,SAAS;gBACT,WAAW;gBACX,SAAS,CAAA;oBACL,yEAAyE;oBACzE,OAAO,IAAI,CAAC,CAAC,wBAAwB,EAAE,mBAAmB,MAAM,KAAK;gBACzE;gBACA,WAAW;gBACX,IAAI;gBACJ,SAAS;gBACT,QAAQ;;;;;;;;;;;;AAS5B;GA5QwB;;QAC0B,+IAAO;QACtC,kJAAS;QAEH,wJAAe;QAmBnB,0JAAc;QAEsB,uJAAW;QACrC,6JAAiB;QAQxB,qJAAU;QAUoC,mKAAiB;QAkFtE,oJAAY;;;KA9HL"}}]
}