{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/utils/supabase/alSupabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,WAAW,IAAA,uLAAY"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/auth.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\n\r\nexport async function getCurrentUser() {\r\n    const {data, error} = await supabase.auth.getUser()\r\n    if(error) return\r\n    return data.user\r\n}\r\n\r\nexport async function getUserProfile(userId: string) {\r\n    const {data, error} = await supabase\r\n        .from(\"users\")\r\n        .select(\"public_id, username\")\r\n        .eq(\"id_user\", userId)\r\n        .single()\r\n    if(error) return null\r\n    return data\r\n}\r\n\r\nexport async function sighOut() {\r\n    const {error} = await supabase.auth.signOut()\r\n    if(error) throw error\r\n}\r\n\r\nexport function onAuthStateChange(callback: (user:any) => void) {\r\n    const {data: listener} = supabase.auth.onAuthStateChange((event,session) => {\r\n        callback(session?.user || null)\r\n    })\r\n    return listener.subscription\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,eAAe;IAClB,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,OAAO;IACjD,IAAG,OAAO;IACV,OAAO,KAAK,IAAI;AACpB;AAEO,eAAe,eAAe,MAAc;IAC/C,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,SACL,MAAM,CAAC,uBACP,EAAE,CAAC,WAAW,QACd,MAAM;IACX,IAAG,OAAO,OAAO;IACjB,OAAO;AACX;AAEO,eAAe;IAClB,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,OAAO;IAC3C,IAAG,OAAO,MAAM;AACpB;AAEO,SAAS,kBAAkB,QAA4B;IAC1D,MAAM,EAAC,MAAM,QAAQ,EAAC,GAAG,2IAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,OAAM;QAC5D,SAAS,SAAS,QAAQ;IAC9B;IACA,OAAO,SAAS,YAAY;AAChC"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useAuth.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { getCurrentUser, getUserProfile, onAuthStateChange } from \"../utils/auth\"\r\n\r\nexport function useAuth() {\r\n    const [user, setUser] = useState<any>(null)\r\n    const [profile, setProfile] = useState<any>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            try {\r\n                const userData = await getCurrentUser()\r\n                setUser(userData)\r\n\r\n                if(userData) {\r\n                    const profileData = await getUserProfile(userData.id)\r\n                    setProfile(profileData)\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error loading user:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        loadUser()\r\n\r\n        const subscription = onAuthStateChange(async (newUser) => {\r\n            setUser(newUser)\r\n            if (newUser) {\r\n                const profileData = await getUserProfile(newUser.id)\r\n                setProfile(profileData)\r\n            } else {\r\n                setProfile(null)\r\n            }\r\n        })\r\n\r\n        return () => {\r\n            subscription.unsubscribe()\r\n        }\r\n    },[])\r\n\r\n    return {user,profile,loading}\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAKO,SAAS;IACZ,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAM;IACtC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAM;IAC5C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACN,MAAM,WAAW;YACb,IAAI;gBACA,MAAM,WAAW,MAAM,IAAA,4JAAc;gBACrC,QAAQ;gBAER,IAAG,UAAU;oBACT,MAAM,cAAc,MAAM,IAAA,4JAAc,EAAC,SAAS,EAAE;oBACpD,WAAW;gBACf;YACJ,EAAE,OAAO,OAAO;gBACZ,QAAQ,KAAK,CAAC,uBAAuB;YACzC,SAAU;gBACN,WAAW;YACf;QACJ;QACA;QAEA,MAAM,eAAe,IAAA,+JAAiB,EAAC,OAAO;YAC1C,QAAQ;YACR,IAAI,SAAS;gBACT,MAAM,cAAc,MAAM,IAAA,4JAAc,EAAC,QAAQ,EAAE;gBACnD,WAAW;YACf,OAAO;gBACH,WAAW;YACf;QACJ;QAEA,OAAO;YACH,aAAa,WAAW;QAC5B;IACJ,GAAE,EAAE;IAEJ,OAAO;QAAC;QAAK;QAAQ;IAAO;AAChC"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/messages.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\nimport { error } from \"console\";\r\nimport { ItemDto } from \"../types/type\";\r\n\r\nexport async function getInboxMessages(userId: string){\r\n    const {data, error} = await supabase\r\n        .from(\"messages_safe\")\r\n        .select(`\r\n            *\r\n            `)\r\n        .eq(\"to_user\", userId)\r\n        .order(\"created_at\", {ascending: true})\r\n    if(error) throw error;  \r\n\r\n    const messages = (data || []).map(msg => {\r\n        const anonSetting = msg.user_anonymous_settings?.[0]?.is_anon\r\n        return {\r\n            ...msg,\r\n            displayId: (anonSetting || msg.is_anon) ? \"Anon\" : msg.from_public_id,\r\n            username: (anonSetting || msg.is_anon) ? \"Anon\" : msg.from_username\r\n        }\r\n    })\r\n\r\n    return messages \r\n}\r\n\r\nexport async function getCurrentMessage(messageId: string, userId: string, isMine?: string | null) {\r\n    console.log('Querying message:', { messageId, userId })\r\n    const {data, error} = await supabase\r\n    .from(\"messages_safe\")\r\n    .select(\"*\")\r\n    .eq(\"id\", messageId)\r\n    .eq(isMine===\"true\" ? \"from_user\" : \"to_user\", userId)\r\n    .maybeSingle()\r\n    console.log('Query result:', { data, error })\r\n    if (error) throw error\r\n    return data || []\r\n}\r\n\r\nexport async function getSentMessages(userId: string) {\r\n    const {data, error} = await supabase\r\n        .from('messages_safe')\r\n        .select(`\r\n            *`)\r\n        .eq(\"from_user\", userId)\r\n        .order(\"created_at\", {ascending: true})\r\n    \r\n    if(error) throw error\r\n    return data || []\r\n\r\n}\r\n\r\nexport async function sendMessage({\r\n    fromUserId,\r\n    toUserId,\r\n    toPublicId,\r\n    body,\r\n    isAnon\r\n}: {\r\n    fromUserId: string,\r\n    toUserId?: string,\r\n    toPublicId?: string,\r\n    body: ItemDto[],\r\n    isAnon?: boolean\r\n}) {\r\n    let receiverId = toUserId\r\n\r\n    if (!receiverId){\r\n        if (!toPublicId) throw new Error(\"Не указан пользователь, малыш\")\r\n            const {data: receiver, error: userError} = await supabase\r\n                .from(\"users\") \r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", toPublicId)\r\n                .single()\r\n            if(userError || !receiver){\r\n                throw new Error(\"Пользователь не найден, кись\")\r\n            }\r\n        receiverId = receiver.id_user\r\n    }\r\n\r\n    const {data: toggle, error: toggleError} = await supabase.rpc(\"toggle_anonymous\", {\r\n                p_from: fromUserId, \r\n                p_to: receiverId, \r\n                p_is_anon: isAnon\r\n            })\r\n\r\n    if(toggleError) throw toggleError\r\n\r\n    const {error: messageError} = await supabase\r\n        .from(\"messages\")\r\n        .insert({\r\n            from_user: fromUserId,\r\n            to_user: receiverId,\r\n            body,\r\n        })\r\n    if(messageError) throw messageError\r\n\r\n    return toggle\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAIO,eAAe,iBAAiB,MAAc;IACjD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;;YAEL,CAAC,EACJ,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,cAAc;QAAC,WAAW;IAAI;IACzC,IAAG,OAAO,MAAM;IAEhB,MAAM,WAAW,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA;QAC9B,MAAM,cAAc,IAAI,uBAAuB,EAAE,CAAC,EAAE,EAAE;QACtD,OAAO;YACH,GAAG,GAAG;YACN,WAAW,AAAC,eAAe,IAAI,OAAO,GAAI,SAAS,IAAI,cAAc;YACrE,UAAU,AAAC,eAAe,IAAI,OAAO,GAAI,SAAS,IAAI,aAAa;QACvE;IACJ;IAEA,OAAO;AACX;AAEO,eAAe,kBAAkB,SAAiB,EAAE,MAAc,EAAE,MAAsB;IAC7F,QAAQ,GAAG,CAAC,qBAAqB;QAAE;QAAW;IAAO;IACrD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,WACT,EAAE,CAAC,WAAS,SAAS,cAAc,WAAW,QAC9C,WAAW;IACZ,QAAQ,GAAG,CAAC,iBAAiB;QAAE;QAAM;IAAM;IAC3C,IAAI,OAAO,MAAM;IACjB,OAAO,QAAQ,EAAE;AACrB;AAEO,eAAe,gBAAgB,MAAc;IAChD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;aACJ,CAAC,EACL,EAAE,CAAC,aAAa,QAChB,KAAK,CAAC,cAAc;QAAC,WAAW;IAAI;IAEzC,IAAG,OAAO,MAAM;IAChB,OAAO,QAAQ,EAAE;AAErB;AAEO,eAAe,YAAY,EAC9B,UAAU,EACV,QAAQ,EACR,UAAU,EACV,IAAI,EACJ,MAAM,EAOT;IACG,IAAI,aAAa;IAEjB,IAAI,CAAC,YAAW;QACZ,IAAI,CAAC,YAAY,MAAM,IAAI,MAAM;QAC7B,MAAM,EAAC,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAC,GAAG,MAAM,2IAAQ,CACpD,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,aAAa,YAChB,MAAM;QACX,IAAG,aAAa,CAAC,UAAS;YACtB,MAAM,IAAI,MAAM;QACpB;QACJ,aAAa,SAAS,OAAO;IACjC;IAEA,MAAM,EAAC,MAAM,MAAM,EAAE,OAAO,WAAW,EAAC,GAAG,MAAM,2IAAQ,CAAC,GAAG,CAAC,oBAAoB;QACtE,QAAQ;QACR,MAAM;QACN,WAAW;IACf;IAER,IAAG,aAAa,MAAM;IAEtB,MAAM,EAAC,OAAO,YAAY,EAAC,GAAG,MAAM,2IAAQ,CACvC,IAAI,CAAC,YACL,MAAM,CAAC;QACJ,WAAW;QACX,SAAS;QACT;IACJ;IACJ,IAAG,cAAc,MAAM;IAEvB,OAAO;AACX"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/types/type.ts"],"sourcesContent":["export type Item = {\r\n    id: number;\r\n    type: \"text\",\r\n    content: string,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    fontSize?: number,\r\n    scaleX?: number,\r\n    scaleY?: number,\r\n    rotation?: number,\r\n    isEditing: string,\r\n    isSelected?: boolean\r\n}\r\n\r\nexport type ItemDto = {\r\n    id: number;\r\n    type: \"text\",\r\n    content: string,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    fontSize?: number,\r\n    scaleX?: number,\r\n    scaleY?: number,\r\n    rotation?: number,\r\n}\r\nexport function itemDtoToItem(dto: ItemDto): Item {\r\n    return {\r\n        ...dto, \r\n        isEditing: 'none', \r\n        isSelected: false\r\n    }\r\n}\r\nexport function itemDtoListToItems(dtos: ItemDto[]): Item[] {\r\n  return dtos.map(itemDtoToItem)\r\n}\r\n\r\nexport type Message = {\r\n    id: string,\r\n    body: ItemDto[],\r\n    created_at: string,\r\n    is_anon: boolean,\r\n    \r\n    from_user: string,\r\n    to_user: string,\r\n    from_display_id: string,\r\n    to_display_id: string,\r\n}\r\n\r\nexport type UiMessage = Omit<Message, \"body\"> & {\r\n    body: Item[]\r\n}\r\n\r\nexport type Viewport ={\r\n    scale: number,\r\n    offsetX: number,\r\n    offsetY: number\r\n}"],"names":[],"mappings":";;;;;;AA6BO,SAAS,cAAc,GAAY;IACtC,OAAO;QACH,GAAG,GAAG;QACN,WAAW;QACX,YAAY;IAChB;AACJ;AACO,SAAS,mBAAmB,IAAe;IAChD,OAAO,KAAK,GAAG,CAAC;AAClB"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/parseDate.ts"],"sourcesContent":["export function parseBackendDate(raw: string): Date {\r\n    if (!raw) return new Date(NaN)\r\n\r\n    return new Date(\r\n    raw\r\n      .replace(\" \", \"T\")\r\n      .replace(/\\.\\d+/, m => m.slice(0, 4)) // миллисекунды → 3 знака\r\n      .replace(/\\+00:?00$/, \"Z\"))            // +00 or +00:00 → Z\r\n\r\n}\r\n\r\nexport function parseDate(date: Date): string {\r\n    return date.toLocaleString(\"ru-RU\", {\r\n        day: \"2-digit\",\r\n        month: \"2-digit\",\r\n        year: \"numeric\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n    })\r\n}"],"names":[],"mappings":";;;;;;AAAO,SAAS,iBAAiB,GAAW;IACxC,IAAI,CAAC,KAAK,OAAO,IAAI,KAAK;IAE1B,OAAO,IAAI,KACX,IACG,OAAO,CAAC,KAAK,KACb,OAAO,CAAC,SAAS,CAAA,IAAK,EAAE,KAAK,CAAC,GAAG,IAAI,yBAAyB;KAC9D,OAAO,CAAC,aAAa,MAAiB,oBAAoB;;AAEjE;AAEO,SAAS,UAAU,IAAU;IAChC,OAAO,KAAK,cAAc,CAAC,SAAS;QAChC,KAAK;QACL,OAAO;QACP,MAAM;QACN,MAAM;QACN,QAAQ;IACZ;AACJ"}},
    {"offset": {"line": 250, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useMessages.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect, useMemo } from \"react\"\r\nimport { supabase } from \"@/utils/supabase/alSupabase\"\r\nimport { getInboxMessages, getSentMessages, sendMessage, getCurrentMessage } from \"../utils/messages\"\r\nimport { ItemDto, Item, Message, UiMessage, itemDtoListToItems } from \"../types/type\"\r\nimport { parseBackendDate } from \"../utils/parseDate\"\r\n\r\n\r\n\r\nexport function useMessages(userId: string | null) {\r\n    const [inbox, setInbox] = useState<any[]>([])\r\n    const [sent, setSent] = useState<any[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n\r\n\r\n    const loadMessage = async () => {\r\n        if(!userId) return\r\n\r\n        try{\r\n            setLoading(true)\r\n            const [inboxData, sentData] = await Promise.all([\r\n                getInboxMessages(userId), \r\n                getSentMessages(userId)\r\n            ])\r\n\r\n            setInbox(inboxData)\r\n            setSent(sentData)\r\n        } catch (error) {\r\n            console.error(\"Error loading messages:\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        loadMessage()\r\n    },[userId])\r\n\r\n    const send = async (\r\n        to: {publicId?: string, userId?: string}, \r\n        body: ItemDto[],\r\n        isAnon?: boolean \r\n    ) => {\r\n        if(!userId) throw new Error(\"User not logged in\")\r\n\r\n        let receiverId = to.userId\r\n\r\n        if (!receiverId){\r\n            if(!to.publicId) throw new Error(\"Не указан пользователь, малыш\")\r\n\r\n            const {data: receiver, error: userError} = await supabase\r\n                .from(\"users\") \r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", to.publicId)\r\n                .single()\r\n            if(userError || !receiver){\r\n                throw new Error(\"Пользователь не найден, кись\")\r\n            }\r\n            receiverId = receiver.id_user\r\n        }\r\n        \r\n        const {data, error} = await supabase.rpc(\"toggle_anonymous\", {\r\n            p_from: userId, \r\n            p_to: receiverId, \r\n            p_is_anon: isAnon\r\n        })\r\n        if(error) throw error\r\n\r\n        const {error: errorMsg} = await supabase\r\n            .from(\"messages\")\r\n            .insert({\r\n                from_user: userId, \r\n                to_user: receiverId, \r\n                body\r\n            })\r\n        if(errorMsg) throw errorMsg\r\n\r\n        await loadMessage()\r\n\r\n        return data\r\n    }\r\n\r\n    return {\r\n        inbox,\r\n        sent,\r\n        loading,\r\n        sendMessage: send,\r\n        refresh: loadMessage\r\n    }\r\n\r\n}\r\n\r\ntype UseCurrentMessageResult = {\r\n    message: UiMessage | null,\r\n    loading: boolean\r\n}\r\nexport function useCurrentMessage(\r\n    userId: string | null, \r\n    messageId: string | null,\r\n    isMine?: string | null\r\n): UseCurrentMessageResult {\r\n    const [message, setMessage] = useState<UiMessage | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => {\r\n        if (!userId || !messageId) return\r\n\r\n        const loadMessage = async () => {\r\n            setLoading(true)\r\n            try{\r\n                const data = await getCurrentMessage(messageId, userId, isMine)\r\n                setMessage({\r\n                    ...data,\r\n                    body: itemDtoListToItems(data.body) \r\n                })\r\n            } catch (error) {\r\n                console.error(\"Error loading messages:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        loadMessage()\r\n\r\n    }, [userId, messageId])\r\n\r\n    return {\r\n        message,\r\n        loading\r\n    }\r\n}\r\n\r\n\r\n\r\nexport type Dialog = {\r\n    userId: string,\r\n    displayId: string,\r\n\r\n    lastMessage: MessageUI,\r\n    messages: MessageUI[],\r\n    count: number\r\n}\r\n\r\ntype MessageUI = Omit<Message, \"created_at\"> & {\r\n    created_at: Date\r\n}\r\n\r\nexport function useDialogs(\r\n    inboxMessages: Message[],\r\n    sentMessages: Message[],\r\n    myUserId: string,\r\n    myPublicId: string\r\n) {\r\n    const dialogs = useMemo<Dialog[]>(() => {\r\n        const map = new Map<string, Dialog>()\r\n\r\n        const allMessages:MessageUI[] = [...inboxMessages, ...sentMessages].map(\r\n            msg => ({\r\n                ...msg,\r\n                created_at: parseBackendDate(msg.created_at)\r\n            })\r\n        )\r\n\r\n        for (const msg of allMessages){\r\n            const dialogUserId = msg.from_user === myUserId\r\n                ? msg.to_user\r\n                : msg.from_user\r\n\r\n            let displayId = ''\r\n            if(msg.from_display_id === 'A'){\r\n                displayId = 'Anon'\r\n            } else{ \r\n                displayId = msg.from_display_id === myPublicId\r\n                    ? msg.to_display_id\r\n                    : msg.from_display_id\r\n            }\r\n\r\n            if(!map.has(dialogUserId)) {\r\n                map.set(dialogUserId, {\r\n                    userId: dialogUserId,\r\n                    displayId: displayId,\r\n\r\n                    lastMessage: msg,\r\n                    messages: [msg],\r\n                    count: 1\r\n                })\r\n            } else{\r\n                const dialog = map.get(dialogUserId)!\r\n                dialog.messages.push(msg)\r\n                dialog.count++\r\n\r\n                if(msg.created_at > dialog.lastMessage.created_at){\r\n                    dialog.lastMessage = msg\r\n                }\r\n            }\r\n        }\r\n\r\n        return Array.from(map.values()).sort(\r\n            (a,b) =>\r\n                b.lastMessage.created_at.getTime() -\r\n                a.lastMessage.created_at.getTime()\r\n        )\r\n    }, [inboxMessages, sentMessages, myUserId])\r\n\r\n    return dialogs\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 406, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useSwipe.ts"],"sourcesContent":["import { on } from \"events\";\r\nimport { useRef } from \"react\";\r\n\r\ntype SwipeConfig = {\r\n    onSwipeLeft?: () => void,\r\n    onSwipeRight?: () => void,\r\n    threshold?: number\r\n}\r\n\r\nexport function useSwipe({\r\n    onSwipeLeft,\r\n    onSwipeRight,\r\n    threshold = 50\r\n}: SwipeConfig) {\r\n    const startX = useRef<number | null>(null);\r\n\r\n    const onTouchStart = (e: React.TouchEvent) => {\r\n        startX.current = e.touches[0].clientX;\r\n    }\r\n\r\n    const onTouchEnd = (e: React.TouchEvent) => {\r\n        if (startX.current === null) return;\r\n\r\n        const endX = e.changedTouches[0].clientX;\r\n        const delta = endX - startX.current;\r\n\r\n        if(Math.abs(delta) > threshold) {\r\n            if(delta > 0) onSwipeRight?.()\r\n            else onSwipeLeft?.()\r\n        }\r\n\r\n        startX.current = null;\r\n    }\r\n\r\n    return {\r\n        onTouchStart,\r\n        onTouchEnd\r\n    }\r\n}"],"names":[],"mappings":";;;;AACA;;AAQO,SAAS,SAAS,EACrB,WAAW,EACX,YAAY,EACZ,YAAY,EAAE,EACJ;IACV,MAAM,SAAS,IAAA,+MAAM,EAAgB;IAErC,MAAM,eAAe,CAAC;QAClB,OAAO,OAAO,GAAG,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO;IACzC;IAEA,MAAM,aAAa,CAAC;QAChB,IAAI,OAAO,OAAO,KAAK,MAAM;QAE7B,MAAM,OAAO,EAAE,cAAc,CAAC,EAAE,CAAC,OAAO;QACxC,MAAM,QAAQ,OAAO,OAAO,OAAO;QAEnC,IAAG,KAAK,GAAG,CAAC,SAAS,WAAW;YAC5B,IAAG,QAAQ,GAAG;iBACT;QACT;QAEA,OAAO,OAAO,GAAG;IACrB;IAEA,OAAO;QACH;QACA;IACJ;AACJ"}},
    {"offset": {"line": 436, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/checkMobile.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\nexport function useCheckMobile(breakPoint = 768) {\r\n    const [isMobile, setIsMobile] = useState(false)\r\n\r\n    useEffect(() => {\r\n        const check = () => {\r\n            setIsMobile(window.innerWidth <= 768)\r\n        }\r\n        check()\r\n        window.addEventListener('resize', check)\r\n        return () => window.removeEventListener('resize', check)\r\n    },[breakPoint])\r\n\r\n    return isMobile\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,eAAe,aAAa,GAAG;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,IAAA,kNAAS,EAAC;QACN,MAAM,QAAQ;YACV,YAAY,OAAO,UAAU,IAAI;QACrC;QACA;QACA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;IACtD,GAAE;QAAC;KAAW;IAEd,OAAO;AACX"}},
    {"offset": {"line": 460, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useSetAnon.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\nimport { useState } from \"react\";\r\n\r\ntype SetAnonParams = {\r\n    from_user_id: string,\r\n    to_user_id: string,\r\n    is_anon: boolean\r\n}\r\n\r\nexport function useSetAnon() {\r\n    const [loading, setLoading] = useState(false)\r\n    const [error, setError] = useState<Error | null>(null)\r\n\r\n\r\n    const setAnon = async ({\r\n        from_user_id,\r\n        to_user_id,\r\n        is_anon\r\n    }: SetAnonParams) => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            const {data, error} = await supabase.rpc(\"toggle_anonymous\", {\r\n                p_from: from_user_id, \r\n                p_to: to_user_id, \r\n                p_is_anon: is_anon\r\n            })\r\n\r\n            if(error) throw error\r\n\r\n            if (data === false){\r\n                throw new Error(\"Анонимность уже была использована\")\r\n            }\r\n            return data\r\n\r\n        } catch (err) {\r\n            setError(err as Error)\r\n            throw err\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const checkAnon = async (from_user_id: string, to_user_id: string) => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            const {data, error} = await supabase\r\n                .from(\"user_anonymous_settings\")\r\n                .select(\"is_anon, anon_used_once\")\r\n                .eq(\"from_user_id\", from_user_id)\r\n                .eq(\"to_user_id\", to_user_id)\r\n                .maybeSingle()\r\n            if(error) throw error\r\n\r\n            if (!data) {\r\n                return {\r\n                    isAnon: false,\r\n                    anonUsedOnce: false,\r\n                    canToggle: true\r\n                }\r\n            }\r\n\r\n            return {\r\n                isAnon: data?.is_anon ?? false,\r\n                anonUsedOnce: data?.anon_used_once ?? false,\r\n                canToggle: !(data?.anon_used_once && !data.is_anon)\r\n            }\r\n        } catch (err) {\r\n            setError(err as Error)\r\n            throw err\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n        \r\n\r\n    return {setAnon, checkAnon, loading, error}\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,SAAS;IACZ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAe;IAGjD,MAAM,UAAU,OAAO,EACnB,YAAY,EACZ,UAAU,EACV,OAAO,EACK;QACZ,IAAI;YACA,WAAW;YACX,SAAS;YAET,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAAC,GAAG,CAAC,oBAAoB;gBACzD,QAAQ;gBACR,MAAM;gBACN,WAAW;YACf;YAEA,IAAG,OAAO,MAAM;YAEhB,IAAI,SAAS,OAAM;gBACf,MAAM,IAAI,MAAM;YACpB;YACA,OAAO;QAEX,EAAE,OAAO,KAAK;YACV,SAAS;YACT,MAAM;QACV,SAAU;YACN,WAAW;QACf;IACJ;IAEA,MAAM,YAAY,OAAO,cAAsB;QAC3C,IAAI;YACA,WAAW;YACX,SAAS;YAET,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,2BACL,MAAM,CAAC,2BACP,EAAE,CAAC,gBAAgB,cACnB,EAAE,CAAC,cAAc,YACjB,WAAW;YAChB,IAAG,OAAO,MAAM;YAEhB,IAAI,CAAC,MAAM;gBACP,OAAO;oBACH,QAAQ;oBACR,cAAc;oBACd,WAAW;gBACf;YACJ;YAEA,OAAO;gBACH,QAAQ,MAAM,WAAW;gBACzB,cAAc,MAAM,kBAAkB;gBACtC,WAAW,CAAC,CAAC,MAAM,kBAAkB,CAAC,KAAK,OAAO;YACtD;QACJ,EAAE,OAAO,KAAK;YACV,SAAS;YACT,MAAM;QACV,SAAU;YACN,WAAW;QACf;IACJ;IAGA,OAAO;QAAC;QAAS;QAAW;QAAS;IAAK;AAC9C"}},
    {"offset": {"line": 528, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/modal/modalProfile.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\r\nimport { Dialog } from \"../things/hooks/useMessages\"\r\nimport { useSetAnon } from \"../things/hooks/useSetAnon\";\r\n\r\ntype ModalProfileProps = {\r\n  isOpen: boolean\r\n  onClose: () => void\r\n  fromUser: string\r\n  toUser?: Dialog\r\n  refresh: () => void\r\n}\r\n\r\nexport function ModalProfile({\r\n  isOpen,\r\n  onClose,\r\n  fromUser, \r\n  toUser,\r\n  refresh\r\n}: ModalProfileProps) {\r\n    const [isAnon, setIsAnon] = useState(false);\r\n    const [anonUsedOnce, setAnonUsedOnce] = useState(false);\r\n\r\n    const {setAnon, checkAnon, loading, error} = useSetAnon()\r\n\r\n\r\n    useEffect(() => {\r\n        if(!toUser || !fromUser || !isOpen) return\r\n\r\n        const load = async () => {\r\n            const data = await checkAnon(fromUser, toUser.userId)\r\n            if(!data) return\r\n\r\n            setIsAnon(data.isAnon)\r\n            setAnonUsedOnce(data.anonUsedOnce)\r\n        }\r\n\r\n        load()\r\n\r\n    }, [isOpen,fromUser, toUser]);\r\n\r\n  if (!isOpen || !toUser) return null\r\n\r\n    \r\n\r\n  return (\r\n    <div\r\n      className=\"\r\n        fixed inset-0 z-50\r\n        flex items-center justify-center\r\n        bg-black/60 backdrop-blur-sm\r\n        animate-fadeIn\r\n      \"\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        className=\"\r\n          w-full max-w-md\r\n          rounded-2xl\r\n          bg-[#12080b]\r\n          border border-white/10\r\n          shadow-2xl\r\n          p-6\r\n          animate-scaleIn\r\n          text-white\r\n        \"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-lg font-bold\">\r\n              {toUser.displayId.charAt(1).toUpperCase()}\r\n            </div>\r\n\r\n            <div>\r\n              <div className=\"font-semibold\">{toUser.displayId}</div>\r\n              <div className=\"text-xs text-white/50\">Профиль пользователя</div>\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-white/50 hover:text-white transition\"\r\n          >\r\n            ✕\r\n          </button>\r\n        </div>\r\n\r\n        {/* Body */}\r\n        <form\r\n          className=\"flex flex-col gap-5\"\r\n          onSubmit={async (e) => {\r\n            e.preventDefault()\r\n            try {\r\n                await setAnon({\r\n                    from_user_id: fromUser,\r\n                    to_user_id: toUser.userId,\r\n                    is_anon: isAnon\r\n                })\r\n\r\n                refresh()\r\n                onClose()\r\n            } catch {}\r\n          }}\r\n        >\r\n            {!loading \r\n            ?(\r\n                <label className=\"flex items-start gap-3 cursor-pointer\">\r\n                    <input\r\n                    type=\"checkbox\"\r\n                    className=\"\r\n                        mt-1\r\n                        w-4 h-4\r\n                        accent-red-500\r\n                    \"\r\n                    checked={isAnon}\r\n                    disabled={loading || anonUsedOnce && !isAnon}\r\n                    onChange={(e) => setIsAnon(e.target.checked)}\r\n                    />\r\n                    {anonUsedOnce && !isAnon \r\n                    ?(\r\n                        <span className=\"text-sm text-white/80\">\r\n                            Анонимность для этого пользователя отключена\r\n                            <div className=\"text-xs text-white/40\">\r\n                                Применяется только один раз\r\n                            </div>\r\n                        </span>\r\n                    )\r\n                    : (\r\n                        <span className=\"text-sm text-white/80\">\r\n                            Анонимность для пользователя\r\n                            <div className=\"text-xs text-white/40\">\r\n                                Применяется только один раз\r\n                            </div>\r\n                        </span>\r\n                    )}\r\n\r\n                </label>\r\n            )\r\n            :(\r\n                <span className=\"text-sm text-white/80\">\r\n                    Загрузка...\r\n                </span>\r\n            )\r\n            }\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex justify-end gap-3 mt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"\r\n                px-4 py-2 rounded-lg\r\n                bg-white/5 hover:bg-white/10\r\n                text-sm transition\r\n              \"\r\n            >\r\n              Отмена\r\n            </button>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              className=\"\r\n                px-4 py-2 rounded-lg\r\n                bg-red-500 hover:bg-red-600\r\n                text-sm font-medium\r\n                transition\r\n              \"\r\n            >\r\n              Сохранить\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAUO,SAAS,aAAa,EAC3B,MAAM,EACN,OAAO,EACP,QAAQ,EACR,MAAM,EACN,OAAO,EACW;IAChB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,MAAM,EAAC,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAC,GAAG,IAAA,8JAAU;IAGvD,IAAA,kNAAS,EAAC;QACN,IAAG,CAAC,UAAU,CAAC,YAAY,CAAC,QAAQ;QAEpC,MAAM,OAAO;YACT,MAAM,OAAO,MAAM,UAAU,UAAU,OAAO,MAAM;YACpD,IAAG,CAAC,MAAM;YAEV,UAAU,KAAK,MAAM;YACrB,gBAAgB,KAAK,YAAY;QACrC;QAEA;IAEJ,GAAG;QAAC;QAAO;QAAU;KAAO;IAE9B,IAAI,CAAC,UAAU,CAAC,QAAQ,OAAO;IAI/B,qBACE,8OAAC;QACC,WAAU;QAMV,SAAS;kBAET,cAAA,8OAAC;YACC,WAAU;YAUV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAGjC,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;8CACZ,OAAO,SAAS,CAAC,MAAM,CAAC,GAAG,WAAW;;;;;;8CAGzC,8OAAC;;sDACC,8OAAC;4CAAI,WAAU;sDAAiB,OAAO,SAAS;;;;;;sDAChD,8OAAC;4CAAI,WAAU;sDAAwB;;;;;;;;;;;;;;;;;;sCAI3C,8OAAC;4BACC,SAAS;4BACT,WAAU;sCACX;;;;;;;;;;;;8BAMH,8OAAC;oBACC,WAAU;oBACV,UAAU,OAAO;wBACf,EAAE,cAAc;wBAChB,IAAI;4BACA,MAAM,QAAQ;gCACV,cAAc;gCACd,YAAY,OAAO,MAAM;gCACzB,SAAS;4BACb;4BAEA;4BACA;wBACJ,EAAE,OAAM,CAAC;oBACX;;wBAEG,CAAC,wBAEE,8OAAC;4BAAM,WAAU;;8CACb,8OAAC;oCACD,MAAK;oCACL,WAAU;oCAKV,SAAS;oCACT,UAAU,WAAW,gBAAgB,CAAC;oCACtC,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,OAAO;;;;;;gCAE1C,gBAAgB,CAAC,uBAEd,8OAAC;oCAAK,WAAU;;wCAAwB;sDAEpC,8OAAC;4CAAI,WAAU;sDAAwB;;;;;;;;;;;yDAM3C,8OAAC;oCAAK,WAAU;;wCAAwB;sDAEpC,8OAAC;4CAAI,WAAU;sDAAwB;;;;;;;;;;;;;;;;;iDASnD,8OAAC;4BAAK,WAAU;sCAAwB;;;;;;sCAO9C,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCACC,MAAK;oCACL,SAAS;oCACT,WAAU;8CAKX;;;;;;8CAID,8OAAC;oCACC,MAAK;oCACL,WAAU;8CAMX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb"}},
    {"offset": {"line": 750, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/components/ReadIndicator.tsx"],"sourcesContent":["export function ReadIndicator({\r\n    isRead\r\n}: {\r\n    isRead: boolean\r\n}) {\r\n\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-1 text-xs\">\r\n            {isRead \r\n            ?(\r\n                <>\r\n                {/* Двойная галочка - прочитано */}\r\n                    <svg \r\n                        className=\"w-4 h-4 text-blue-400\" \r\n                        viewBox=\"0 0 24 24\" \r\n                        fill=\"none\"\r\n                    >\r\n                        <path \r\n                            d=\"M1 12l4 4L15 6M9 12l4 4L23 6\" \r\n                            stroke=\"currentColor\" \r\n                            strokeWidth=\"2\" \r\n                            strokeLinecap=\"round\" \r\n                            strokeLinejoin=\"round\"\r\n                        />\r\n                    </svg>\r\n                </>\r\n            ):(\r\n                <>\r\n                    {/* Одна галочка - доставлено */}\r\n                    <svg \r\n                        className=\"w-4 h-4 text-gray-400\" \r\n                        viewBox=\"0 0 24 24\" \r\n                        fill=\"none\"\r\n                    >\r\n                        <path \r\n                            d=\"M5 12l4 4L19 6\" \r\n                            stroke=\"currentColor\" \r\n                            strokeWidth=\"2\" \r\n                            strokeLinecap=\"round\" \r\n                            strokeLinejoin=\"round\"\r\n                        />\r\n                    </svg>\r\n                    <span className=\"text-gray-400\">доставлено</span>\r\n                </>\r\n            )}\r\n        </div>\r\n    )\r\n}"],"names":[],"mappings":";;;;;;AAAO,SAAS,cAAc,EAC1B,MAAM,EAGT;IAGG,qBACI,8OAAC;QAAI,WAAU;kBACV,uBAEG;sBAEI,cAAA,8OAAC;gBACG,WAAU;gBACV,SAAQ;gBACR,MAAK;0BAEL,cAAA,8OAAC;oBACG,GAAE;oBACF,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;;;;;;;;;;0CAK3B;;8BAEI,8OAAC;oBACG,WAAU;oBACV,SAAQ;oBACR,MAAK;8BAEL,cAAA,8OAAC;wBACG,GAAE;wBACF,QAAO;wBACP,aAAY;wBACZ,eAAc;wBACd,gBAAe;;;;;;;;;;;8BAGvB,8OAAC;oBAAK,WAAU;8BAAgB;;;;;;;;;;;;;AAKpD"}},
    {"offset": {"line": 822, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/anonlovemain/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nexport const dynamic = \"force-dynamic\";\r\n\r\nimport { useState, useEffect, useRef, use } from \"react\"\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useAuth } from \"../things/hooks/useAuth\";\r\nimport { useMessages, useDialogs } from \"../things/hooks/useMessages\";\r\nimport { sighOut } from \"../things/utils/auth\";\r\nimport { useSwipe } from \"../things/hooks/useSwipe\";\r\nimport { useCheckMobile } from \"../things/hooks/checkMobile\";\r\nimport {parseBackendDate, parseDate} from \"../things/utils/parseDate\"\r\nimport {ModalProfile} from \"../modal/modalProfile\"\r\nimport { useMessageRead } from \"../things/hooks/useCheckMsg\";\r\nimport { ReadIndicator } from \"../createcard/components/ReadIndicator\"; // индикатор прочтения сообзения\r\n\r\n\r\n\r\nexport default function Page() {\r\n    const router = useRouter();\r\n\r\n    const {user, profile, loading: authLoading} = useAuth();\r\n    \r\n    const {inbox, sent, sendMessage: send, loading: messageLoading, refresh} = useMessages(user?.id || null);\r\n\r\n    const dialogs = useDialogs(inbox, sent, user?.id || \"\", profile?.public_id || \"\");\r\n    const [activeDialogId, setActiveDialogId] = useState<string | null>(null);\r\n    const activeDialog = dialogs.find((d) => d.userId === activeDialogId);\r\n\r\n    // const {isRead} = useMessageRead()\r\n\r\n    const [openChat, setOpenChat] = useState(false);\r\n    const isMobile = useCheckMobile()\r\n\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    const idRef = useRef<HTMLInputElement>(null);\r\n\r\n    // ответ на сообщение\r\n    const [replyToUserId, setreplyToUserId] = useState<{id: string; isAnon: boolean} | null>(null); //id\r\n\r\n    const [openProfile, setOpenProfile] = useState(false);\r\n\r\n    //открыл чат и записал\r\n    const [activeChatUserId, setActiveChatUserId] = useState<string | null>(null);\r\n\r\n    const [openModalProfile, setOpenModalProfile] = useState(false); // state модалка профиля\r\n\r\n\r\n\r\n    // свайп для мобилки\r\n    const chatSwipe = useSwipe({\r\n        onSwipeRight: () => {\r\n            if (!isMobile) return;\r\n            setOpenChat(false)\r\n        }\r\n    })\r\n    // swipe close profile mobile\r\n    const profileSwipe = useSwipe({\r\n        onSwipeLeft: () => {\r\n            if (!isMobile) return;\r\n            setOpenProfile(false)\r\n        },\r\n        onSwipeRight: () => {\r\n            if (!isMobile) return;\r\n            setOpenProfile(true)\r\n        }\r\n    })\r\n\r\n    useEffect(() => {\r\n        ;\r\n    },[])\r\n    \r\n    // автовставка id\r\n    useEffect(() => {\r\n        if (isOpen && idRef.current) {\r\n            idRef.current.value = replyToUserId?.id || ''\r\n        }\r\n    }, [isOpen, replyToUserId])\r\n\r\n    // редирект если неавторизован\r\n    useEffect(() => {\r\n        if (authLoading) return;\r\n\r\n        if(!user){\r\n            router.replace('/anonlove/auth')\r\n        }\r\n    }, [user, authLoading,router])\r\n\r\n    \r\n    \r\n\r\n    useEffect(() => {\r\n        if(!isMobile){\r\n            setOpenChat(false)\r\n        }\r\n    }, [isMobile])\r\n\r\n    \r\n    \r\n    \r\n    \r\n    const handleSignOut = async () => {\r\n        await sighOut()\r\n        router.push('/anonlove/auth')\r\n    }\r\n\r\n    if (authLoading) {\r\n        return (\r\n            <div className=\"bg-black min-h-screen flex items-center justify-center text-white\">\r\n                ЗагрузОчка...\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative bg-black min-h-screen max-h-screen flex flex-col overflow-hidden\">\r\n\r\n            {/* сообщения */}\r\n            <main \r\n                className=\"relative flex-1 text-white flex md:flex-row flex-col overflow-hidden\"\r\n                {...(!openChat ? profileSwipe : {})}\r\n                onClick={() => {\r\n                    if(openProfile) setOpenProfile(false)\r\n                }}\r\n            >\r\n                {/* ДИАЛОГИ */}\r\n                <div \r\n                    className={`absolute inset-0 bg-[#12080b] \r\n                            overflow-y-auto\r\n                            transition-transform duration-300 ease-out will-change-transform\r\n                            md:static md:translate-x-0 md:w-1/2\r\n                            ${isMobile && openChat ? \"-translate-x-full\" : \"translate-x-0\"}\r\n                            ${isMobile ? \"\" : \"border-r border-[#d91c558b]\"}\r\n                        `}\r\n                    \r\n                    >\r\n\r\n                    <div className=\"flex w-full relative bg-white/10 backdrop-blur-md\">\r\n\r\n                        <div \r\n                            className=\"absolute left-2 top-1/2 -translate-y-1/2 rounded-full bg-white/10 h-8 w-15 flex justify-center items-center\r\n                                        hover:bg-white/20 transition-colors\r\n                            \">\r\n\r\n                            <button \r\n                                onClick={() => {setOpenProfile(true)}}\r\n                                className=\"w-8 h-8 rounded-full flex justify-center items-center\">\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 32 32\"><title>Menu SVG Icon</title><path fill=\"none\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 8h24M4 16h24M4 24h24\"/></svg>\r\n                            </button>\r\n                        </div>\r\n\r\n                        <button \r\n                            className=\"p-2 rounded-md w-full text-center flex justify-center items-center \"\r\n                        >\r\n                            <span className=\"medium\">Чаты</span>\r\n                        </button>\r\n\r\n                        <div\r\n                            className=\"absolute bottom-1/2 translate-y-1/2 right-2\"\r\n                        >\r\n                           {/* кнопка написать */}\r\n                            <AnimatedButton\r\n                                openModal={() => {\r\n                                    router.push(`createcard?type=send`);\r\n                                }}\r\n                            >   \r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 32 32\"><path fill=\"none\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M2 4h28v18H16l-8 7v-7H2Z\"/></svg>\r\n                            </AnimatedButton>\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    {dialogs.map((dialog) => {\r\n                        const avatar = dialog.displayId.charAt(1).toUpperCase()\r\n                        const title = dialog.displayId\r\n                        const timeSend = parseDate(dialog.lastMessage.created_at)\r\n                            \r\n                        return(\r\n                            <button\r\n                                key={dialog.userId}\r\n                                className=\" p-2 rounded-lg w-full\"\r\n                                onClick={() => {\r\n                                    setActiveDialogId(dialog.userId), \r\n                                    setOpenChat(true),\r\n                                    setActiveChatUserId(dialog.displayId)\r\n                                }}\r\n                            > \r\n                                <div className={`flex p-3 items-center relative gap-2  rounded-2xl transition-colors\r\n                                    ${dialog.userId === activeDialogId ? \"bg-[#5b5b5ba2]\" : \"bg-[#949494a2]\"}\r\n                                    `}>\r\n                                    <span\r\n                                        className=\"flex bg-red-500 w-8 h-8 items-center justify-center rounded-full text-lg font-bold\"\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation()\r\n                                            setOpenModalProfile(true)\r\n                                            setActiveDialogId(dialog.userId)\r\n                                        }}\r\n                                    >\r\n                                        {avatar}\r\n                                    </span>\r\n\r\n                                    <span className=\"font-semibold\"\r\n                                    >\r\n                                        {title}\r\n                                    </span>\r\n\r\n                                    <p className=\"text-[10px] flexC text-center text-gray-400 h-10\r\n                                            absolute bottom-1/2 translate-y-1/2  right-2 \">\r\n                                        {timeSend}\r\n                                    </p>\r\n                                </div>\r\n                            </button>  \r\n                        )\r\n                    })}\r\n\r\n                    \r\n                </div>\r\n                \r\n                {/* ===== ЧАТ ===== */}\r\n                <div \r\n                    {...(isMobile ? chatSwipe : {})}\r\n                    className={`\r\n                        absolute inset-0 bg-[#12080b]\r\n                        overflow-y-auto\r\n                        transition-transform duration-300 ease-in-out will-change-transform\r\n                        md:static md:translate-x-0 md:w-1/2\r\n                        ${openChat ? \"translate-x-0\" : \"translate-x-full\"}\r\n                    `}>\r\n\r\n                    {/* header mobile */}\r\n                    {isMobile ? (\r\n                        <div className=\"sticky top-0 w-full grid grid-cols-3 items-center z-20\">\r\n                            <button\r\n                                className=\"flex justify-center items-center  bg-white/10 backdrop-blur-2xl m-2 w-15 h-8 text-center rounded-full z-10\"\r\n                                onClick={() => setOpenChat(false)}\r\n                            >\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\r\n                                    <path fill=\"currentColor\" d=\"M16.88 2.88a1.25 1.25 0 0 0-1.77 0L6.7 11.29a.996.996 0 0 0 0 1.41l8.41 8.41c.49.49 1.28.49 1.77 0s.49-1.28 0-1.77L9.54 12l7.35-7.35c.48-.49.48-1.28-.01-1.77\"/>\r\n                                </svg>\r\n                            </button>\r\n\r\n                            <button\r\n                                className=\"bg-white/10 backdrop-blur-2xl m-2  h-8 rounded-full\"\r\n                            >\r\n                                {activeChatUserId}\r\n                            </button>\r\n\r\n                            <button\r\n                                className=\"flex justify-center items-center justify-self-end bg-white/10 backdrop-blur-2xl m-2 w-15 h-8 text-center rounded-full z-10\"\r\n                                onClick={() => {\r\n                                    router.push(`createcard?type=send&to=${encodeURIComponent(activeChatUserId ?? '')}`)\r\n\r\n                                }}\r\n                            >\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 14 14\">\r\n                                    <g fill=\"none\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                        <path d=\"M7.5.5h-5a1 1 0 0 0-1 1v9l-1 3l4-1h8a1 1 0 0 0 1-1v-5\"/>\r\n                                        <path d=\"m8.363 8.137l-3 .54l.5-3.04l4.73-4.71a.999.999 0 0 1 1.42 0l1.06 1.06a1.001 1.001 0 0 1 0 1.42z\"/>\r\n                                    </g>\r\n                                </svg>\r\n                            </button>\r\n\r\n                        </div>\r\n                    ): (\r\n                        <div className={`w-full  p-2 rounded-b-2xl bg-[#7959631c]\r\n                                ${activeDialog ? \"flexC\": \"hidden\"} \r\n                        `}>\r\n\r\n                            <div className=\"flexC bg-white/10 rounded-full w-28 select-none\"> \r\n                                {activeChatUserId}\r\n                            </div>\r\n\r\n                        </div>\r\n                    )}\r\n\r\n                    \r\n                    <div className=\"p-2 space-y-2\">\r\n                        {activeDialog?.messages.map(message => {\r\n                            const avatar = message.from_display_id.charAt(1).toUpperCase()\r\n                            const nameLabel = message.from_display_id\r\n                            const bodyText: any = \"тебе тут что то пришло, малышка\"\r\n                            const isMine = message.from_user === user?.id\r\n                            const date = parseDate(message.created_at)\r\n\r\n                            return (\r\n                                <div\r\n                                    key={message.id}\r\n                                    className={`flex flex-col relative w-full transition hover:bg-white/10\r\n                                        ${isMine ? \"items-end\" : \"items-start\"}\r\n                                    `}\r\n                                >\r\n                                    <div\r\n                                        className={`flex flex-col items-center justify-center p-2 gap-2 w-1/2 rounded-2xl cursor-pointer \r\n                                            ${isMine ? \"bg-[#ff00666d]\" : \"bg-white/50\"}\r\n                                        `}\r\n                                        onClick={() => {\r\n                                            router.push(`createcard?isMine=${isMine}&id=${encodeURIComponent(message.id)}&type=recieve&to=${encodeURIComponent(message?.from_display_id ?? '')}`)\r\n                                        }}\r\n                                    >\r\n                                        <div className=\"flexC gap-2\"> \r\n                                        {/* avatar */}\r\n                                            <div\r\n                                                className=\"md:w-6 md:h-6 w-8 h-8\r\n                                                        rounded-full bg-red-500\r\n                                                        flex items-center justify-center\r\n                                                        text-md font-bold shrink-0\"\r\n                                            >\r\n                                                {avatar}\r\n                                            </div>\r\n\r\n                                        {/* text */}\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"font-semibold medium\">\r\n                                                    {nameLabel}\r\n                                                </span>\r\n                                                <span className=\"small line-clamp-2\">\r\n                                                    {``}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* date */}\r\n                                        <div className=\"text-[9px] text-[#cdcdcd] \"> \r\n                                            {date}\r\n                                        </div>\r\n\r\n                                        <ReadIndicator\r\n                                            isRead={isRead}\r\n                                        />\r\n\r\n                                    </div>\r\n\r\n                                    {/* reply button — только для чужих сообщений */}\r\n                                    {!isMine && (\r\n                                        <button\r\n                                            className=\"absolute top-1/2 right-1 -translate-y-1/2\"\r\n                                            onClick={() => {\r\n                                                router.push(`createcard?isMine=${isMine}&type=send&to=${encodeURIComponent(message?.from_display_id ?? '')}`)\r\n\r\n                                            }}\r\n                                        >\r\n                                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 14 14\">\r\n                                                <g fill=\"none\" stroke=\"currentColor\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                                    <path d=\"M7.5.5h-5a1 1 0 0 0-1 1v9l-1 3l4-1h8a1 1 0 0 0 1-1v-5\"/>\r\n                                                    <path d=\"m8.363 8.137l-3 .54l.5-3.04l4.73-4.71a.999.999 0 0 1 1.42 0l1.06 1.06a1.001 1.001 0 0 1 0 1.42z\"/>\r\n                                                </g>\r\n                                            </svg>\r\n                                        </button>\r\n                                    )}\r\n\r\n                                    {/* <div className=\"w-full mx-auto bg-white/20 h-px\" /> */}\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n\r\n                    \r\n                </div>\r\n\r\n                \r\n            </main>\r\n\r\n            {/* profile left side */}\r\n            <div\r\n                {...(isMobile ? profileSwipe : {})}\r\n                className={`flex flex-1 flex-col items-center absolute bg-black/50 backdrop-blur-md transition-transform duration-150 ease-in-out will-change-transform\r\n                    ${openProfile ? \"translate-x-0\" : \"-translate-x-full \"}\r\n                    ${isMobile ? \"inset-0\" : \"w-1/3 h-full\"}\r\n                    `}\r\n                onClick={(e) => {\r\n                    e.stopPropagation()\r\n                }}\r\n            >\r\n                <div\r\n                    className=\"bg-white/20 backdrop-blur-2xl w-full flexC p-2 rounded-b-2xl\"\r\n                >\r\n                    {profile?.public_id} \r\n                </div>\r\n\r\n                <div className=\"absolute bottom-0 bg-white/10 p-2 backdrop-blur-md w-full flexC rounded-t-2xl\">\r\n                    <button\r\n                        className=\"text-red-500\"\r\n                        onClick={() => {\r\n                            handleSignOut()\r\n                        }}\r\n                    >\r\n                        Выйти\r\n                    </button>\r\n                </div>\r\n\r\n                <button\r\n                    className=\"absolute h-40 top-1/2 -translate-y-1/2 right-0 bg-white/20 backdrop-blur-2xl flexC p-1 \r\n                            animate-pulse rounded-l-2xl\r\n                    \"\r\n                    onClick={() => setOpenProfile(false)}\r\n                >\r\n                    {`>`}\r\n                </button>\r\n\r\n            </div>\r\n\r\n            {/* modal profile */}\r\n            <ModalProfile \r\n            isOpen={openModalProfile} \r\n            onClose={() => {setOpenModalProfile(false)}}\r\n            fromUser={user?.id}\r\n            toUser={activeDialog}\r\n            refresh={() => refresh()}\r\n            />\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\n\r\nfunction AnimatedButton({ \r\n    children,\r\n    openModal \r\n}: {\r\n    children: React.ReactNode,\r\n    openModal: () => void\r\n\r\n}) {\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const buttonRef = useRef<HTMLButtonElement>(null);\r\n    const animationRef = useRef<number>(0);\r\n    const isHovering = useRef(false);\r\n\r\n    const sizeRef = useRef({w:0,h:0})\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current\r\n        const button = buttonRef.current\r\n        if(!canvas || !button) return;\r\n\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if(!ctx) return;\r\n\r\n        const updateSize = () => {\r\n            const rect = canvas.parentElement!.getBoundingClientRect();\r\n            const dpr = window.devicePixelRatio || 1;\r\n\r\n            sizeRef.current.w = rect.width;\r\n            sizeRef.current.h = rect.height;\r\n\r\n            canvas.width = rect.width * dpr;\r\n            canvas.height = rect.height * dpr;\r\n            canvas.style.width = rect.width + \"px\"\r\n            canvas.style.height = rect.height + \"px\"\r\n            ctx.setTransform(dpr,0,0,dpr,0,0)\r\n        }\r\n        updateSize()\r\n\r\n        function getBtnCenter(){\r\n            const btn = button!.getBoundingClientRect()\r\n            const cvs = canvas!.getBoundingClientRect()\r\n            return{\r\n                x: cvs.width/2,\r\n                y: cvs.height/2\r\n            }\r\n        }\r\n\r\n        const particles: {\r\n            x: number,\r\n            y: number,\r\n            radius: number,\r\n            alpha: number,\r\n            life: number,\r\n            vx: number,\r\n            vy: number\r\n        }[] = []\r\n\r\n        const speed = 50\r\n        let lastTime = performance.now()\r\n\r\n        function animate(currentTime: number) {\r\n            if (!ctx || !canvas) return\r\n            const deltaTime = (currentTime - lastTime) / 1000\r\n            lastTime = currentTime\r\n\r\n            const {w , h} = sizeRef.current\r\n            ctx.clearRect(0,0, w, h)\r\n\r\n            \r\n            if(Math.random() < 0.06) {\r\n                const angle = Math.random() * Math.PI * 2\r\n                particles.push({\r\n                    x: Math.random() * w,\r\n                    y: Math.random() * h,\r\n                    radius: 1,\r\n                    alpha: 1,\r\n                    life: 1,\r\n                    vx: Math.cos(angle) * speed,\r\n                    vy: Math.sin(angle) * speed\r\n                })\r\n            }\r\n            const target = getBtnCenter()\r\n\r\n            for (let i = particles.length -1; i >= 0; i--) {\r\n                const p = particles[i];\r\n\r\n                p.life -= deltaTime * 0.3;\r\n                p.alpha = p.life\r\n                \r\n                if(isHovering.current) {\r\n                    const dx = target.x - p.x\r\n                    const dy = target.y - p.y\r\n                    const dist = Math.sqrt(dx * dx + dy * dy) + 0.001\r\n\r\n                    const force = Math.max(0, 1 - dist / 700) * 400;\r\n\r\n                    p.vx += (dx / dist) * force *deltaTime\r\n                    p.vy += (dy / dist) * force *deltaTime\r\n                } \r\n\r\n                // max speed\r\n                const speed = Math.hypot(p.vx, p.vy);\r\n                const maxSpeed = 160;\r\n                if (speed > maxSpeed) {\r\n                    p.vx = (p.vx / speed) * maxSpeed;\r\n                    p.vy = (p.vy / speed) * maxSpeed;\r\n                }\r\n\r\n                p.x += p.vx * deltaTime;\r\n                p.y += p.vy * deltaTime;\r\n\r\n                \r\n\r\n                if (p.alpha <= 0) {\r\n                    particles.splice(i, 1)\r\n                    continue\r\n                }\r\n                \r\n\r\n                ctx.globalAlpha = p.alpha;\r\n                ctx.shadowBlur = 1;\r\n                ctx.shadowColor = \"white\";\r\n                ctx.fillStyle = 'white';\r\n\r\n                ctx.beginPath();\r\n                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n            ctx.globalAlpha = 1\r\n            animationRef.current = requestAnimationFrame(animate)\r\n        }\r\n\r\n        animationRef.current = requestAnimationFrame(animate)\r\n        window.addEventListener('resize', updateSize)\r\n\r\n        return () => {\r\n            if (animationRef.current){\r\n                cancelAnimationFrame(animationRef.current)\r\n            }\r\n            window.removeEventListener('resize', updateSize)\r\n        }\r\n    }, [])\r\n\r\n    return (\r\n        <div className=\"relative flex justify-center items-center h-full w-full\">\r\n            <canvas\r\n                ref={canvasRef}\r\n                className=\"absolute w-full h-full pointer-events-none z-1\"\r\n            >\r\n            </canvas>\r\n            <button\r\n                ref={buttonRef}\r\n                onClick={() => openModal()}\r\n                onMouseEnter={() => (isHovering.current = true)}\r\n                onMouseLeave={() => (isHovering.current = false)}\r\n                className=\"relative flex items-center justify-center p-2 h-8 w-15 bg-white/10 rounded-full hover:bg-white/40 transition-colors z-2\"\r\n            >\r\n                {children}\r\n            </button>\r\n\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}