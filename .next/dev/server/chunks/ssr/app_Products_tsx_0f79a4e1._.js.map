{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/app/Products.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\n\r\ntype Product = {\r\n  id: string | number;\r\n  name: string;\r\n  image?: string | null;\r\n  price?: number | null;\r\n  description?: string | null;\r\n};\r\n\r\nexport default function Products({\r\n  initialProducts,\r\n  pageSize,\r\n}: {\r\n  initialProducts: Product[];\r\n  pageSize: number;\r\n}) {\r\n  const [products, setProducts] = useState<Product[]>(initialProducts);\r\n  const [loading, setLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const pageRef = useRef(1); // текущая страница, первая уже загружена\r\n\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      if (\r\n        window.innerHeight + window.scrollY >=\r\n          document.body.offsetHeight - 200 &&\r\n        !loading &&\r\n        hasMore\r\n      ) {\r\n        fetchNextPage();\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n    return () => window.removeEventListener(\"scroll\", handleScroll);\r\n  }, [loading, hasMore]);\r\n\r\n  const fetchNextPage = async () => {\r\n    setLoading(true);\r\n    const from = pageRef.current * pageSize;\r\n    const to = from + pageSize - 1;\r\n\r\n    const { data } = await supabase\r\n      .from(\"products\")\r\n      .select(\"*\")\r\n      .order(\"id\")\r\n      .range(from, to);\r\n\r\n    if (!data || data.length < pageSize) setHasMore(false);\r\n\r\n    setProducts((prev) => [...prev, ...(data ?? [])]);\r\n    pageRef.current += 1;\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <section className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\r\n        {products.map((p) => (\r\n          <article\r\n            key={p.id}\r\n            className=\"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow hover:shadow-lg transition\"\r\n          >\r\n            <div className=\"w-full h-48 bg-gray-100 dark:bg-gray-700 overflow-hidden\">\r\n              <img\r\n                src={p.image ?? \"https://via.placeholder.com/400x300?text=No+Image\"}\r\n                alt={p.name}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n              <h3 className=\"text-sm font-medium text-gray-900 dark:text-gray-100 line-clamp-2\">\r\n                {p.name}\r\n              </h3>\r\n              {p.description && (\r\n                <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-300\">\r\n                  {p.description}\r\n                </p>\r\n              )}\r\n              <div className=\"mt-4 text-lg font-semibold text-indigo-600 dark:text-indigo-400\">\r\n                {p.price != null ? `${p.price} ₽` : \"—\"}\r\n              </div>\r\n            </div>\r\n          </article>\r\n        ))}\r\n      </div>\r\n\r\n      {loading && <p className=\"text-center mt-4\">Загрузка...</p>}\r\n      {!hasMore && <p className=\"text-center mt-4\">Больше продуктов нет</p>}\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;;;;AAFA;;;;AAae,SAAS,SAAS,EAC/B,eAAe,EACf,QAAQ,EAIT;IACC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAY;IACpD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,UAAU,IAAA,+MAAM,EAAC,IAAI,yCAAyC;IAEpE,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe;YACnB,IACE,OAAO,WAAW,GAAG,OAAO,OAAO,IACjC,SAAS,IAAI,CAAC,YAAY,GAAG,OAC/B,CAAC,WACD,SACA;gBACA;YACF;QACF;QAEA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;IACpD,GAAG;QAAC;QAAS;KAAQ;IAErB,MAAM,gBAAgB;QACpB,WAAW;QACX,MAAM,OAAO,QAAQ,OAAO,GAAG;QAC/B,MAAM,KAAK,OAAO,WAAW;QAE7B,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SACpB,IAAI,CAAC,YACL,MAAM,CAAC,KACP,KAAK,CAAC,MACN,KAAK,CAAC,MAAM;QAEf,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,UAAU,WAAW;QAEhD,YAAY,CAAC,OAAS;mBAAI;mBAAU,QAAQ,EAAE;aAAE;QAChD,QAAQ,OAAO,IAAI;QACnB,WAAW;IACb;IAEA,qBACE,8OAAC;QAAQ,WAAU;;0BACjB,8OAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC,kBACb,8OAAC;wBAEC,WAAU;;0CAEV,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCACC,KAAK,EAAE,KAAK,IAAI;oCAChB,KAAK,EAAE,IAAI;oCACX,WAAU;;;;;;;;;;;0CAId,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAG,WAAU;kDACX,EAAE,IAAI;;;;;;oCAER,EAAE,WAAW,kBACZ,8OAAC;wCAAE,WAAU;kDACV,EAAE,WAAW;;;;;;kDAGlB,8OAAC;wCAAI,WAAU;kDACZ,EAAE,KAAK,IAAI,OAAO,GAAG,EAAE,KAAK,CAAC,EAAE,CAAC,GAAG;;;;;;;;;;;;;uBArBnC,EAAE,EAAE;;;;;;;;;;YA4Bd,yBAAW,8OAAC;gBAAE,WAAU;0BAAmB;;;;;;YAC3C,CAAC,yBAAW,8OAAC;gBAAE,WAAU;0BAAmB;;;;;;;;;;;;AAGnD"}}]
}