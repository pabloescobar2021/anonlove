{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/useRandColor.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState,useEffect, useRef } from \"react\"\r\n\r\ntype Color = {r: number, g: number, b: number, a: number}\r\nconst lerp = (a: number, b: number, t: number) => {\r\n    return a + (b - a) * t\r\n}\r\nconst smoothStep = (t: number) => {\r\n    return t * t * (3 - 2 * t)\r\n}\r\nconst mixColor = (from: Color, to: Color, t: number): Color => {\r\n    const k = smoothStep(t)\r\n    return{\r\n        r: lerp(from.r, to.r, k),\r\n        g: lerp(from.g, to.g, k),\r\n        b: lerp(from.b, to.b, k),\r\n        a: lerp(from.a, to.a, k),\r\n    }\r\n}\r\nconst randomColor = (): Color => {\r\n    return {\r\n        r: Math.floor(Math.random() * 256),\r\n        g: 0,\r\n        b: 0,\r\n        a: 0.1\r\n    }\r\n}\r\n\r\nexport function useRandColor() {\r\n    const [bg, setBg] = useState<Color>({r: 0, g: 0, b: 0, a: 0.1})\r\n    const colorRef = useRef<Color>(bg)\r\n    const frameRef = useRef<number | null>(null)\r\n\r\n\r\n    useEffect(() => {\r\n        let start: number | null = null\r\n        let from = colorRef.current\r\n        let to = randomColor()\r\n        const duration = 3000 \r\n\r\n        const animate = (time: number) => {\r\n            if (!start) start = time\r\n            const t = Math.min((time - start) / duration, 1)\r\n            const next = mixColor(from, to, t)\r\n\r\n            colorRef.current = next\r\n            setBg(next)\r\n\r\n            if (t < 1) {\r\n                frameRef.current = requestAnimationFrame(animate)\r\n            } else{\r\n                from = to\r\n                to = randomColor()\r\n                start = null\r\n                frameRef.current = requestAnimationFrame(animate)\r\n            }\r\n        }\r\n        frameRef.current = requestAnimationFrame(animate)\r\n\r\n        return () => {\r\n            if (frameRef.current) cancelAnimationFrame(frameRef.current)\r\n        }\r\n    },[])\r\n\r\n    return {\r\n        bg\r\n    }\r\n}"],"names":[],"mappings":";;;;AAEA;AAFA;;AAKA,MAAM,OAAO,CAAC,GAAW,GAAW;IAChC,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI;AACzB;AACA,MAAM,aAAa,CAAC;IAChB,OAAO,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC;AAC7B;AACA,MAAM,WAAW,CAAC,MAAa,IAAW;IACtC,MAAM,IAAI,WAAW;IACrB,OAAM;QACF,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;QACtB,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;QACtB,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;QACtB,GAAG,KAAK,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE;IAC1B;AACJ;AACA,MAAM,cAAc;IAChB,OAAO;QACH,GAAG,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK;QAC9B,GAAG;QACH,GAAG;QACH,GAAG;IACP;AACJ;AAEO,SAAS;IACZ,MAAM,CAAC,IAAI,MAAM,GAAG,IAAA,iNAAQ,EAAQ;QAAC,GAAG;QAAG,GAAG;QAAG,GAAG;QAAG,GAAG;IAAG;IAC7D,MAAM,WAAW,IAAA,+MAAM,EAAQ;IAC/B,MAAM,WAAW,IAAA,+MAAM,EAAgB;IAGvC,IAAA,kNAAS,EAAC;QACN,IAAI,QAAuB;QAC3B,IAAI,OAAO,SAAS,OAAO;QAC3B,IAAI,KAAK;QACT,MAAM,WAAW;QAEjB,MAAM,UAAU,CAAC;YACb,IAAI,CAAC,OAAO,QAAQ;YACpB,MAAM,IAAI,KAAK,GAAG,CAAC,CAAC,OAAO,KAAK,IAAI,UAAU;YAC9C,MAAM,OAAO,SAAS,MAAM,IAAI;YAEhC,SAAS,OAAO,GAAG;YACnB,MAAM;YAEN,IAAI,IAAI,GAAG;gBACP,SAAS,OAAO,GAAG,sBAAsB;YAC7C,OAAM;gBACF,OAAO;gBACP,KAAK;gBACL,QAAQ;gBACR,SAAS,OAAO,GAAG,sBAAsB;YAC7C;QACJ;QACA,SAAS,OAAO,GAAG,sBAAsB;QAEzC,OAAO;YACH,IAAI,SAAS,OAAO,EAAE,qBAAqB,SAAS,OAAO;QAC/D;IACJ,GAAE,EAAE;IAEJ,OAAO;QACH;IACJ;AACJ"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/utils/supabase/alSupabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,WAAW,IAAA,uLAAY"}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/auth.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\n\r\nexport async function getCurrentUser() {\r\n    const {data, error} = await supabase.auth.getUser()\r\n    if(error) return\r\n    return data.user\r\n}\r\n\r\nexport async function getUserProfile(userId: string) {\r\n    const {data, error} = await supabase\r\n        .from(\"users\")\r\n        .select(\"public_id, username\")\r\n        .eq(\"id_user\", userId)\r\n        .single()\r\n    if(error) return null\r\n    return data\r\n}\r\n\r\nexport async function sighOut() {\r\n    const {error} = await supabase.auth.signOut()\r\n    if(error) throw error\r\n}\r\n\r\nexport function onAuthStateChange(callback: (user:any) => void) {\r\n    const {data: listener} = supabase.auth.onAuthStateChange((event,session) => {\r\n        callback(session?.user || null)\r\n    })\r\n    return listener.subscription\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,eAAe;IAClB,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,OAAO;IACjD,IAAG,OAAO;IACV,OAAO,KAAK,IAAI;AACpB;AAEO,eAAe,eAAe,MAAc;IAC/C,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,SACL,MAAM,CAAC,uBACP,EAAE,CAAC,WAAW,QACd,MAAM;IACX,IAAG,OAAO,OAAO;IACjB,OAAO;AACX;AAEO,eAAe;IAClB,MAAM,EAAC,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,OAAO;IAC3C,IAAG,OAAO,MAAM;AACpB;AAEO,SAAS,kBAAkB,QAA4B;IAC1D,MAAM,EAAC,MAAM,QAAQ,EAAC,GAAG,2IAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,OAAM;QAC5D,SAAS,SAAS,QAAQ;IAC9B;IACA,OAAO,SAAS,YAAY;AAChC"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useAuth.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { getCurrentUser, getUserProfile, onAuthStateChange } from \"../utils/auth\"\r\n\r\nexport function useAuth() {\r\n    const [user, setUser] = useState<any>(null)\r\n    const [profile, setProfile] = useState<any>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            try {\r\n                const userData = await getCurrentUser()\r\n                setUser(userData)\r\n\r\n                if(userData) {\r\n                    const profileData = await getUserProfile(userData.id)\r\n                    setProfile(profileData)\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error loading user:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        loadUser()\r\n\r\n        const subscription = onAuthStateChange(async (newUser) => {\r\n            setUser(newUser)\r\n            if (newUser) {\r\n                const profileData = await getUserProfile(newUser.id)\r\n                setProfile(profileData)\r\n            } else {\r\n                setProfile(null)\r\n            }\r\n        })\r\n\r\n        return () => {\r\n            subscription.unsubscribe()\r\n        }\r\n    },[])\r\n\r\n    return {user,profile,loading}\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAKO,SAAS;IACZ,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAM;IACtC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAM;IAC5C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACN,MAAM,WAAW;YACb,IAAI;gBACA,MAAM,WAAW,MAAM,IAAA,4JAAc;gBACrC,QAAQ;gBAER,IAAG,UAAU;oBACT,MAAM,cAAc,MAAM,IAAA,4JAAc,EAAC,SAAS,EAAE;oBACpD,WAAW;gBACf;YACJ,EAAE,OAAO,OAAO;gBACZ,QAAQ,KAAK,CAAC,uBAAuB;YACzC,SAAU;gBACN,WAAW;YACf;QACJ;QACA;QAEA,MAAM,eAAe,IAAA,+JAAiB,EAAC,OAAO;YAC1C,QAAQ;YACR,IAAI,SAAS;gBACT,MAAM,cAAc,MAAM,IAAA,4JAAc,EAAC,QAAQ,EAAE;gBACnD,WAAW;YACf,OAAO;gBACH,WAAW;YACf;QACJ;QAEA,OAAO;YACH,aAAa,WAAW;QAC5B;IACJ,GAAE,EAAE;IAEJ,OAAO;QAAC;QAAK;QAAQ;IAAO;AAChC"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/messages.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\nimport { error } from \"console\";\r\nimport { ItemDto } from \"../types/type\";\r\n// to_user:users(id_user, rating)\r\nexport async function getInboxMessages(userId: string){\r\n    const {data, error} = await supabase\r\n        .from(\"messages_safe\")\r\n        .select(`\r\n            *\r\n            `)\r\n        .eq(\"to_user\", userId)\r\n        .order(\"created_at\", {ascending: true})\r\n    if(error) throw error;  \r\n\r\n    const messages = (data || []).map(msg => {\r\n        const anonSetting = msg.user_anonymous_settings?.[0]?.is_anon\r\n        return {\r\n            ...msg,\r\n            displayId: (anonSetting || msg.is_anon) ? \"Anon\" : msg.from_public_id,\r\n            username: (anonSetting || msg.is_anon) ? \"Anon\" : msg.from_username,\r\n        }\r\n    })\r\n\r\n    return messages \r\n}\r\n\r\nexport async function getCurrentMessage(messageId: string, userId: string, isMine?: string | null) {\r\n    console.log('Querying message:', { messageId, userId })\r\n    const {data, error} = await supabase\r\n    .from(\"messages_safe\")\r\n    .select(\"*\")\r\n    .eq(\"id\", messageId)\r\n    .eq(isMine===\"true\" ? \"from_user\" : \"to_user\", userId)\r\n    .maybeSingle()\r\n    console.log('Query result:', { data, error })\r\n    if (error) throw error\r\n    return data || []\r\n}\r\n\r\nexport async function getSentMessages(userId: string) {\r\n    const {data, error} = await supabase\r\n        .from('messages_safe')\r\n        .select(`\r\n            *`)\r\n        .eq(\"from_user\", userId)\r\n        .order(\"created_at\", {ascending: true})\r\n    \r\n    if(error) throw error\r\n    return data || []\r\n\r\n}\r\n\r\nexport async function sendMessage({\r\n    fromUserId,\r\n    toUserId,\r\n    toPublicId,\r\n    body,\r\n    isAnon\r\n}: {\r\n    fromUserId: string,\r\n    toUserId?: string,\r\n    toPublicId?: string,\r\n    body: ItemDto[],\r\n    isAnon?: boolean\r\n}) {\r\n    let receiverId = toUserId\r\n\r\n    if (!receiverId){\r\n        if (!toPublicId) throw new Error(\"Не указан пользователь, малыш\")\r\n            const {data: receiver, error: userError} = await supabase\r\n                .from(\"users\") \r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", toPublicId)\r\n                .single()\r\n            if(userError || !receiver){\r\n                throw new Error(\"Пользователь не найден, кись\")\r\n            }\r\n        receiverId = receiver.id_user\r\n    }\r\n\r\n    const {data: toggle, error: toggleError} = await supabase.rpc(\"toggle_anonymous\", {\r\n                p_from: fromUserId, \r\n                p_to: receiverId, \r\n                p_is_anon: isAnon\r\n            })\r\n\r\n    if(toggleError) throw toggleError\r\n\r\n    const {error: messageError} = await supabase\r\n        .from(\"messages\")\r\n        .insert({\r\n            from_user: fromUserId,\r\n            to_user: receiverId,\r\n            body,\r\n        })\r\n    if(messageError) throw messageError\r\n\r\n    return toggle\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAIO,eAAe,iBAAiB,MAAc;IACjD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;;YAEL,CAAC,EACJ,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,cAAc;QAAC,WAAW;IAAI;IACzC,IAAG,OAAO,MAAM;IAEhB,MAAM,WAAW,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA;QAC9B,MAAM,cAAc,IAAI,uBAAuB,EAAE,CAAC,EAAE,EAAE;QACtD,OAAO;YACH,GAAG,GAAG;YACN,WAAW,AAAC,eAAe,IAAI,OAAO,GAAI,SAAS,IAAI,cAAc;YACrE,UAAU,AAAC,eAAe,IAAI,OAAO,GAAI,SAAS,IAAI,aAAa;QACvE;IACJ;IAEA,OAAO;AACX;AAEO,eAAe,kBAAkB,SAAiB,EAAE,MAAc,EAAE,MAAsB;IAC7F,QAAQ,GAAG,CAAC,qBAAqB;QAAE;QAAW;IAAO;IACrD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,WACT,EAAE,CAAC,WAAS,SAAS,cAAc,WAAW,QAC9C,WAAW;IACZ,QAAQ,GAAG,CAAC,iBAAiB;QAAE;QAAM;IAAM;IAC3C,IAAI,OAAO,MAAM;IACjB,OAAO,QAAQ,EAAE;AACrB;AAEO,eAAe,gBAAgB,MAAc;IAChD,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;aACJ,CAAC,EACL,EAAE,CAAC,aAAa,QAChB,KAAK,CAAC,cAAc;QAAC,WAAW;IAAI;IAEzC,IAAG,OAAO,MAAM;IAChB,OAAO,QAAQ,EAAE;AAErB;AAEO,eAAe,YAAY,EAC9B,UAAU,EACV,QAAQ,EACR,UAAU,EACV,IAAI,EACJ,MAAM,EAOT;IACG,IAAI,aAAa;IAEjB,IAAI,CAAC,YAAW;QACZ,IAAI,CAAC,YAAY,MAAM,IAAI,MAAM;QAC7B,MAAM,EAAC,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAC,GAAG,MAAM,2IAAQ,CACpD,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,aAAa,YAChB,MAAM;QACX,IAAG,aAAa,CAAC,UAAS;YACtB,MAAM,IAAI,MAAM;QACpB;QACJ,aAAa,SAAS,OAAO;IACjC;IAEA,MAAM,EAAC,MAAM,MAAM,EAAE,OAAO,WAAW,EAAC,GAAG,MAAM,2IAAQ,CAAC,GAAG,CAAC,oBAAoB;QACtE,QAAQ;QACR,MAAM;QACN,WAAW;IACf;IAER,IAAG,aAAa,MAAM;IAEtB,MAAM,EAAC,OAAO,YAAY,EAAC,GAAG,MAAM,2IAAQ,CACvC,IAAI,CAAC,YACL,MAAM,CAAC;QACJ,WAAW;QACX,SAAS;QACT;IACJ;IACJ,IAAG,cAAc,MAAM;IAEvB,OAAO;AACX"}},
    {"offset": {"line": 277, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/types/type.ts"],"sourcesContent":["export type BaseItem = {\r\n    id: number;\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    scaleX?: number,\r\n    scaleY?: number,\r\n    rotation?: number,\r\n    isSelected?: boolean\r\n}\r\n\r\nexport type TextItem = BaseItem & {\r\n    type: \"text\"\r\n    content: string\r\n    fontSize?: number\r\n    color?: string\r\n    isEditing: string\r\n}\r\n\r\nexport type GifItem = BaseItem & {\r\n    type: \"gif\",\r\n    src: string,\r\n    autoplay?: boolean\r\n    loop?: boolean\r\n}\r\n\r\nexport type Item = TextItem | GifItem\r\n\r\n\r\n// DTO\r\nexport type BaseItemDto = {\r\n    id: number\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    scaleX?: number,\r\n    scaleY?: number,\r\n    rotation?: number\r\n    type: \"text\" | \"gif\"\r\n}\r\nexport type TextItemDto = BaseItemDto & {\r\n    type: \"text\",\r\n    content: string,\r\n    fontSize?: number\r\n    color?: string\r\n}\r\nexport type GifItemDto = BaseItemDto & {\r\n    type: \"gif\",\r\n    src: string,\r\n    autoplay?: boolean\r\n    loop?: boolean\r\n}\r\nexport type ItemDto = TextItemDto | GifItemDto\r\n\r\n\r\n\r\nexport function itemDtoToItem(dto: ItemDto): Item {\r\n    if(dto.type === 'text') {\r\n        return {\r\n            ...dto, \r\n            isEditing: 'none', \r\n            isSelected: false\r\n        }\r\n    }\r\n\r\n    return {\r\n        ...dto, \r\n        isSelected: false\r\n    }\r\n}\r\nexport function itemDtoListToItems(dtos: ItemDto[]): Item[] {\r\n  return dtos.map(itemDtoToItem)\r\n}\r\n\r\nexport type Message = {\r\n    id: string,\r\n    body: ItemDto[],\r\n    created_at: string,\r\n    is_anon: boolean,\r\n    is_checked: boolean,\r\n    to_user_rating: number,\r\n    \r\n    from_user: string,\r\n    to_user: string,\r\n    from_display_id: string,\r\n    to_display_id: string,\r\n}\r\n\r\nexport type UiMessage = Omit<Message, \"body\"> & {\r\n    body: Item[]\r\n}\r\n\r\nexport type Viewport ={\r\n    scale: number,\r\n    offsetX: number,\r\n    offsetY: number\r\n}"],"names":[],"mappings":";;;;;;AA0DO,SAAS,cAAc,GAAY;IACtC,IAAG,IAAI,IAAI,KAAK,QAAQ;QACpB,OAAO;YACH,GAAG,GAAG;YACN,WAAW;YACX,YAAY;QAChB;IACJ;IAEA,OAAO;QACH,GAAG,GAAG;QACN,YAAY;IAChB;AACJ;AACO,SAAS,mBAAmB,IAAe;IAChD,OAAO,KAAK,GAAG,CAAC;AAClB"}},
    {"offset": {"line": 303, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/parseDate.ts"],"sourcesContent":["export function parseBackendDate(raw: string): Date {\r\n    if (!raw) return new Date(NaN)\r\n\r\n    return new Date(\r\n    raw\r\n      .replace(\" \", \"T\")\r\n      .replace(/\\.\\d+/, m => m.slice(0, 4)) // миллисекунды → 3 знака\r\n      .replace(/\\+00:?00$/, \"Z\"))            // +00 or +00:00 → Z\r\n\r\n}\r\n\r\nexport function parseDate(date: Date): string {\r\n    return date.toLocaleString(\"ru-RU\", {\r\n        day: \"2-digit\",\r\n        month: \"2-digit\",\r\n        year: \"numeric\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n    })\r\n}"],"names":[],"mappings":";;;;;;AAAO,SAAS,iBAAiB,GAAW;IACxC,IAAI,CAAC,KAAK,OAAO,IAAI,KAAK;IAE1B,OAAO,IAAI,KACX,IACG,OAAO,CAAC,KAAK,KACb,OAAO,CAAC,SAAS,CAAA,IAAK,EAAE,KAAK,CAAC,GAAG,IAAI,yBAAyB;KAC9D,OAAO,CAAC,aAAa,MAAiB,oBAAoB;;AAEjE;AAEO,SAAS,UAAU,IAAU;IAChC,OAAO,KAAK,cAAc,CAAC,SAAS;QAChC,KAAK;QACL,OAAO;QACP,MAAM;QACN,MAAM;QACN,QAAQ;IACZ;AACJ"}},
    {"offset": {"line": 328, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useMessages.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect, useMemo } from \"react\"\r\nimport { supabase } from \"@/utils/supabase/alSupabase\"\r\nimport { getInboxMessages, getSentMessages, sendMessage, getCurrentMessage } from \"../utils/messages\"\r\nimport { ItemDto, Item, Message, UiMessage, itemDtoListToItems } from \"../types/type\"\r\nimport { parseBackendDate } from \"../utils/parseDate\"\r\n\r\n\r\n\r\nexport function useMessages(userId: string | null) {\r\n    const [inbox, setInbox] = useState<any[]>([])\r\n    const [sent, setSent] = useState<any[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n\r\n\r\n    const loadMessage = async () => {\r\n        if(!userId) return\r\n\r\n        try{\r\n            setLoading(true)\r\n            const [inboxData, sentData] = await Promise.all([\r\n                getInboxMessages(userId), \r\n                getSentMessages(userId)\r\n            ])\r\n\r\n            setInbox(inboxData)\r\n            setSent(sentData)\r\n        } catch (error) {\r\n            console.error(\"Error loading messages:\", error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        loadMessage()\r\n    },[userId])\r\n\r\n    const send = async (\r\n        to: {publicId?: string, userId?: string}, \r\n        body: ItemDto[],\r\n        isAnon?: boolean \r\n    ) => {\r\n        if(!userId) throw new Error(\"User not logged in\")\r\n\r\n        let receiverId = to.userId\r\n\r\n        if (!receiverId){\r\n            if(!to.publicId) throw new Error(\"Не указан пользователь, малыш\")\r\n\r\n            const {data: receiver, error: userError} = await supabase\r\n                .from(\"users\") \r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", to.publicId)\r\n                .single()\r\n            if(userError || !receiver){\r\n                throw new Error(\"Пользователь не найден, кись\")\r\n            }\r\n            receiverId = receiver.id_user\r\n        }\r\n        \r\n        const {data, error} = await supabase.rpc(\"toggle_anonymous\", {\r\n            p_from: userId, \r\n            p_to: receiverId, \r\n            p_is_anon: isAnon\r\n        })\r\n        if(error) throw error\r\n\r\n        const {error: errorMsg} = await supabase\r\n            .from(\"messages\")\r\n            .insert({\r\n                from_user: userId, \r\n                to_user: receiverId, \r\n                body\r\n            })\r\n        if(errorMsg) throw errorMsg\r\n\r\n        await loadMessage()\r\n\r\n        return data\r\n    }\r\n\r\n    return {\r\n        inbox,\r\n        sent,\r\n        loading,\r\n        sendMessage: send,\r\n        refresh: loadMessage\r\n    }\r\n\r\n}\r\n\r\ntype UseCurrentMessageResult = {    \r\n    message: UiMessage | null,\r\n    loading: boolean\r\n}\r\nexport function useCurrentMessage(\r\n    userId: string | null, \r\n    messageId: string | null,\r\n    isMine?: string | null\r\n): UseCurrentMessageResult {\r\n    const [message, setMessage] = useState<UiMessage | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => {\r\n        if (!userId || !messageId) return\r\n\r\n        const loadMessage = async () => {\r\n            setLoading(true)\r\n            try{\r\n                const data = await getCurrentMessage(messageId, userId, isMine)\r\n                setMessage({\r\n                    ...data,\r\n                    body: itemDtoListToItems(data.body) \r\n                })\r\n            } catch (error) {\r\n                console.error(\"Error loading messages:\", error)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n        loadMessage()\r\n\r\n    }, [userId, messageId])\r\n\r\n    return {\r\n        message,\r\n        loading\r\n    }\r\n}\r\n\r\n\r\n\r\nexport type Dialog = {\r\n    userId: string,\r\n    displayId: string,\r\n\r\n    lastMessage: MessageUI,\r\n    messages: MessageUI[],\r\n    count: number,\r\n    rating?: number\r\n}\r\n\r\ntype MessageUI = Omit<Message, \"created_at\"> & {\r\n    created_at: Date\r\n}\r\n\r\nexport function useDialogs(\r\n    inboxMessages: Message[],\r\n    sentMessages: Message[],\r\n    myUserId: string,\r\n    myPublicId: string\r\n) {\r\n    const dialogs = useMemo<Dialog[]>(() => {\r\n        const map = new Map<string, Dialog>()\r\n\r\n        const allMessages:MessageUI[] = [...inboxMessages, ...sentMessages].map(\r\n            msg => ({\r\n                ...msg,\r\n                created_at: parseBackendDate(msg.created_at)\r\n            })\r\n        )\r\n\r\n        for (const msg of allMessages){\r\n            const dialogUserId = msg.from_user === myUserId\r\n                ? msg.to_user\r\n                : msg.from_user\r\n\r\n            let displayId = ''\r\n            if(msg.from_display_id === 'A'){\r\n                displayId = 'Anon'\r\n            } else{ \r\n                displayId = msg.from_display_id === myPublicId\r\n                    ? msg.to_display_id\r\n                    : msg.from_display_id\r\n            }\r\n\r\n            if(!map.has(dialogUserId)) {\r\n                map.set(dialogUserId, {\r\n                    userId: dialogUserId,\r\n                    displayId: displayId,\r\n\r\n                    lastMessage: msg,\r\n                    messages: [msg],\r\n                    count: 1,\r\n                    rating: msg.to_user_rating\r\n                })\r\n            } else{\r\n                const dialog = map.get(dialogUserId)!\r\n                dialog.messages.push(msg)\r\n                dialog.count++\r\n\r\n                if(msg.created_at > dialog.lastMessage.created_at){\r\n                    dialog.lastMessage = msg\r\n                }\r\n            }\r\n        }\r\n\r\n        return Array.from(map.values()).sort(\r\n            (a,b) =>\r\n                b.lastMessage.created_at.getTime() -\r\n                a.lastMessage.created_at.getTime()\r\n        )\r\n    }, [inboxMessages, sentMessages, myUserId])\r\n\r\n    return dialogs\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 485, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useSetAnon.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\nimport { useState } from \"react\";\r\n\r\ntype SetAnonParams = {\r\n    from_user_id: string,\r\n    to_user_id: string,\r\n    is_anon: boolean\r\n}\r\n\r\nexport function useSetAnon() {\r\n    const [loading, setLoading] = useState(false)\r\n    const [error, setError] = useState<Error | null>(null)\r\n\r\n\r\n    const setAnon = async ({\r\n        from_user_id,\r\n        to_user_id,\r\n        is_anon\r\n    }: SetAnonParams) => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            const {data, error} = await supabase.rpc(\"toggle_anonymous\", {\r\n                p_from: from_user_id, \r\n                p_to: to_user_id, \r\n                p_is_anon: is_anon\r\n            })\r\n\r\n            if(error) throw error\r\n\r\n            if (data === false){\r\n                throw new Error(\"Анонимность уже была использована\")\r\n            }\r\n            return data\r\n\r\n        } catch (err) {\r\n            setError(err as Error)\r\n            throw err\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const checkAnon = async (from_user_id: string, to_user_id: string) => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            const {data, error} = await supabase\r\n                .from(\"user_anonymous_settings\")\r\n                .select(\"is_anon, anon_used_once\")\r\n                .eq(\"from_user_id\", from_user_id)\r\n                .eq(\"to_user_id\", to_user_id)\r\n                .maybeSingle()\r\n            if(error) throw error\r\n\r\n            if (!data) {\r\n                return {\r\n                    isAnon: false,\r\n                    anonUsedOnce: false,\r\n                    canToggle: true\r\n                }\r\n            }\r\n\r\n            return {\r\n                isAnon: data?.is_anon ?? false,\r\n                anonUsedOnce: data?.anon_used_once ?? false,\r\n                canToggle: !(data?.anon_used_once && !data.is_anon)\r\n            }\r\n        } catch (err) {\r\n            setError(err as Error)\r\n            throw err\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n        \r\n\r\n    return {setAnon, checkAnon, loading, error}\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,SAAS;IACZ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAe;IAGjD,MAAM,UAAU,OAAO,EACnB,YAAY,EACZ,UAAU,EACV,OAAO,EACK;QACZ,IAAI;YACA,WAAW;YACX,SAAS;YAET,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAAC,GAAG,CAAC,oBAAoB;gBACzD,QAAQ;gBACR,MAAM;gBACN,WAAW;YACf;YAEA,IAAG,OAAO,MAAM;YAEhB,IAAI,SAAS,OAAM;gBACf,MAAM,IAAI,MAAM;YACpB;YACA,OAAO;QAEX,EAAE,OAAO,KAAK;YACV,SAAS;YACT,MAAM;QACV,SAAU;YACN,WAAW;QACf;IACJ;IAEA,MAAM,YAAY,OAAO,cAAsB;QAC3C,IAAI;YACA,WAAW;YACX,SAAS;YAET,MAAM,EAAC,IAAI,EAAE,KAAK,EAAC,GAAG,MAAM,2IAAQ,CAC/B,IAAI,CAAC,2BACL,MAAM,CAAC,2BACP,EAAE,CAAC,gBAAgB,cACnB,EAAE,CAAC,cAAc,YACjB,WAAW;YAChB,IAAG,OAAO,MAAM;YAEhB,IAAI,CAAC,MAAM;gBACP,OAAO;oBACH,QAAQ;oBACR,cAAc;oBACd,WAAW;gBACf;YACJ;YAEA,OAAO;gBACH,QAAQ,MAAM,WAAW;gBACzB,cAAc,MAAM,kBAAkB;gBACtC,WAAW,CAAC,CAAC,MAAM,kBAAkB,CAAC,KAAK,OAAO;YACtD;QACJ,EAAE,OAAO,KAAK;YACV,SAAS;YACT,MAAM;QACV,SAAU;YACN,WAAW;QACf;IACJ;IAGA,OAAO;QAAC;QAAS;QAAW;QAAS;IAAK;AAC9C"}},
    {"offset": {"line": 553, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/utils/getId.ts"],"sourcesContent":["import { supabase } from \"@/utils/supabase/alSupabase\";\r\n\r\nexport async function getId(id: string) {\r\n\r\n    if(!id || id.trim() === \"\"){\r\n        throw new Error(\"Empty ID provided\")\r\n    }\r\n\r\n    const {data: toUser, error: toUserError} = await supabase\r\n                .from(\"users\")\r\n                .select(\"id_user\")\r\n                .eq(\"public_id\", id.trim())\r\n                .maybeSingle()\r\n    if(toUserError){\r\n        console.error(\"Error fetching user:\", toUserError)\r\n        throw toUserError\r\n    }\r\n    if(!toUser) {\r\n        throw new Error(\"User not found\")\r\n    }\r\n\r\n    return toUser.id_user\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,MAAM,EAAU;IAElC,IAAG,CAAC,MAAM,GAAG,IAAI,OAAO,IAAG;QACvB,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,EAAC,MAAM,MAAM,EAAE,OAAO,WAAW,EAAC,GAAG,MAAM,2IAAQ,CAC5C,IAAI,CAAC,SACL,MAAM,CAAC,WACP,EAAE,CAAC,aAAa,GAAG,IAAI,IACvB,WAAW;IACxB,IAAG,aAAY;QACX,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM;IACV;IACA,IAAG,CAAC,QAAQ;QACR,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,OAAO,OAAO;AACzB"}},
    {"offset": {"line": 577, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/components/all.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\r\nimport { Item } from \"../../things/types/type\"\r\n\r\ntype CanvasItemProps = {\r\n  item: Item\r\n  canEdit: boolean\r\n  onSelect: (id: number) => void\r\n  onUpdate: (id: number, patch: Partial<any>) => void\r\n  onDelete: (item: Item) => void\r\n  startDrag: (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item) => void\r\n  startResize: (\r\n    e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>,\r\n    item: Item,\r\n    dir: \"horizontal\" | \"top\" | \"bottom\" | \"diagonal\"\r\n  ) => void\r\n  ismenuTextOpen: boolean\r\n  setMenuTextOpen: (v: boolean) => void\r\n  isLoading: boolean\r\n  setselectedItemId: (id: number) => void\r\n  setOpenRedactor: (v: boolean) => void\r\n}\r\n\r\nexport function CanvasItem({\r\n  item,\r\n  canEdit,\r\n  onSelect,\r\n  onUpdate,\r\n  onDelete,\r\n  startDrag,\r\n  startResize,\r\n  ismenuTextOpen,\r\n  setMenuTextOpen,\r\n  isLoading,\r\n  setselectedItemId,\r\n  setOpenRedactor\r\n}: CanvasItemProps) {\r\n\r\n  const textItem = item.type === \"text\"\r\n  const gifItem = item.type === \"gif\"\r\n\r\n  return (\r\n    <div\r\n      className={`flex text-black select-none relative\r\n        ${textItem && item.isSelected && item.isEditing !== \"text\" ? \"border\" : \"\"}\r\n      `}\r\n      style={{\r\n        position: \"absolute\",\r\n        left: item.x,\r\n        top: item.y,\r\n        width: item.w,\r\n        height: item.h,\r\n        fontSize: textItem ? item.fontSize : undefined,\r\n        color: textItem ?item.color : undefined,\r\n        cursor: canEdit ? (item.isSelected ? \"move\" : \"pointer\"): \"cursor-allow\",\r\n        transform: `rotate(${item.rotation || 0}rad)`,\r\n        transformOrigin: \"center center\"\r\n      }}\r\n      onDoubleClick={() => {\r\n        if(item.type === 'text') onUpdate(item.id, { isEditing: \"text\" })\r\n      }}\r\n      onMouseDown={e => {\r\n        if(!canEdit) return\r\n        startDrag(e, item)\r\n        onSelect(item.id)\r\n      }}\r\n      onTouchStart={e => {\r\n        if(!canEdit) return\r\n        startDrag(e, item)\r\n        onSelect(item.id)\r\n      }}\r\n      onClick={() => {\r\n        setselectedItemId(item.id)\r\n        setOpenRedactor(true)\r\n      }}\r\n      tabIndex={0}\r\n      onKeyDown={(e) => {\r\n        if(e.key === 'Delete') onDelete(item)\r\n      }}\r\n    >\r\n      {textItem && item.isEditing === \"text\" ? (\r\n        <input\r\n          autoFocus\r\n          value={item.content}\r\n          onChange={e => onUpdate(item.id, { content: e.target.value })}\r\n          onBlur={() => onUpdate(item.id, { isEditing: \"none\" })}\r\n          onKeyDown={e => {\r\n            if (e.key === \"Enter\") e.currentTarget.blur()\r\n          }}\r\n        />\r\n      ) : (\r\n        <div\r\n          className={`relative w-full h-full flex ${\r\n            item.isSelected ? \"\" : \"overflow-hidden\"\r\n          }`}\r\n        >\r\n          {item.type === 'text' \r\n          ? (\r\n            item.content\r\n          ):(\r\n            <img\r\n              src={item.src}\r\n              draggable={false}\r\n              className=\"w-full h-full object-contain\"\r\n            />\r\n          )}\r\n\r\n          {item.isSelected && (\r\n            <>\r\n              {/* menu */}\r\n              <div className=\"absolute -top-1.5 -right-2.5\">\r\n                <div className=\"relative\">\r\n                  <svg\r\n                    onClick={e => {\r\n                      e.stopPropagation()\r\n                      setMenuTextOpen(!ismenuTextOpen)\r\n                    }}\r\n                    className=\"hover:scale-110 transition-transform cursor-pointer\"\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"10\"\r\n                    height=\"10\"\r\n                    viewBox=\"0 0 32 32\"\r\n                  >\r\n                    <path\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth=\"2\"\r\n                      d=\"M4 8h24M4 16h24M4 24h24\"\r\n                    />\r\n                  </svg>\r\n\r\n                  <div\r\n                    className={`absolute top-1 left-full text-[9px] bg-black/20 rounded-md\r\n                      flex flex-col transition-opacity ${\r\n                        ismenuTextOpen ? \"opacity-100\" : \"opacity-0\"\r\n                      }`}\r\n                  >\r\n                    <button\r\n                      className=\"hover:bg-black/10\"\r\n                      onClick={() => onDelete(item)}\r\n                    >\r\n                      Удалить\r\n                    </button>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* resize handles */}\r\n              <ResizeHandle\r\n                className=\"-right-1 bottom-1/2 translate-y-1/2 w-1 h-3 cursor-w-resize\"\r\n                onStart={e => startResize(e, item, \"horizontal\")}\r\n              />\r\n              <ResizeHandle\r\n                className=\"-top-1 left-1/2 -translate-x-1/2 w-3 h-1 cursor-s-resize\"\r\n                onStart={e => startResize(e, item, \"top\")}\r\n              />\r\n              <ResizeHandle\r\n                className=\"-bottom-1 left-1/2 -translate-x-1/2 w-3 h-1 cursor-s-resize\"\r\n                onStart={e => startResize(e, item, \"bottom\")}\r\n              />\r\n              <ResizeHandle\r\n                className=\"-bottom-1.5 -right-1.5 w-2 h-2 cursor-se-resize\"\r\n                onStart={e => startResize(e, item, \"diagonal\")}\r\n              />\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction ResizeHandle({\r\n  className,\r\n  onStart,\r\n}: {\r\n  className: string\r\n  onStart: (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => void\r\n}) {\r\n  return (\r\n    <div\r\n      className={`absolute bg-white border ${className}`}\r\n      onMouseDown={e => {\r\n        e.stopPropagation()\r\n        onStart(e)\r\n      }}\r\n      onTouchStart={e => {\r\n        e.stopPropagation()\r\n        onStart(e)\r\n      }}\r\n    />\r\n  )\r\n}\r\n\r\n\r\n\r\nexport function RightField({\r\n    rightPanelOpen,\r\n    setRightPanelOpen,\r\n    userId, setUserId,\r\n    isReply,\r\n    anonState, \r\n    setAnonState,\r\n    handleSendMessage,\r\n    idRef,anonRef,\r\n    isRecieve,\r\n    routeTo,\r\n    userError\r\n\r\n}: {\r\n    rightPanelOpen: boolean\r\n    setRightPanelOpen: (v: boolean) => void\r\n    userId: string | null\r\n    setUserId: (v: string) => void\r\n    isReply: boolean\r\n    anonState: { \r\n      isAnon: boolean,\r\n      anonUsedOnce: boolean,\r\n      canToggle: boolean  \r\n    }\r\n    setAnonState: (isAnon: boolean) => void\r\n    handleSendMessage: () => void\r\n    idRef: React.RefObject<HTMLInputElement | null>\r\n    anonRef: React.RefObject<HTMLInputElement | null>\r\n    isRecieve: boolean\r\n    routeTo: (v: string | null) => void\r\n    userError: string | null\r\n}) {\r\n    const [inputValue, setInputValue] = useState(userId || \"\");\r\n    useEffect(() => {\r\n        if(!userId) return\r\n        setInputValue(userId || \"\")\r\n    },[userId])\r\n\r\n    return (\r\n        <div\r\n            className={`fixed inset-0 z-20 bg-black/50 transition-all duration-300 overflow-hidden \r\n                    ${rightPanelOpen ? \"backdrop-blur-lg translate-y-0\" : \"backdrop-blur-none translate-y-full\"}\r\n                `}\r\n            onMouseDown={(e) => setRightPanelOpen(false)}\r\n        >\r\n            <div \r\n                className=\"absolute left-1/2 inset-y-0 -translate-x-1/2 \r\n                        flex justify-center items-center \r\n                        md:w-[400px] w-full bg-black/90 z-20\"\r\n                onMouseDown={(e) => {\r\n                    e.stopPropagation()\r\n                }}\r\n            >   \r\n                {isRecieve \r\n                ?(\r\n                    <div \r\n                    className=\" bg-white/10 rounded-xl p-3\r\n                    \">\r\n                        <button\r\n                          onClick={() => {\r\n                            routeTo(userId)\r\n                            setRightPanelOpen(false)\r\n                          }}\r\n                        >\r\n                            Ответить, {`${userId}`}\r\n                        </button>\r\n                    </div>\r\n                ):(\r\n                    <form \r\n                        className=\"relative flex flex-col w-full justify-center items-center\"\r\n                        onSubmit={(e) => {\r\n                            e.preventDefault()\r\n                        }}\r\n                        >\r\n                        <input\r\n                            ref={idRef}\r\n                            value={inputValue}\r\n                            onChange={(e) => setInputValue(e.target.value)}\r\n                            onBlur={() => setUserId(inputValue)}\r\n                            disabled={isReply}\r\n                            type=\"text\"\r\n                            placeholder=\"ID кисы\"\r\n                            className={`p-2 mb-4 w-1/2 bg-white/10 border rounded-md text-white\r\n                                    ${isReply && \"opacity-50\"}\r\n                                    ${userError && \"border-red-500\"}\r\n                            `}\r\n                        />\r\n\r\n                        {userError && (\r\n                          <p className=\"text-red-400 text-xs mb-3\">\r\n                            {userError}\r\n                          </p>\r\n                        )}\r\n\r\n                        <div className=\"flex w-full justify-center items-center\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                ref={anonRef}\r\n                                checked={anonState.isAnon}\r\n                                disabled={!anonState.canToggle}\r\n                                onChange={(e) => setAnonState(e.target.checked)}\r\n                                className=\"bg-white/10 border rounded-md text-white\"\r\n                            />\r\n                            <span className=\"text-[10px]\">\r\n                                {anonState.canToggle\r\n                                  ? \"Будешь анонимен? (только 1 раз)\"\r\n                                  : \"Анонимность уже использована\"\r\n                                }\r\n                            </span>\r\n                        </div>\r\n\r\n                        <button\r\n                            type=\"submit\"\r\n                            className={`p-2 mt-4 border rounded-2xl transition-all duration-200\r\n                                ${userError ? \"opacity-50 cursor-not-allowed\" : \"hover:bg-white/20\"}\r\n                            `}                            \r\n                            onClick={handleSendMessage}\r\n                            disabled={!!userError}\r\n                        >\r\n                            Отправить\r\n                        </button>\r\n\r\n                    </form>\r\n                )}\r\n                        <button \r\n                            className=\"absolute bottom-0 w-20 bg-white/20 rounded-t-full \r\n                            hover:bg-white/40 transition-all duration-200\r\n                            flex justify-center items-center\r\n                            \"\r\n                            onClick={() => setRightPanelOpen(false)}\r\n                        >\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" transform=\"rotate(180)\"><path fill=\"currentColor\" d=\"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\"/></svg>\r\n                        </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 943, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/btnFunction.ts"],"sourcesContent":["\r\nimport React from \"react\"\r\nimport { Item } from \"../things/types/type\"\r\n\r\nexport const createText = (setItems: React.Dispatch<React.SetStateAction<Item[]>>) => {\r\n        setItems(prev => [...prev, {\r\n            id: prev.length,\r\n            type: \"text\",\r\n            content: `new text ${prev.length + 1}`,\r\n            x: 0 ,\r\n            y: 0 + prev.length * 20,\r\n            w: 100,\r\n            h: 50,\r\n            fontSize: 16,\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            rotation: 0,\r\n            isEditing: 'none'\r\n        }])\r\n    }\r\n\r\nexport const insertGif = (\r\n    src: string,\r\n    setItems: React.Dispatch<React.SetStateAction<Item[]>>,\r\n) => {\r\n    setItems(prev => [\r\n        ...prev,\r\n        {\r\n            id: prev.length,\r\n            type: \"gif\",\r\n            src,\r\n            x: 0,\r\n            y: 0 + prev.length * 20,\r\n            w: 100,\r\n            h: 100,\r\n            scaleX: 1,\r\n            scaleY: 1,\r\n            rotation: 0,\r\n            autoplay: true,\r\n            loop: true\r\n        }\r\n    ])\r\n} "],"names":[],"mappings":";;;;;;AAIO,MAAM,aAAa,CAAC;IACnB,SAAS,CAAA,OAAQ;eAAI;YAAM;gBACvB,IAAI,KAAK,MAAM;gBACf,MAAM;gBACN,SAAS,CAAC,SAAS,EAAE,KAAK,MAAM,GAAG,GAAG;gBACtC,GAAG;gBACH,GAAG,IAAI,KAAK,MAAM,GAAG;gBACrB,GAAG;gBACH,GAAG;gBACH,UAAU;gBACV,QAAQ;gBACR,QAAQ;gBACR,UAAU;gBACV,WAAW;YACf;SAAE;AACN;AAEG,MAAM,YAAY,CACrB,KACA;IAEA,SAAS,CAAA,OAAQ;eACV;YACH;gBACI,IAAI,KAAK,MAAM;gBACf,MAAM;gBACN;gBACA,GAAG;gBACH,GAAG,IAAI,KAAK,MAAM,GAAG;gBACrB,GAAG;gBACH,GAAG;gBACH,QAAQ;gBACR,QAAQ;gBACR,UAAU;gBACV,UAAU;gBACV,MAAM;YACV;SACH;AACL"}},
    {"offset": {"line": 991, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/useItemInteractions.ts"],"sourcesContent":["import { Item, Viewport } from \"../things/types/type\"\r\nimport { useRef }from \"react\"\r\n\r\ntype ResizeDirection = \"horizontal\" | \"top\" | \"bottom\" | \"diagonal\"\r\n\r\ntype DragRef = {\r\n    id: number | null\r\n    offsetX: number\r\n    offsetY: number\r\n    w: number\r\n    h: number\r\n}\r\n\r\ntype ResizeRef = {\r\n    id: number | null\r\n    startX: number\r\n    startY: number\r\n    startW: number\r\n    startH: number\r\n    fontSize?: number\r\n    rotate?: number\r\n    cx?: number\r\n    cy?: number\r\n    startAngle?: number\r\n    direction: ResizeDirection\r\n}\r\n\r\n\r\n\r\nexport const userItemInteractions = (\r\n    items: Item[], \r\n    setItems: React.Dispatch<React.SetStateAction<Item[]>>, \r\n    fieldRef: React.RefObject<HTMLDivElement | null>,\r\n\r\n    setViewport: React.Dispatch<React.SetStateAction<Viewport>>,\r\n    viewport: Viewport\r\n) => {\r\n    const dragRef = useRef<DragRef>({id: null, offsetX: 0, offsetY: 0, w: 0, h: 0})\r\n    const resizeRef = useRef<ResizeRef>({id: null, startX: 0, startY: 0, startW: 0, startH: 0, fontSize: 0,rotate: 0, direction: \"horizontal\"})\r\n    const touchDistanceRef = useRef<number | null>(null)\r\n\r\n    function screenToCanvas(\r\n        clientX: number,\r\n        clientY: number,\r\n        rect: DOMRect,\r\n        viewport: Viewport\r\n    ){\r\n        return {\r\n            x: (clientX - rect.left - viewport.offsetX) / viewport.scale,\r\n            y: (clientY - rect.top - viewport.offsetY) / viewport.scale\r\n        }\r\n    }\r\n\r\n    function getTouchCoordinates(e: TouchEvent): { clientX: number; clientY: number } | null {\r\n        if (e.touches.length === 0) return null\r\n        const touch = e.touches[0]\r\n        return { clientX: touch.clientX, clientY: touch.clientY }\r\n    }\r\n    \r\n    const startDrag = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item) => {\r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if ('touches' in e) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const pos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        dragRef.current = {\r\n            id: item.id,\r\n            offsetX: pos.x - item.x,\r\n            offsetY: pos.y - item.y,\r\n            w: item.w,\r\n            h: item.h\r\n        }\r\n\r\n        window.addEventListener('mousemove', onDragMove)\r\n        window.addEventListener('mouseup', stopDrag)\r\n        window.addEventListener('touchmove', onDragMove as any)\r\n        window.addEventListener('touchend', stopDrag)\r\n    }\r\n    const onDragMove = (e: MouseEvent | TouchEvent) => {\r\n        if(resizeRef.current.id !== null) return;\r\n\r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        const drag = dragRef.current\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if (e instanceof TouchEvent) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const pos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        if (drag.id === null) return;\r\n\r\n        setItems(prev => prev.map(it => it.id === drag.id \r\n            ? {...it, \r\n                x: pos.x - drag.offsetX, \r\n                y: pos.y - drag.offsetY \r\n            } \r\n            : it))\r\n    }\r\n    const stopDrag = () => {\r\n        dragRef.current.id = null\r\n        window.removeEventListener('mousemove', onDragMove)\r\n        window.removeEventListener('mouseup', stopDrag)\r\n        window.removeEventListener('touchmove', onDragMove as any)\r\n        window.removeEventListener('touchend', stopDrag)\r\n    }\r\n\r\n\r\n    //resize\r\n    const startResize = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>, item: Item, direction: ResizeDirection) => {\r\n        e.stopPropagation()\r\n        \r\n        let clientX: number, clientY: number\r\n        \r\n        if ('touches' in e) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n        \r\n        const rect = fieldRef!.current!.getBoundingClientRect()\r\n        const canvasPos = screenToCanvas(clientX, clientY, rect, viewport)\r\n        const cx = item.x + item.w/2\r\n        const cy = item.y + item.h/2\r\n        \r\n        resizeRef.current = {\r\n            id: item.id,\r\n            startX: clientX,\r\n            startY: clientY,\r\n            startW: item.w,\r\n            startH: item.h,\r\n            cx: cx,\r\n            cy: cy,\r\n            startAngle: Math.atan2(canvasPos.y - cy, canvasPos.x - cx),\r\n            fontSize: item.type === 'text' ? item.fontSize : undefined,\r\n            rotate: item.rotation,\r\n            direction: direction\r\n        }\r\n        window.addEventListener('mousemove', onResizeMove)\r\n        window.addEventListener('mouseup', stopResize)\r\n        window.addEventListener('touchmove', onResizeMove as any)\r\n        window.addEventListener('touchend', stopResize)\r\n    }\r\n\r\n    const onResizeMove = (e: MouseEvent | TouchEvent) => {\r\n        const r = resizeRef.current\r\n        if (r.id === null) return;\r\n\r\n        let clientX: number, clientY: number\r\n        \r\n        if (e instanceof TouchEvent) {\r\n            if (e.touches.length === 0) return\r\n            clientX = e.touches[0].clientX\r\n            clientY = e.touches[0].clientY\r\n        } else {\r\n            clientX = e.clientX\r\n            clientY = e.clientY\r\n        }\r\n\r\n        const dx = (clientX - r.startX) / viewport.scale\r\n        const dy = (clientY - r.startY) / viewport.scale\r\n\r\n        let w = r.startW\r\n        let h = r.startH\r\n        let fontSize = r.fontSize\r\n        let newX = undefined as number | undefined\r\n        let newY = undefined as number | undefined\r\n        let rotation = undefined as number | undefined\r\n\r\n        if (r.direction === \"horizontal\") {\r\n            w = Math.max(50, r.startW + dx);\r\n        }\r\n        if(r.direction === \"top\") {\r\n            h = Math.max(30, r.startH + dy);\r\n        }\r\n        if (r.direction === \"bottom\") {\r\n            h = Math.max(30, r.startH + dy);\r\n        }\r\n        if (r.direction === \"diagonal\") {\r\n            const rect = fieldRef!.current!.getBoundingClientRect()\r\n            const mousePos = screenToCanvas(clientX, clientY, rect, viewport)\r\n\r\n            const currentAngle = Math.atan2(mousePos.y - r.cy!, mousePos.x - r.cx!)\r\n            rotation = currentAngle - r.startAngle!\r\n\r\n            const newDist = Math.sqrt((mousePos.x - r.cx!)**2 + (mousePos.y - r.cy!)**2)\r\n            const oldDist = Math.sqrt((r.startW/2)**2 + (r.startH/2)**2)\r\n\r\n            const scale = newDist / oldDist\r\n    \r\n            w = Math.max(50, r.startW * scale)\r\n            h = Math.max(30, r.startH * scale)\r\n            fontSize = Math.max(8, r.fontSize! * scale)\r\n            \r\n            // Центр остается на месте\r\n            newX = r.cx! - w/2\r\n            newY = r.cy! - h/2\r\n        }\r\n        // console.log(\"resize direction:\", r.direction, \"w:\", w, \"h:\", h, \"fontSize:\", fontSize)\r\n        setItems(prev => prev.map(it => \r\n            it.id === r.id \r\n                ? {\r\n                    ...it, \r\n                    w, \r\n                    h, \r\n                    fontSize, \r\n                    rotation: rotation !== undefined ? rotation : it.rotation, \r\n                    x: newX || it.x, \r\n                    y: newY || it.y\r\n                } \r\n                : it\r\n        ))\r\n    }\r\n\r\n    const stopResize = () => {\r\n        resizeRef.current.id = null\r\n        window.removeEventListener('mousemove', onResizeMove)\r\n        window.removeEventListener('mouseup', stopResize)\r\n        window.removeEventListener('touchmove', onResizeMove as any)\r\n        window.removeEventListener('touchend', stopResize)\r\n    }\r\n\r\n\r\n    //delete\r\n    const deleteItem = (item: Item) => {\r\n        setItems(prev => prev.filter(it => it.id !== item.id))\r\n    }\r\n\r\n\r\n    //zoom\r\n    const handleZoom = (e: React.WheelEvent<HTMLDivElement>) => {\r\n        // e.preventDefault()\r\n        setViewport(v => ({\r\n            ...v,\r\n            scale: Math.min(3, Math.max(0.3, v.scale - e.deltaY * 0.001))\r\n        }))\r\n    }\r\n        const getDistanceBetweenTouches = (touch1: Touch, touch2: Touch): number => {\r\n        const dx = touch1.clientX - touch2.clientX\r\n        const dy = touch1.clientY - touch2.clientY\r\n        return Math.sqrt(dx * dx + dy * dy)\r\n    }\r\n    const handleTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2) {\r\n            touchDistanceRef.current = getDistanceBetweenTouches(e.touches[0] as Touch, e.touches[1] as Touch)\r\n        }\r\n    }\r\n    const handleTouchMove = (e: React.TouchEvent<HTMLDivElement>) => {\r\n        if (e.touches.length === 2 && touchDistanceRef.current !== null) {\r\n            e.preventDefault()\r\n            const currentDistance = getDistanceBetweenTouches(e.touches[0] as Touch, e.touches[1] as Touch)\r\n            const distanceDelta = currentDistance - touchDistanceRef.current\r\n            \r\n            setViewport(v => ({\r\n                ...v,\r\n                scale: Math.min(3, Math.max(0.3, v.scale + distanceDelta * 0.01))\r\n            }))\r\n            \r\n            touchDistanceRef.current = currentDistance\r\n        }\r\n    }\r\n    const handleTouchEnd = () => {\r\n        touchDistanceRef.current = null\r\n    }\r\n    const zoomHandlers = {\r\n        onWheel: handleZoom,\r\n        onTouchStart: handleTouchStart,\r\n        onTouchMove: handleTouchMove,\r\n        onTouchEnd: handleTouchEnd\r\n    }\r\n\r\n    return {startDrag, startResize, deleteItem, zoomHandlers}\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1232, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/checkMobile.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\nexport function useCheckMobile(breakPoint = 768) {\r\n    const [isMobile, setIsMobile] = useState(false)\r\n\r\n    useEffect(() => {\r\n        const check = () => {\r\n            setIsMobile(window.innerWidth <= 768)\r\n        }\r\n        check()\r\n        window.addEventListener('resize', check)\r\n        return () => window.removeEventListener('resize', check)\r\n    },[breakPoint])\r\n\r\n    return isMobile\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,eAAe,aAAa,GAAG;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,IAAA,kNAAS,EAAC;QACN,MAAM,QAAQ;YACV,YAAY,OAAO,UAAU,IAAI;QACrC;QACA;QACA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;IACtD,GAAE;QAAC;KAAW;IAEd,OAAO;AACX"}},
    {"offset": {"line": 1256, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/components/Redactor.tsx"],"sourcesContent":["\r\nimport { useState, useEffect, useRef } from \"react\"\r\nimport { Item } from \"../../things/types/type\"\r\nimport { useCheckMobile } from \"../../things/hooks/checkMobile\"\r\n\r\nexport type ItemPatch = Partial<{\r\n    fontSize: number\r\n    color: string\r\n    rotation: number\r\n}>\r\n\r\ntype RedactorProps = {\r\n    item: Item | null\r\n    items: Item[]\r\n    isOpen: boolean\r\n    open: (v: boolean) => void\r\n\r\n    onChange: (id: Item[\"id\"], patch: ItemPatch) => void\r\n\r\n}\r\n\r\nfunction formatNumber(value?: number, digits = 1) {\r\n    if (value == null || Number.isNaN(value)) return \"\"\r\n    return value.toFixed(digits).replace(/\\.0+$/, \"\")\r\n}\r\nconst normalizeNumber = (v: string) =>\r\n    v.replace(\",\", \".\").replace(/[^0-9.-]/g, \"\")\r\n\r\nexport function Redactor({\r\n    item,\r\n    items,\r\n    isOpen,\r\n    open,\r\n\r\n    onChange\r\n}:RedactorProps\r\n) {\r\n    const isMobile = useCheckMobile()\r\n\r\n    const [size, setSize] = useState('')\r\n    const [color, setColor] = useState<string>('#000000')\r\n    const [rotation, setRotation] = useState('')\r\n    useEffect(() => {\r\n        if(!item){\r\n            open(false)\r\n        }\r\n\r\n        if (item?.type==='text') {\r\n            setSize(formatNumber(item.fontSize, 1))\r\n            setColor(item.color ?? \"#000000\")\r\n            setRotation(formatNumber(item.rotation, 1))\r\n        } \r\n    }, [item])\r\n\r\n    const inputStyle = `\r\n  w-14 px-2 py-1\r\n  text-sm font-mono text-white\r\n  bg-white/15 rounded-md\r\n  outline-none\r\n  focus:bg-white/25 focus:ring-1 focus:ring-white/40\r\n`\r\n\r\n\r\n    const panelRef = useRef<HTMLDivElement>(null)\r\n    const startX = useRef(0)\r\n    const startW = useRef(300)\r\n    const handleChangeOpen = (e: React.MouseEvent | React.TouchEvent) => {\r\n        const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX\r\n        startX.current = clientX\r\n        startW.current = panelRef.current?.offsetWidth ?? 300\r\n\r\n        window.addEventListener('mousemove', handleMouseMove)\r\n        window.addEventListener('mouseup', handleMouseUp)\r\n        window.addEventListener('touchmove', handleMouseMove)\r\n        window.addEventListener('touchend', handleMouseUp)\r\n    }\r\n    const handleMouseMove = (e: MouseEvent | TouchEvent) => {\r\n        const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX\r\n\r\n        if (!panelRef.current) return\r\n\r\n        const delta = startX.current - clientX\r\n        const newWidth = Math.min(\r\n            500,\r\n            Math.max(100,startW.current + delta)\r\n        )\r\n        \r\n        panelRef.current.style.width = `${newWidth}px`\r\n    }\r\n    const handleMouseUp = () => {\r\n        window.removeEventListener('mousemove', handleMouseMove)\r\n        window.removeEventListener('mouseup', handleMouseUp)\r\n        window.removeEventListener('touchmove', handleMouseMove)\r\n        window.removeEventListener('touchend', handleMouseUp)\r\n    }\r\n        \r\n\r\n    return (\r\n    <div className=\"z-50\">\r\n        {/* open button */}\r\n        <div \r\n            className={`absolute right-0 w-7 rounded-l-full \r\n                backdrop-blur-mdtransition cursor-pointer\r\n                md:inset-y-0\r\n                inset-y-60\r\n                ${isOpen ? \"hidden\" : \"\"}\r\n                ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n            `}\r\n        >\r\n            <button \r\n                className=\"w-full h-full\"\r\n                onClick={() => open(!isOpen)}\r\n            >\r\n                {`>`}\r\n            </button>\r\n        </div>\r\n\r\n        {/* panel */}\r\n        <div\r\n            ref={panelRef}\r\n            className={`absolute right-0 inset-y-0 \r\n                bg-gradient-to-b from-[#3b0d10] to-[#220507] shadow-2xl\r\n                z-50 transition-transform rounded-l-2xl\r\n                ${isOpen ? \"traslate-x-0 \" : \"translate-x-full \"}\r\n            `}\r\n            style={{width: 300}}\r\n        >\r\n            <div className=\"relative w-full h-full flex justify-center p-2\">\r\n\r\n                <div className=\"flex flex-col gap-2 p-4\">\r\n                    {/* Font size */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs text-white/60\">Size</span>\r\n                        <div className=\"flex items-center gap-1\">\r\n                        <input\r\n                            type=\"text\"\r\n                            className={inputStyle}\r\n                            value={size}\r\n                            onChange={(e) => setSize(normalizeNumber(e.target.value))}\r\n                            onBlur={() =>\r\n                            item && onChange(item.id, { fontSize: Number(size) })\r\n                            }\r\n                        />\r\n                        <span className=\"text-xs text-white/40\">px</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs text-white/60\">Color</span>\r\n                        <input\r\n                            type=\"color\"\r\n                            value={color}\r\n                            className=\"w-8 h-8 rounded-md bg-transparent cursor-pointer\"\r\n                            onChange={(e) => {\r\n                                setColor(e.target.value);\r\n                                item && onChange(item.id, { color: e.target.value });\r\n                            }}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Rotation */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <span className=\"text-xs text-white/60\">Rotate</span>\r\n                        <input\r\n                            type=\"text\"\r\n                            className={inputStyle}\r\n                            value={rotation}\r\n                            onChange={(e) => setRotation(normalizeNumber(e.target.value))}\r\n                            onBlur={() =>\r\n                                item && onChange(item.id, { rotation: Number(rotation) })\r\n                            }\r\n                        />\r\n                    </div>\r\n\r\n                </div>\r\n\r\n\r\n                {/* close trigger */}\r\n                <div \r\n                    className=\"\r\n                    absolute left-0 top-1/2 -translate-y-1/2\r\n                    h-16 w-2 rounded-full\r\n                    bg-white/20 hover:bg-white/40\r\n                    cursor-ew-resize transition\r\n                \"\r\n                    onDoubleClick={() => open(false)}\r\n                    onClick={() => {\r\n                        if(isMobile) open(false)\r\n                    }}\r\n                    onMouseDown={handleChangeOpen}\r\n                    onTouchStart={handleChangeOpen}\r\n                    \r\n                />\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n    )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1511, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/things/hooks/useklipy.ts"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\n\r\nexport function useklipySearch(query: string, apiKey: string, perPage = 24) {\r\n    const [resultsGif, setResults] = useState<string[]>([]);\r\n    const [loadingGif, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if(!query.trim()) {\r\n            setResults([]);\r\n            return\r\n        }\r\n\r\n        const controller = new AbortController()\r\n        setLoading(true)\r\n\r\n        const fetchGifs = async () => {\r\n            try {\r\n                const res = await fetch(\r\n                    `https://api.klipy.com/api/v1/${apiKey}/gifs/search?q=${encodeURIComponent(query)}&per_page=${perPage}&locale=ru`,\r\n                    {\r\n                        headers: {\r\n                            \"X-KLIPY-API-KEY\": apiKey\r\n                        },\r\n                        signal: controller.signal\r\n                    }\r\n                )\r\n                const json = await res.json()\r\n                const urls = (json.data?.data || []).map((item: any) => {\r\n                    return item.file?.xs.gif.url\r\n                }).filter(Boolean);\r\n                \r\n                // console.log(urls)\r\n                setResults(urls)\r\n            } catch (err){\r\n                if ((err as any).name !== \"AbortError\") {\r\n                    console.error(err)\r\n                }\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n\r\n        fetchGifs()\r\n\r\n        return () => {\r\n            controller.abort()\r\n        }\r\n    },[query, apiKey, perPage])\r\n\r\n    return {resultsGif, loadingGif}\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,eAAe,KAAa,EAAE,MAAc,EAAE,UAAU,EAAE;IACtE,MAAM,CAAC,YAAY,WAAW,GAAG,IAAA,iNAAQ,EAAW,EAAE;IACtD,MAAM,CAAC,YAAY,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAE1C,IAAA,kNAAS,EAAC;QACN,IAAG,CAAC,MAAM,IAAI,IAAI;YACd,WAAW,EAAE;YACb;QACJ;QAEA,MAAM,aAAa,IAAI;QACvB,WAAW;QAEX,MAAM,YAAY;YACd,IAAI;gBACA,MAAM,MAAM,MAAM,MACd,CAAC,6BAA6B,EAAE,OAAO,eAAe,EAAE,mBAAmB,OAAO,UAAU,EAAE,QAAQ,UAAU,CAAC,EACjH;oBACI,SAAS;wBACL,mBAAmB;oBACvB;oBACA,QAAQ,WAAW,MAAM;gBAC7B;gBAEJ,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,MAAM,OAAO,CAAC,KAAK,IAAI,EAAE,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC;oBACtC,OAAO,KAAK,IAAI,EAAE,GAAG,IAAI;gBAC7B,GAAG,MAAM,CAAC;gBAEV,oBAAoB;gBACpB,WAAW;YACf,EAAE,OAAO,KAAI;gBACT,IAAI,AAAC,IAAY,IAAI,KAAK,cAAc;oBACpC,QAAQ,KAAK,CAAC;gBAClB;YACJ,SAAU;gBACN,WAAW;YACf;QACJ;QAEA;QAEA,OAAO;YACH,WAAW,KAAK;QACpB;IACJ,GAAE;QAAC;QAAO;QAAQ;KAAQ;IAE1B,OAAO;QAAC;QAAY;IAAU;AAClC"}},
    {"offset": {"line": 1567, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/components/CreateBtns.tsx"],"sourcesContent":["\r\nimport { useState } from \"react\"\r\nimport { useklipySearch } from \"../../things/hooks/useklipy\"\r\n\r\ntype BtnProps = {\r\n    createText: () => void\r\n    insertGif: (url: string) => void\r\n}\r\n\r\nexport function CreateBtns({\r\n    createText,\r\n    insertGif,\r\n}: BtnProps) {\r\n        const [UrlGif, setUrlGif] = useState('')\r\n        const [isInputUrl, openInputUrl] = useState(false)\r\n        const {resultsGif,loadingGif} = useklipySearch(UrlGif, 'pF3P65Wzij6l78j3fDut9DS0h2Ek0UxktVVcLmTCUmdcvsbECRLYJHzZxDaBO1WH', 24)\r\n\r\n    return(\r\n        <div \r\n            className={`relative flex p-2 mt-20 gap-2 bg-[#ffffff1a] rounded-full backdrop-blur-md\r\n            `}\r\n        >\r\n            <button\r\n                className=\"p-2 border rounded-2xl\"  \r\n                onClick={() => createText()}\r\n            >\r\n                Текст\r\n            </button>\r\n\r\n\r\n            <input\r\n                value={UrlGif}\r\n                onChange={e => setUrlGif(e.target.value)}\r\n                placeholder=\"Введи слово\"\r\n                className={`transition-all duration-300\r\n                        ${isInputUrl ? 'w-100':'w-0'}\r\n                    `}\r\n                onKeyDown={(e) => {\r\n                if(!UrlGif) return\r\n                if(e.key === 'Enter') {\r\n                    insertGif(UrlGif)\r\n                    setUrlGif(\"\")\r\n                    openInputUrl(false)\r\n                }\r\n                }}\r\n                \r\n            />\r\n            <button\r\n                className=\"p-2 border rounded-2xl\"  \r\n                onClick={() => {\r\n                    openInputUrl(true)\r\n                    if(!UrlGif) return\r\n                    insertGif(UrlGif)\r\n                    setUrlGif(\"\")\r\n                    openInputUrl(false)\r\n                }}\r\n            >\r\n                {isInputUrl ? \"Вставить\" : \"Гифка\"}\r\n            </button>\r\n            \r\n            <div \r\n                className=\"absolute inset-x-0 top-full flex overflow-x-auto no-scrollbar max-h-[80px] \r\n                            bg-black/20 rounded-2xl gap-1\r\n                \r\n                \"\r\n                >\r\n                {resultsGif.map(url => (\r\n                    <img\r\n                        key={url}\r\n                        src={url}\r\n                        className=\"flex object-contain w-full cursor-pointer\"\r\n                        onClick={(e) => {\r\n                            insertGif(url)\r\n                            openInputUrl(false)\r\n                        }}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n        </div>\r\n    )\r\n}"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAOO,SAAS,WAAW,EACvB,UAAU,EACV,SAAS,EACF;IACH,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,YAAY,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC5C,MAAM,EAAC,UAAU,EAAC,UAAU,EAAC,GAAG,IAAA,gKAAc,EAAC,QAAQ,oEAAoE;IAE/H,qBACI,8OAAC;QACG,WAAW,CAAC;YACZ,CAAC;;0BAED,8OAAC;gBACG,WAAU;gBACV,SAAS,IAAM;0BAClB;;;;;;0BAKD,8OAAC;gBACG,OAAO;gBACP,UAAU,CAAA,IAAK,UAAU,EAAE,MAAM,CAAC,KAAK;gBACvC,aAAY;gBACZ,WAAW,CAAC;wBACJ,EAAE,aAAa,UAAQ,MAAM;oBACjC,CAAC;gBACL,WAAW,CAAC;oBACZ,IAAG,CAAC,QAAQ;oBACZ,IAAG,EAAE,GAAG,KAAK,SAAS;wBAClB,UAAU;wBACV,UAAU;wBACV,aAAa;oBACjB;gBACA;;;;;;0BAGJ,8OAAC;gBACG,WAAU;gBACV,SAAS;oBACL,aAAa;oBACb,IAAG,CAAC,QAAQ;oBACZ,UAAU;oBACV,UAAU;oBACV,aAAa;gBACjB;0BAEC,aAAa,aAAa;;;;;;0BAG/B,8OAAC;gBACG,WAAU;0BAKT,WAAW,GAAG,CAAC,CAAA,oBACZ,8OAAC;wBAEG,KAAK;wBACL,WAAU;wBACV,SAAS,CAAC;4BACN,UAAU;4BACV,aAAa;wBACjB;uBANK;;;;;;;;;;;;;;;;AAa7B"}},
    {"offset": {"line": 1659, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/anonlove/createcard/CreateCardClient.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState,useEffect, useRef, useMemo } from \"react\"\r\nimport { useSearchParams } from \"next/navigation\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nimport { useRandColor } from \"./useRandColor\";\r\n\r\nimport { useAuth } from \"../things/hooks/useAuth\";\r\nimport { useMessages } from \"../things/hooks/useMessages\";\r\nimport {useCurrentMessage} from \"../things/hooks/useMessages\"\r\nimport { useSetAnon } from \"../things/hooks/useSetAnon\";\r\nimport { getId } from \"../things/utils/getId\";\r\n\r\nimport { Item, ItemDto, Viewport, itemDtoListToItems } from \"../things/types/type\";\r\n\r\nimport { CanvasItem, RightField } from \"./components/all\";\r\n\r\nimport { createText, insertGif } from \"./btnFunction\";\r\nimport { userItemInteractions } from \"./useItemInteractions\";\r\nimport { useCheckMobile } from \"../things/hooks/checkMobile\";\r\nimport { Redactor, ItemPatch } from \"./components/Redactor\";\r\n\r\nimport { CreateBtns } from \"./components/CreateBtns\";\r\n\r\ntype MessageData = {\r\n    items: Item[]\r\n}\r\ntype TypeData = {\r\n    type: string\r\n}\r\n\r\nexport default function CreateCardPage({initialData}: {initialData?: MessageData}) {\r\n    const {user, profile, loading: authLoading} = useAuth();\r\n\r\n    const searchParams = useSearchParams()\r\n    //messageId\r\n    const messageIdRaw = searchParams.get(\"id\")\r\n    const messageId = messageIdRaw ? decodeURIComponent(messageIdRaw) : null\r\n    //userId\r\n    const rawTo = searchParams.get(\"to\")\r\n    const to = rawTo ? decodeURIComponent(rawTo) : null\r\n    const [userId, setUserId] = useState<string | null>(null) // получаем из url\r\n    const [isReply, setIsReply] = useState(false)\r\n    // чье сообщение isMine = true || false\r\n    const isMine = searchParams.get(\"isMine\")\r\n    // тип перехода send или recieve\r\n    const type = searchParams.get(\"type\")\r\n    const [messageType, setMessageType] = useState<TypeData | null>(null)\r\n    const isRecieve = type === \"recieve\"\r\n    const isSend = type === \"send\"\r\n    const canEdit = isSend\r\n    \r\n\r\n    const isMobile = useCheckMobile() // проверка разрешения\r\n\r\n    const {sendMessage: send, loading: messageLoading} = useMessages(user?.id || null);\r\n    const {message, loading} = useCurrentMessage(\r\n        isRecieve ? user?.id || null : null, \r\n        isRecieve ? messageId : null,\r\n        isMine\r\n    )\r\n    \r\n    const router = useRouter()\r\n    \r\n    const [items, setItems] = useState<Item[]>(initialData?.items || [])\r\n    const fieldRef = useRef<HTMLDivElement>(null)\r\n    const [viewport, setViewport] = useState<Viewport>({\r\n        scale: 1,\r\n        offsetX: 0,\r\n        offsetY: 0\r\n    })\r\n    \r\n    const {checkAnon} = useSetAnon()\r\n    const [rightPanelOpen, setRightPanelOpen] = useState(false)\r\n    const idRef = useRef<HTMLInputElement>(null)\r\n    const anonRef = useRef<HTMLInputElement>(null)\r\n    const [anonState, setAnonState] = useState({\r\n        isAnon: false,\r\n        anonUsedOnce: false,\r\n        canToggle: true\r\n    })\r\n    const [userError, setUserError] = useState<string | null>(null)\r\n    \r\n\r\n    const [ismenuTextOpen, setMenuTextOpen] = useState(false)\r\n    \r\n    const {startDrag, startResize, deleteItem, zoomHandlers} = userItemInteractions(\r\n        items, \r\n        setItems, \r\n        fieldRef,\r\n        setViewport, \r\n        viewport\r\n    \r\n    )\r\n\r\n    // redactor panel\r\n        const [redactorOpen, setRedactorOpen] = useState(false)\r\n        const [selectedItemId, setSelectedItemId] = useState<number | null>(null) \r\n        const selectedItem = useMemo(\r\n            () => items.find(item => item.id === selectedItemId) ?? null,\r\n            [items, selectedItemId]\r\n        )\r\n    //\r\n\r\n    \r\n\r\n\r\n    useEffect(() => {\r\n        if (to){\r\n            setItems([])\r\n            setUserId(to)\r\n            setIsReply(true)\r\n        };\r\n\r\n        if (type){\r\n            setMessageType({type})\r\n        };\r\n    },[to, type])\r\n\r\n    useEffect(() => {\r\n        if (!isRecieve) return\r\n        if (!message) return\r\n        if (loading) return\r\n\r\n        setItems(message.body)\r\n    }, [isRecieve, message])\r\n\r\n    // проверка на анон\r\n    useEffect(() => {\r\n        if(!userId || !user) return\r\n\r\n        const fetchAnon = async () => {\r\n            try {\r\n                setUserError(null)\r\n                const toUserId = await getId(userId)\r\n                if(!toUserId) {\r\n                    setUserError(\"Пользователь не найден\")\r\n                    return\r\n                }\r\n\r\n                const state = await checkAnon(user.id, toUserId)\r\n                setAnonState(state)\r\n            }catch(err: any){\r\n                if(err.message === \"User not found\") {\r\n                    setUserError(\"Пользователь не найден\")\r\n                } else {\r\n                    setUserError(\"Ошибка при проверке пользователя\")\r\n                }\r\n                console.log(`Error:`, err)\r\n            }\r\n        }\r\n        \r\n        fetchAnon()\r\n    },[userId, user])\r\n\r\n    \r\n\r\n    // рандомный фон\r\n    const {bg} = useRandColor()\r\n    const bgStyle = `rgba(${Math.floor(bg.r)}, ${Math.floor(bg.g)}, ${Math.floor(bg.b)}, ${bg.a})`\r\n\r\n    const handleSendMessage = async () => {\r\n        const id = idRef.current?.value || \"\"\r\n\r\n        if (!id){\r\n            alert('Введи ID, сладкий!')\r\n            return\r\n        }\r\n        if (id === profile.public_id){\r\n            alert('Нельзя отправить сообщение самому себе!')\r\n            return\r\n        }\r\n        const cleanItems = items.map(item => {\r\n            if(item.type === 'text') {\r\n                const {isSelected, isEditing, ...rest} = item\r\n                return rest\r\n            }\r\n            const {isSelected, ...rest} = item\r\n            return rest\r\n        })\r\n        \r\n        try {\r\n            await send({publicId: id}, cleanItems, anonState.isAnon)\r\n\r\n            idRef.current!.value = \"\"\r\n            setRightPanelOpen(false)\r\n            router.push('anonlovemain')\r\n        } catch (error: any) {\r\n            console.log(error.message || 'Error sending message');\r\n        }\r\n    }\r\n\r\n    const handleRedactorChange = (id: number, patch: ItemPatch) => {\r\n        setItems(prev => \r\n            prev.map(item =>\r\n                item.id === id \r\n                    ? {...item, ...patch}\r\n                    : item\r\n            )\r\n        )\r\n    }\r\n\r\n    \r\n\r\n\r\n        return (\r\n            <div \r\n                className={`relative flex flex-col justify-center items-center h-full overflow-hidden`}\r\n                style={{ \r\n                    backgroundColor: bgStyle\r\n                }}\r\n                onClick={(e) => {\r\n                    if(e.target !== e.currentTarget) return;\r\n                }}\r\n            >\r\n                {/* field */}\r\n                {(isSend || (isRecieve && !loading))  && (\r\n                    <div\r\n                        className={`relative border rounded-md bg-white overflow-hidden z-10\r\n                            touch-none select-none\r\n                            ${isMobile ? \"w-full h-1/2\" : \"w-1/2 h-1/2\"}\r\n                            `}\r\n                        ref={fieldRef}\r\n                        onMouseDown={(e) =>{\r\n                            if(e.target !== e.currentTarget) return;\r\n                            setItems(prev => prev.map(it => ({...it, isSelected: false, isEditing: 'none'})))\r\n                            setRedactorOpen(false)\r\n                        }}\r\n                        {...zoomHandlers}\r\n                        style={{\r\n                            transform: `\r\n                            translate(${viewport.offsetX}px, ${viewport.offsetY}px)\r\n                            scale(${viewport.scale})\r\n                            `,\r\n                            transformOrigin: \"center center\"\r\n                        }}\r\n                    >\r\n                        {items.map((item,i) => (\r\n                            <CanvasItem\r\n                                key={item.id}\r\n                                item={item}\r\n                                canEdit={canEdit}\r\n                                onSelect={id => setItems(prev =>\r\n                                prev.map(it => ({ ...it, isSelected: it.id === id }))\r\n                                )}\r\n                                onUpdate={(id, patch) => setItems(prev =>\r\n                                prev.map(it => (it.id === id ? { ...it, ...patch } : it))\r\n                                )}\r\n                                onDelete={item => setItems(prev => prev.filter(it => it.id !== item.id))}\r\n                                startDrag={startDrag}\r\n                                startResize={startResize}\r\n                                ismenuTextOpen={ismenuTextOpen}\r\n                                setMenuTextOpen={setMenuTextOpen}\r\n                                isLoading={loading}\r\n                                setselectedItemId={setSelectedItemId}\r\n                                setOpenRedactor={setRedactorOpen}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                )}\r\n                \r\n                {!isRecieve && (\r\n                    <CreateBtns\r\n                        createText={() => createText(setItems)}\r\n                        insertGif={(url) => insertGif(url,setItems)}\r\n                    />\r\n\r\n                    // <div \r\n                    //     className={`relative flex p-2 mt-20 gap-2 bg-[#ffffff1a] rounded-full backdrop-blur-md\r\n                    //     `}\r\n                    // >\r\n        \r\n                    //     <button\r\n                    //         className=\"p-2 border rounded-2xl\"  \r\n                    //         onClick={() => createText(setItems)}\r\n                    //     >\r\n                    //         Текст\r\n                    //     </button>\r\n        \r\n        \r\n                    //     <input\r\n                    //         value={UrlGif}\r\n                    //         onChange={e => setUrlGif(e.target.value)}\r\n                    //         placeholder=\"Вставь ссылочку\"\r\n                    //         className={`transition-all duration-300\r\n                    //                 ${isInputUrl ? 'w-100':'w-0'}\r\n                    //             `}\r\n                    //         onKeyDown={(e) => {\r\n                    //         if(!UrlGif) return\r\n                    //         if(e.key === 'Enter') {\r\n                    //             insertGif(UrlGif, setItems)\r\n                    //             setUrlGif(\"\")\r\n                    //             openInputUrl(false)\r\n                    //         }\r\n                    //         }}\r\n                            \r\n                    //     />\r\n                    //     <button\r\n                    //         className=\"p-2 border rounded-2xl\"  \r\n                    //         onClick={() => {\r\n                    //             openInputUrl(true)\r\n                    //             if(!UrlGif) return\r\n                    //             insertGif(UrlGif, setItems)\r\n                    //             setUrlGif(\"\")\r\n                    //             openInputUrl(false)\r\n                    //         }}\r\n                    //     >\r\n                    //         {isInputUrl ? \"Вставить\" : \"Гифка\"}\r\n                    //     </button>\r\n                        \r\n                    //     <div \r\n                    //         className=\"absolute inset-x-0 top-full flex overflow-x-auto no-scrollbar max-h-[80px] \r\n                    //                     bg-black/20 rounded-2xl gap-1\r\n                            \r\n                    //         \"\r\n                    //         >\r\n                    //         {resultsGif.map(url => (\r\n                    //             <img\r\n                    //                 key={url}\r\n                    //                 src={url}\r\n                    //                 className=\"flex object-contain w-full cursor-pointer\"\r\n                    //                 onClick={(e) => {\r\n                    //                     insertGif(url, setItems)\r\n                    //                     openInputUrl(false)\r\n                    //                 }}\r\n                    //             />\r\n                    //         ))}\r\n                    //     </div>\r\n        \r\n                    // </div>\r\n                )}\r\n    \r\n    \r\n    \r\n                {/* кнопка назад */}\r\n                <div\r\n                    className={`absolute left-0  flex justify-center items-center \r\n                    w-7 rounded-r-full backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                    md:inset-y-0\r\n                    inset-y-60\r\n                    z-20\r\n                    ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => router.push(\"anonlovemain\")}\r\n                        className=\"w-full h-full \">\r\n                        {`<`}\r\n                    </button>\r\n                </div>\r\n\r\n\r\n    \r\n                {/* редактор справа */}\r\n                <div className=\"z-20\">\r\n                    <Redactor\r\n                        item={selectedItem}\r\n                        items={items}\r\n                        open={setRedactorOpen}\r\n                        isOpen={redactorOpen}\r\n                        onChange={handleRedactorChange}\r\n                    />\r\n                </div>\r\n    \r\n    \r\n\r\n                {/* Кнопка снизу для поля отправить */}\r\n                <div\r\n                    className={`absolute right-1/2 bottom-0 translate-x-1/2 \r\n                    flex justify-center items-center overflow-hidden\r\n                    w-50 rounded-t-2xl bg-black/50 backdrop-blur-md hover:bg-white/20 transition-cursor\r\n                    z-20\r\n                    ${isMobile ? \"bg-black/50\" : \"bg-white/10\"}\r\n                    `}\r\n                    \r\n                >\r\n                    <button \r\n                        onClick={() => {setRightPanelOpen(true)}}\r\n                        className=\"flexC w-full h-full\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" ><path fill=\"currentColor\" d=\"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6l-6 6z\"/></svg>\r\n                    </button>\r\n    \r\n                </div>\r\n    \r\n                {/* поле отправить */}\r\n                <RightField\r\n                    rightPanelOpen={rightPanelOpen}\r\n                    setRightPanelOpen={setRightPanelOpen}\r\n                    userId={userId}\r\n                    setUserId={setUserId}\r\n                    isReply={isReply}\r\n                    anonState={anonState}\r\n                    setAnonState={(isAnon) => \r\n                        setAnonState(s =>({...s, isAnon}))\r\n                    }\r\n                    handleSendMessage={handleSendMessage}\r\n                    idRef={idRef}\r\n                    anonRef={anonRef}\r\n                    isRecieve={isRecieve}\r\n                    routeTo={id => {\r\n                        // router.push(`createcard?type=send&id=${encodeURIComponent(id ?? '')}`)\r\n                        router.push(`createcard?type=send&to=${encodeURIComponent(id ?? '')}`)\r\n                    }}\r\n                    userError={userError}\r\n                />\r\n\r\n    \r\n    \r\n            </div>\r\n        )\r\n    \r\n\r\n}"],"names":[],"mappings":"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"}}]
}