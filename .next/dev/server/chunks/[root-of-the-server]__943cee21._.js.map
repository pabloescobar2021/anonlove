{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/utils/supabase/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\n\r\nexport const supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);"],"names":[],"mappings":";;;;AAAA;;AAGO,MAAM,gBAAgB,IAAA,yLAAY,gFAEvC,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/anonlove/app/api/mark-read/route.ts"],"sourcesContent":["// /app/api/mark-read/route.ts\r\nimport { supabaseAdmin } from \"@/utils/supabase/supabaseAdmin\";\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        const { messageId } = body;\r\n\r\n        if (!messageId) {\r\n            console.error(\"‚ùå messageId is missing\");\r\n            return NextResponse.json({ error: \"messageId required\" }, { status: 400 });\r\n        }\r\n\r\n        \r\n        let query = supabaseAdmin\r\n            .from(\"messages\")\r\n            .update({ is_checked: true })\r\n            .eq(\"id\", messageId);\r\n\r\n        const { data, error } = await query.select();\r\n\r\n        if (error) {\r\n            console.error(\"‚ùå Database error:\", error);\r\n            return NextResponse.json({ \r\n                error: error.message,\r\n                details: error\r\n            }, { status: 500 });\r\n        }\r\n\r\n        if (!data || data.length === 0) {\r\n            console.error(\"‚ùå Message not found or already updated:\", { messageId });\r\n            \r\n            // –î–∞–≤–∞–π –ø—Ä–æ–≤–µ—Ä–∏–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ–æ–±—â–µ\r\n            const { data: checkData } = await supabaseAdmin\r\n                .from(\"messages\")\r\n                .select(\"id, to_user, is_checked\")\r\n                .eq(\"id\", messageId);\r\n            \r\n            console.log(\"üîé Check if message exists:\", checkData);\r\n            \r\n            return NextResponse.json({ \r\n                error: \"Message not found\",\r\n                messageExists: checkData && checkData.length > 0,\r\n                checkData\r\n            }, { status: 404 });\r\n        }\r\n\r\n        console.log(\"‚úÖ Message marked as read:\", data);\r\n        return NextResponse.json({ ok: true, data });\r\n    } catch (err) {\r\n        console.error(\"‚ùå Unexpected error:\", err);\r\n        return NextResponse.json({ \r\n            error: \"Internal server error\",\r\n            message: err instanceof Error ? err.message : String(err),\r\n            stack: err instanceof Error ? err.stack : undefined\r\n        }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":"AAAA,8BAA8B;;;;;AAC9B;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,SAAS,EAAE,GAAG;QAEtB,IAAI,CAAC,WAAW;YACZ,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAGA,IAAI,QAAQ,qJAAa,CACpB,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,YAAY;QAAK,GAC1B,EAAE,CAAC,MAAM;QAEd,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,MAAM,MAAM;QAE1C,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACrB,OAAO,MAAM,OAAO;gBACpB,SAAS;YACb,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC5B,QAAQ,KAAK,CAAC,2CAA2C;gBAAE;YAAU;YAErE,gDAAgD;YAChD,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,MAAM,qJAAa,CAC1C,IAAI,CAAC,YACL,MAAM,CAAC,2BACP,EAAE,CAAC,MAAM;YAEd,QAAQ,GAAG,CAAC,+BAA+B;YAE3C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACrB,OAAO;gBACP,eAAe,aAAa,UAAU,MAAM,GAAG;gBAC/C;YACJ,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,QAAQ,GAAG,CAAC,6BAA6B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM;QAAK;IAC9C,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,OAAO;YACP,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG,OAAO;YACrD,OAAO,eAAe,QAAQ,IAAI,KAAK,GAAG;QAC9C,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ"}}]
}