{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/utils/supabase/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabaseAdmin = createClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n)"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,IAAA,yLAAY,gFAErC,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/app/api/uploadProductImage/route.ts"],"sourcesContent":["import { supabaseAdmin } from \"@/utils/supabase/supabaseAdmin\";\r\n\r\nfunction transliterate(text: string): string {\r\n    const ru = 'а,б,в,г,д,е,ё,ж,з,и,й,к,л,м,н,о,п,р,с,т,у,ф,х,ц,ч,ш,щ,ъ,ы,ь,э,ю,я'.split(',');\r\n    const en = 'a,b,v,g,d,e,e,zh,z,i,y,k,l,m,n,o,p,r,s,t,u,f,h,ts,ch,sh,sch,_,y,_,e,yu,ya'.split(',');\r\n    \r\n    return text\r\n        .toLowerCase()\r\n        .split('')\r\n        .map(char => {\r\n            const index = ru.indexOf(char);\r\n            return index >= 0 ? en[index] : char;\r\n        })\r\n        .join('')\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/^-+|-+$/g, '');\r\n}\r\n\r\n\r\nexport const POST = async (req: Request) => {\r\n    try {\r\n        const formData = await req.formData();\r\n        const file = formData.get(\"file\") as File;\r\n        const product_id = formData.get(\"product_id\") as string;\r\n        const category_name = formData.get(\"category_name\") as string;\r\n\r\n        if (!file || !product_id || !category_name) {\r\n            return new Response(\"Missing file or product_id\", { status: 400 });\r\n        }\r\n\r\n        const category_slug = transliterate(category_name);\r\n\r\n        const filePath = `${category_slug}/product-${product_id}.webp`;\r\n\r\n        const { error: uploadError } = await supabaseAdmin.storage\r\n            .from(\"products\")\r\n            .upload(filePath, file, { upsert: true });\r\n\r\n        if (uploadError) {\r\n            return new Response(\"Error uploading image\", { status: 500 });\r\n        }\r\n\r\n        const { data } = await supabaseAdmin.storage\r\n            .from(\"products\")\r\n            .getPublicUrl(filePath);\r\n        const publicUrl = data.publicUrl;\r\n\r\n        const { error: updateError } = await supabaseAdmin\r\n            .from(\"products\")\r\n            .update({ main_image: publicUrl })\r\n            .eq(\"id\", product_id);\r\n\r\n        if (updateError) {\r\n            return new Response(\"Error updating product image URL\", { status: 500 });\r\n        }\r\n\r\n        return new Response(\"Image uploaded and product updated successfully!\", { status: 200 });\r\n    } catch (error: any) {\r\n        return new Response(\"Internal Server Error: \" + error.message, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,SAAS,cAAc,IAAY;IAC/B,MAAM,KAAK,oEAAoE,KAAK,CAAC;IACrF,MAAM,KAAK,4EAA4E,KAAK,CAAC;IAE7F,OAAO,KACF,WAAW,GACX,KAAK,CAAC,IACN,GAAG,CAAC,CAAA;QACD,MAAM,QAAQ,GAAG,OAAO,CAAC;QACzB,OAAO,SAAS,IAAI,EAAE,CAAC,MAAM,GAAG;IACpC,GACC,IAAI,CAAC,IACL,OAAO,CAAC,eAAe,KACvB,OAAO,CAAC,YAAY;AAC7B;AAGO,MAAM,OAAO,OAAO;IACvB,IAAI;QACA,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,aAAa,SAAS,GAAG,CAAC;QAChC,MAAM,gBAAgB,SAAS,GAAG,CAAC;QAEnC,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe;YACxC,OAAO,IAAI,SAAS,8BAA8B;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,gBAAgB,cAAc;QAEpC,MAAM,WAAW,GAAG,cAAc,SAAS,EAAE,WAAW,KAAK,CAAC;QAE9D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,qJAAa,CAAC,OAAO,CACrD,IAAI,CAAC,YACL,MAAM,CAAC,UAAU,MAAM;YAAE,QAAQ;QAAK;QAE3C,IAAI,aAAa;YACb,OAAO,IAAI,SAAS,yBAAyB;gBAAE,QAAQ;YAAI;QAC/D;QAEA,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,qJAAa,CAAC,OAAO,CACvC,IAAI,CAAC,YACL,YAAY,CAAC;QAClB,MAAM,YAAY,KAAK,SAAS;QAEhC,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,qJAAa,CAC7C,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,YAAY;QAAU,GAC/B,EAAE,CAAC,MAAM;QAEd,IAAI,aAAa;YACb,OAAO,IAAI,SAAS,oCAAoC;gBAAE,QAAQ;YAAI;QAC1E;QAEA,OAAO,IAAI,SAAS,oDAAoD;YAAE,QAAQ;QAAI;IAC1F,EAAE,OAAO,OAAY;QACjB,OAAO,IAAI,SAAS,4BAA4B,MAAM,OAAO,EAAE;YAAE,QAAQ;QAAI;IACjF;AACJ"}}]
}