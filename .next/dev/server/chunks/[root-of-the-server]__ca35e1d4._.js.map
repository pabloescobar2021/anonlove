{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%95%D0%BB%D0%B5%D0%BD%D0%B0/Desktop/next.js/my-next-app/app/api/lots/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\n\r\ntype Lot = {\r\n    id: string;\r\n    label: string;\r\n    weight: number;\r\n    color?: string;\r\n    enabled?: boolean;\r\n}\r\n\r\nlet lots: Lot[] = []\r\n\r\nconst clients = new Set<ReadableStreamDefaultController>()\r\n\r\nexport async function GET(req: NextResponse) {\r\n    const encoder = new TextEncoder()\r\n\r\n    const stream = new ReadableStream({\r\n        start(controller) {\r\n            clients.add(controller)\r\n            console.log('✅ Клиент подключился. Всего:', clients.size);\r\n\r\n            const initialMessage = `data: ${JSON.stringify({\r\n                type: 'INITIAL_LOTS',\r\n                data: lots\r\n            })}\\n\\n`\r\n\r\n            controller.enqueue(encoder.encode(initialMessage))\r\n\r\n            const keepAlive = setInterval(() => {\r\n                try {\r\n                    controller.enqueue(encoder.encode(': keep-alive\\n\\n'))\r\n                } catch {\r\n                    clearInterval(keepAlive)\r\n                }\r\n            }, 30000)\r\n\r\n            req.signal.addEventListener('abort', () => {\r\n                clearInterval(keepAlive)\r\n                clients.delete(controller)\r\n                console.log('❌ Клиент отключился. Всего:', clients.size);\r\n            })\r\n        }\r\n    })\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    const body = await req.json();\r\n\r\n    if (!body.label || !body.weight) {\r\n        return NextResponse.json({ error: \"Missing label or weight\" }, { status: 400 });\r\n    }\r\n\r\n    const newLot: Lot = {\r\n        id: crypto.randomUUID(),\r\n        label: body.label,\r\n        weight: Number(body.weight),\r\n        enabled: true,\r\n    }\r\n\r\n    lots.push(newLot)\r\n\r\n    return NextResponse.json(newLot, {status: 201});\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAUA,IAAI,OAAc,EAAE;AAEpB,MAAM,UAAU,IAAI;AAEb,eAAe,IAAI,GAAiB;IACvC,MAAM,UAAU,IAAI;IAEpB,MAAM,SAAS,IAAI,eAAe;QAC9B,OAAM,UAAU;YACZ,QAAQ,GAAG,CAAC;YACZ,QAAQ,GAAG,CAAC,gCAAgC,QAAQ,IAAI;YAExD,MAAM,iBAAiB,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;gBAC3C,MAAM;gBACN,MAAM;YACV,GAAG,IAAI,CAAC;YAER,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;YAElC,MAAM,YAAY,YAAY;gBAC1B,IAAI;oBACA,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;gBACtC,EAAE,OAAM;oBACJ,cAAc;gBAClB;YACJ,GAAG;YAEH,IAAI,MAAM,CAAC,gBAAgB,CAAC,SAAS;gBACjC,cAAc;gBACd,QAAQ,MAAM,CAAC;gBACf,QAAQ,GAAG,CAAC,+BAA+B,QAAQ,IAAI;YAC3D;QACJ;IACJ;AACJ;AAEO,eAAe,KAAK,GAAY;IACnC,MAAM,OAAO,MAAM,IAAI,IAAI;IAE3B,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,MAAM,EAAE;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IACjF;IAEA,MAAM,SAAc;QAChB,IAAI,OAAO,UAAU;QACrB,OAAO,KAAK,KAAK;QACjB,QAAQ,OAAO,KAAK,MAAM;QAC1B,SAAS;IACb;IAEA,KAAK,IAAI,CAAC;IAEV,OAAO,gJAAY,CAAC,IAAI,CAAC,QAAQ;QAAC,QAAQ;IAAG;AACjD"}}]
}