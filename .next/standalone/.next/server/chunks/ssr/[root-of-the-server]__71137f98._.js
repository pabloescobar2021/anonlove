module.exports=[72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},84121,58056,14139,a=>{"use strict";var b=a.i(72131),c=a.i(10845);async function d(){let{data:a,error:b}=await c.supabase.auth.getUser();if(!b)return a.user}async function e(a){let{data:b,error:d}=await c.supabase.from("users").select("public_id, username").eq("id_user",a).single();return d?null:b}async function f(){let{error:a}=await c.supabase.auth.signOut();if(a)throw a}function g(a){let{data:b}=c.supabase.auth.onAuthStateChange((b,c)=>{a(c?.user||null)});return b.subscription}function h(){let[a,c]=(0,b.useState)(null),[f,h]=(0,b.useState)(null),[i,j]=(0,b.useState)(!0);return(0,b.useEffect)(()=>{(async()=>{try{let a=await d();if(c(a),a){let b=await e(a.id);h(b)}}catch(a){console.error("Error loading user:",a)}finally{j(!1)}})();let a=g(async a=>{c(a),a?h(await e(a.id)):h(null)});return()=>{a.unsubscribe()}},[]),{user:a,profile:f,loading:i}}async function i(a){let{data:b,error:d}=await c.supabase.from("messages_safe").select(`
            *
            `).eq("to_user",a).order("created_at",{ascending:!0});if(d)throw d;return(b||[]).map(a=>{let b=a.user_anonymous_settings?.[0]?.is_anon;return{...a,displayId:b||a.is_anon?"Anon":a.from_public_id,username:b||a.is_anon?"Anon":a.from_username}})}async function j(a,b,d){console.log("Querying message:",{messageId:a,userId:b});let{data:e,error:f}=await c.supabase.from("messages_safe").select("*").eq("id",a).eq("true"===d?"from_user":"to_user",b).maybeSingle();if(console.log("Query result:",{data:e,error:f}),f)throw f;return e||[]}async function k(a){let{data:b,error:d}=await c.supabase.from("messages_safe").select(`
            *`).eq("from_user",a).order("created_at",{ascending:!0});if(d)throw d;return b||[]}async function l({fromUserId:a,toUserId:b,toPublicId:d,body:e,isAnon:f}){let g=b;if(!g){if(!d)throw Error("Не указан пользователь, малыш");let{data:a,error:b}=await c.supabase.from("users").select("id_user").eq("public_id",d).single();if(b||!a)throw Error("Пользователь не найден, кись");g=a.id_user}let{error:h}=await c.supabase.from("user_anonymous_settings").upsert([{from_user_id:a,to_user_id:g,is_anon:f}],{onConflict:"from_user_id,to_user_id"});if(h)throw h;let{error:i}=await c.supabase.from("messages").insert({from_user:a,to_user:g,body:e});if(i)throw i}function m(a){return{...a,isEditing:"none",isSelected:!1}}function n(a){let[c,d]=(0,b.useState)([]),[e,f]=(0,b.useState)([]),[g,h]=(0,b.useState)(!0),j=async()=>{if(a)try{h(!0);let[b,c]=await Promise.all([i(a),k(a)]);d(b),f(c)}catch(a){console.error("Error loading messages:",a)}finally{h(!1)}};return(0,b.useEffect)(()=>{j()},[a]),{inbox:c,sent:e,loading:g,sendMessage:async(b,c,d)=>{if(!a)throw Error("User not logged in");await l({fromUserId:a,toUserId:b.userId,toPublicId:b.publicId,body:c,isAnon:d}),await j()},refresh:j}}function o(a,c,d){let[e,f]=(0,b.useState)(null),[g,h]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{a&&c&&(async()=>{h(!0);try{let b=await j(c,a,d);f({...b,body:b.body.map(m)})}catch(a){console.error("Error loading messages:",a)}finally{h(!1)}})()},[a,c]),{message:e,loading:g}}function p(a,c,d){return(0,b.useMemo)(()=>{let b=new Map;for(let e of[...a,...c]){let a=e.from_user===d?e.to_user:e.from_user,c="";if(c="A"===e.from_display_id?"Anon":e.from_display_id,b.has(a)){let c=b.get(a);c.messages.push(e),c.count++,new Date(e.created_at)>new Date(c.lastMessage.created_at)&&(c.lastMessage=e)}else b.set(a,{userId:a,displayId:c,lastMessage:e,messages:[e],count:1})}return Array.from(b.values()).sort((a,b)=>new Date(b.lastMessage.created_at).getTime()-new Date(a.lastMessage.created_at).getTime())},[a,c,d])}a.s(["getCurrentUser",()=>d,"getUserProfile",()=>e,"onAuthStateChange",()=>g,"sighOut",()=>f],58056),a.s(["useAuth",()=>h],84121),a.s(["useCurrentMessage",()=>o,"useDialogs",()=>p,"useMessages",()=>n],14139)},38332,a=>{"use strict";var b=a.i(72131);function c(a=768){let[d,e]=(0,b.useState)(!1);return(0,b.useEffect)(()=>{let a=()=>{e(window.innerWidth<=768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[a]),d}a.s(["useCheckMobile",()=>c])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__71137f98._.js.map