(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,82853,19184,79262,e=>{"use strict";var t=e.i(71645),s=e.i(14179);async function r(){let{data:e,error:t}=await s.supabase.auth.getUser();if(!t)return e.user}async function a(e){let{data:t,error:r}=await s.supabase.from("users").select("public_id, username").eq("id_user",e).single();return r?null:t}async function i(){let{error:e}=await s.supabase.auth.signOut();if(e)throw e}function n(e){let{data:t}=s.supabase.auth.onAuthStateChange((t,s)=>{e(s?.user||null)});return t.subscription}function o(){let[e,s]=(0,t.useState)(null),[i,o]=(0,t.useState)(null),[u,l]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{(async()=>{try{let e=await r();if(s(e),e){let t=await a(e.id);o(t)}}catch(e){console.error("Error loading user:",e)}finally{l(!1)}})();let e=n(async e=>{s(e),e?o(await a(e.id)):o(null)});return()=>{e.unsubscribe()}},[]),{user:e,profile:i,loading:u}}async function u(e){let{data:t,error:r}=await s.supabase.from("messages_safe").select(`
            *
            `).eq("to_user",e).order("created_at",{ascending:!0});if(r)throw r;return(t||[]).map(e=>{let t=e.user_anonymous_settings?.[0]?.is_anon;return{...e,displayId:t||e.is_anon?"Anon":e.from_public_id,username:t||e.is_anon?"Anon":e.from_username}})}async function l(e,t){let{data:r,error:a}=await s.supabase.from("messages_safe").select("*").eq("id",e).eq("to_user",t).single();if(a)throw a;return r||[]}async function c(e){let{data:t,error:r}=await s.supabase.from("messages_safe").select(`
            *`).eq("from_user",e).order("created_at",{ascending:!0});if(r)throw r;return t||[]}async function f({fromUserId:e,toUserId:t,toPublicId:r,body:a,isAnon:i}){let n=t;if(!n){if(!r)throw Error("Не указан пользователь, малыш");let{data:e,error:t}=await s.supabase.from("users").select("id_user").eq("public_id",r).single();if(t||!e)throw Error("Пользователь не найден, кись");n=e.id_user}let{error:o}=await s.supabase.from("user_anonymous_settings").upsert([{from_user_id:e,to_user_id:n,is_anon:i}],{onConflict:"from_user_id,to_user_id"});if(o)throw o;let{error:u}=await s.supabase.from("messages").insert({from_user:e,to_user:n,body:a});if(u)throw u}function d(e){let[s,r]=(0,t.useState)([]),[a,i]=(0,t.useState)([]),[n,o]=(0,t.useState)(!0),l=async()=>{if(e)try{o(!0);let[t,s]=await Promise.all([u(e),c(e)]);r(t),i(s)}catch(e){console.error("Error loading messages:",e)}finally{o(!1)}};return(0,t.useEffect)(()=>{l()},[e]),{inbox:s,sent:a,loading:n,sendMessage:async(t,s,r)=>{if(!e)throw Error("User not logged in");await f({fromUserId:e,toUserId:t.userId,toPublicId:t.publicId,body:s,isAnon:r}),await l()},refresh:l}}function m(e,s){let[r,a]=(0,t.useState)(null),[i,n]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{e&&s&&(async()=>{n(!0);try{let t=await l(s,e);a(t)}catch(e){console.error("Error loading messages:",e)}finally{n(!1)}})()},[e,s]),{message:r,loading:i}}function h(e,s,r){return(0,t.useMemo)(()=>{let t=new Map;for(let a of[...e,...s]){let e=a.from_user===r?a.to_user:a.from_user,s="";if(s="A"===a.from_display_id?"Anon":a.from_display_id,t.has(e)){let s=t.get(e);s.messages.push(a),s.count++,new Date(a.created_at)>new Date(s.lastMessage.created_at)&&(s.lastMessage=a)}else t.set(e,{userId:e,displayId:s,lastMessage:a,messages:[a],count:1})}return Array.from(t.values()).sort((e,t)=>new Date(t.lastMessage.created_at).getTime()-new Date(e.lastMessage.created_at).getTime())},[e,s,r])}e.s(["getCurrentUser",()=>r,"getUserProfile",()=>a,"onAuthStateChange",()=>n,"sighOut",()=>i],19184),e.s(["useAuth",()=>o],82853),e.s(["useCurrentMessage",()=>m,"useDialogs",()=>h,"useMessages",()=>d],79262)},97142,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let r={width:200,height:200};var a=e.i(82853),i=e.i(79262),n=e.i(18566);function o(){let e=(0,n.useRouter)(),{user:o}=(0,a.useAuth)(),[u,l]=(0,s.useState)(null),{message:c,loading:f}=(0,i.useCurrentMessage)(o?.id??null,u),[d,m]=(0,s.useState)(r),[h,g]=(0,s.useState)(1),[w,b]=(0,s.useState)(!1),[_,p]=(0,s.useState)(!1),[y,v]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let e=window.location.hash;e&&l(e.replace("#",""))},[]),(0,t.jsxs)("div",{className:"flex justify-center items-center bg-black h-full",children:[!_&&(0,t.jsx)("div",{className:"flex justify-center items-center bg-black h-full",children:(0,t.jsx)("svg",{width:d.width,height:d.height,viewBox:"0 0 100 100",className:"overflow-visible",style:{width:200,height:200,opacity:+!w,transform:w?"scale(25)":`scale(${h})`,transition:w?"transform 0.9s cubic-bezier(0.22,1,0.36,1), opacity 0.4s ease-in-out":"transform 0.15s ease-in-out"},children:(0,t.jsx)("path",{onClick:()=>{if(y<2){v(e=>e+1),m(e=>({width:e.width+100,height:e.height+100})),g(1.2),setTimeout(()=>g(.95),120),setTimeout(()=>g(1.05),220),setTimeout(()=>g(1),320);let e=setInterval(()=>{g(1.2),setTimeout(()=>g(.95),120),setTimeout(()=>g(1.05),220),setTimeout(()=>g(1),320)},700);setTimeout(()=>clearInterval(e),1e3)}else b(!0),setTimeout(()=>{p(!0)},400)},className:"cursor-pointer transition-transform duration-150 ease-in-out",style:{transformOrigin:"50% 50%",transform:`scale(${h})`},fill:"red",stroke:"#fff",strokeWidth:2,d:"   M50 85   C20 60, 5 45, 25 25   C40 10, 50 25, 50 25   C50 25, 60 10, 75 25   C95 45, 80 60, 50 85   "})})}),_&&(0,t.jsxs)("div",{className:"relative w-full h-full overflow-hidden bg-black",children:[(0,t.jsx)("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute top-0 left-0 w-full h-full object-cover opacity-40",children:(0,t.jsx)("source",{src:"/bg/bgstar.mp4",type:"video/mp4"})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40"}),(0,t.jsxs)("div",{className:"relative z-10 flex flex-col justify-center items-center h-full",children:[(0,t.jsx)("button",{className:"bg-white/10 p-2 mb-4",onClick:()=>e.push("anonlovemain"),children:"←"}),(0,t.jsx)("div",{className:"flex flex-col justify-center items-center border rounded-xl bg-black/80   border-white w-1/2 h-1/2 text-white p-6",children:c.body})]})]})]})}e.s(["default",()=>o,"dynamic",0,"force-dynamic"],97142)}]);